---
title: 'Optimizing genetic ancestry adjustment in DNA methylation studies: a comparative
  analysis of approaches.**DOI:** 10.1186/s13072-025-00627-0'
authors:
- "Kira DH\xF6ffler"
- SeymaKatrinli
- Matthew WHalvorsen
- Anne-KristinStavrum
- Kevin SO'Connell
- AlexeyShadrin
- SrdjanDjurovic
- Ole AAndreassen
- James JCrowley
- JanHaavik
- KristenHagen
- GerdKvale
- KerryRessler
- BjarneHansen
- Jair CSoares
- Gabriel RFries
- Alicia KSmith
- "St\xE9phanieLe Hellard"
journal: Epigenetics & chromatin
doi: 10.1186/s13072-025-00627-0
publication_date: ''
source: Processed from scraped content
processing_date: '2025-10-21T22:15:02.808669'
content_type: research_paper
conditions:
- related_disorders
topics: []
categories:
- related-disorders
reading_level: academic
audience:
- professional
- researcher
patient_friendly: false
search_priority: standard
keywords:
- genetic
search_tags:
- academic
- related_disorders
- research
- peer-reviewed
---

# Optimizing genetic ancestry adjustment in DNA methylation studies: a comparative analysis of approaches.**DOI:** 10.1186/s13072-025-00627-0

**Authors:** Kira DHöffler, SeymaKatrinli, Matthew WHalvorsen, Anne-KristinStavrum, Kevin SO'Connell, AlexeyShadrin, SrdjanDjurovic, Ole AAndreassen, James JCrowley, JanHaavik, KristenHagen, GerdKvale, KerryRessler, BjarneHansen, Jair CSoares, Gabriel RFries, Alicia KSmith, StéphanieLe Hellard

**Journal:** Epigenetics & chromatin

**DOI:** 10.1186/s13072-025-00627-0

## Abstract

Genetic ancestry is an important factor to account for in DNA methylation studies because genetic variation influences DNA methylation patterns. One approach uses principal components (PCs) calculated from CpG sites that overlap with common SNPs to adjust for ancestry when genotyping data is not available. However, this method does not remove technical and biological variations, such as sex and age, prior to calculating the PCs. The first PC is therefore often associated with factors other than ancestry.
We developed and adapted the adapted EpiAnceR+ approach, which includes (1) residualizing the CpG data overlapping with common SNPs for control probe PCs, sex, age, and cell type proportions to remove the effects of technical and biological factors, and (2) integrating the residualized data with genotype calls from the SNP probes (commonly referred to as rs probes) present on the arrays, before calculating PCs and evaluated the clustering ability and relationship to genetic ancestry.
The PCs generated by EpiAnceR+ led to improved clustering for repeated samples from the same individual and stronger associations with genetic ancestry groups predicted from genotype information compared to the original approach. EpiAnceR+ also outperformed the use of DNA methylation PCs or surrogate variables for ancestry adjustment.
We show that the EpiAnceR+ approach improves the adjustment for genetic ancestry in DNA methylation studies. EpiAnceR+ can be integrated into existing R pipelines for commercial methylation arrays, such as 450 K, EPIC v1, and EPIC v2. The code is available on GitHub ( https://github.com/KiraHoeffler/EpiAnceR ).

We developed and adapted the adapted EpiAnceR+ approach, which includes (1) residualizing the CpG data overlapping with common SNPs for control probe PCs, sex, age, and cell type proportions to remove the effects of technical and biological factors, and (2) integrating the residualized data with genotype calls from the SNP probes (commonly referred to as rs probes) present on the arrays, before calculating PCs and evaluated the clustering ability and relationship to genetic ancestry.
The PCs generated by EpiAnceR+ led to improved clustering for repeated samples from the same individual and stronger associations with genetic ancestry groups predicted from genotype information compared to the original approach. EpiAnceR+ also outperformed the use of DNA methylation PCs or surrogate variables for ancestry adjustment.
We show that the EpiAnceR+ approach improves the adjustment for genetic ancestry in DNA methylation studies. EpiAnceR+ can be integrated into existing R pipelines for commercial methylation arrays, such as 450 K, EPIC v1, and EPIC v2. The code is available on GitHub ( https://github.com/KiraHoeffler/EpiAnceR ).## Full Text## Abstract
background genetic ancestry is an important factor to account for in dna methylation studies because genetic variation influences dna methylation patterns. one approach uses principal components (pcs) calculated from cpg sites that overlap with common snps to adjust for ancestry when genotyping data is not available. however, this method does not remove technical and biological variations, such as sex and age, prior to calculating the pcs. the first pc is therefore often associated with factors other than ancestry. methods we developed and adapted the adapted epiancer+ approach, which includes (1) residualizing the cpg data overlapping with common snps for control probe pcs, sex, age, and cell type proportions to remove the effects of technical and biological factors, and (2) integrating the residualized data with genotype calls from the snp probes (commonly referred to as rs probes) present on the arrays, before calculating pcs and evaluated the clustering ability and relationship to genetic ancestry. results the pcs generated by epiancer+ led to improved clustering for repeated samples from the same individual and stronger associations with genetic ancestry groups predicted from genotype information compared to the original approach. epiancer+ also outperformed the use of dna methylation pcs or surrogate variables for ancestry adjustment. conclusions we show that the epiancer + approach improves the adjustment for genetic ancestry in dna methylation studies. epiancer+ can be integrated into existing r pipelines for commercial methylation arrays, such as 450 k, epic v1, and epic v2. the code is available on github ( https://github.com/kirahoeffler/epiancer ). background genetic ancestry is an important confounding factor in dna methylation studies and should ideally be adjusted for using principal components (pcs) derived from genetic information (i.e. genotypes). however, when genotype data is not available for all study participants, self-reported ancestry data is commonly used to adjust for ancestry in dna methylation studies, often leading to the exclusion of non-europeans and individuals with mixed genetic backgrounds, and to sub-optimal correction. this practice is problematic due to the historical underrepresentation of non-europeans in epigenetic research [ 1 ] and the inherent flaws of self-reported data, which fail to capture the continuous nature of genetic variation and inadequately address the complexity of mixed ancestry backgrounds. to ensure the generalizability of research findings, dna methylation studies should avoid excluding individuals based on genetic background. two main methods are available to adjust for genetic ancestry in dna methylation studies lacking genotyping data. the method by barfield et al. from 2014 [ 2 ] calculates pcs from dna methylation data of cpgs near or overlapping single nucleotide polymorphisms (snps), selected based on the 1000 genomes project [ 3 ] data. however, this approach does not account for technical and biological factors such as sex, age, and cell type proportions, resulting in the first ancestry pc not being regularly associated with genetic ancestry [ 2 ] and potentially introducing multicollinearity with other adjusted factors in the final model. the epistructure [ 4 ] approach calculates pcs from dna methylation of cpgs highly correlated with cis-located snp probes while considering cell-type composition. this method is not easily integrated into existing r-based pipelines because it is a python program and requires several steps of input file adaptation. additionally, it has not been updated since 2017 and does not accommodate the epic v2 array. other methods based on dna methylation, such as surrogate variables and methylation pcs from the whole array data, do not specifically adjust for ancestry. therefore, there is a need for a reliable method to adjust for ancestry in dna methylation studies where genotype data is not available that can easily be incorporated into existing pipelines. our aim was to provide such a method by improving the approach by barfield et al.'s [ 2 ] through the use of methylation data from cpgs overlapping with snp probes that are residualized for technical and biological factors (i.e. cell type proportion pcs, sex, age, and control probe pcs) and information from genotyping snp rs probes on the array. we hypothesized that ancestry pcs from our adapted approach would result in better clustering of genetically predicted ancestry groups and repeated samples from the same individual, stronger associations with genetic ancestry, and stronger correlations with genetic pcs. we tested the performance of our approach against the existing one using two norwegian cohorts (bcbp-ocd and top [ 5 , 6 ,]– [ 7 ]) and two us-american cohorts: uthealth houston [ 8 ] and grady trauma project (gtp) [ 9 ]. an easy-to-use function for our adapted approach is provided on github, along with detailed guidance on parameter settings and input file structure for implementation ( https://github.com/kirahoeffler/epiancer ). methods tested cohorts the different approaches were tested in two cohorts from norway and two cohorts from the united states, including individuals with available dna methylation data and ancestry information (either genetically predicted or self-reported, table 1 ). the inclusion criteria were passing dna methylation quality control and, if available, genotyping quality control. samples from individuals with mixed ancestry (based on the available data, as described in the genetic ancestry prediction section) were excluded from performance testing solely for methodological reasons, because evaluating classification accuracy requires clearly defined ancestry groups, and admixed individuals typically fall between clusters. this is not a limitation of epiancer+ , which produces continuous ancestry pcs that capture both discrete and admixed variation, making it fully applicable to individuals with mixed ancestry. table 1 cohorts on which the approaches were tested full size table dna methylation in the bcbp-ocd cohort, dna methylation was measured using the illumina epic v2 array at life&brain gmbh in bonn, germany. samples were excluded if they showed: mismatches between reported and predicted sex, outliers in the minfi [ 10 ] sex plot, genotype mismatches between repeated samples [ 11 ], low bisulfite conversion efficiency (< 80%) calculated with the watermelon [ 12 ] package, more than 5% missing data (after applying a detection p value threshold of 10e −16 ), or outlier patterns in beta value distribution plots [ 10 ]. saliva cell type proportions were estimated using hepidish [ 13 ] with the rpc method. the centepifibfatic.m dataset, excluding fat, was used as the main reference, while the centbloodsub.m dataset functioned as the secondary reference [ 13 ]. in the top cohort [ 5 , 6 ,]– [ 7 ], dna methylation was measured using the illumina epic v1 array at life and brain gmbh in bonn, germany, and quality controlled in three batches. samples were excluded if at least 1% of sites had a detection p -value > 0.01, if snp genotypes from the rs probes on the epic array did not match genotype data from the same samples, or there was a discrepancy between the sex predicted from dna methylation data and the reported sex [ 5 ]. the blood cell type proportions were calculated using the estimatecellcounts2 function from flowsorted.blood.epic [ 14 ] package. in the gtp cohort [ 9 ], dna methylation was measured using the illumina epic v1 array and quality controlled using the psychiatric genomics consortium (pgc)-ptsd epigenetics pipeline [ 15 ] (available at https://github.com/pgc-ptsd-ewas/epic_qc ). briefly, samples were excluded if their probe detection call rates were below 90% (after applying a detection p value threshold of 0.01) or if their average intensity values were either less than half of the overall sample mean or below 2000 arbitrary units (au). blood cell composition - including cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and neutrophils - was estimated using the robust partial correlation (rpc) method in epidish [ 16 ], utilizing a reference dataset specific to the epic array [ 17 ]. in the uthealth houston cohort [ 8 ], dna methylation was measured using the illumina epic v1 array. samples with a mean detection p-value below 0.05 were set to be excluded; however, no samples met this criterion, so none were excluded. white blood cell count proportions (cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and granulocytes) were estimated using the houseman algorithm [ 18 ]. genetic ancestry prediction bcbp-ocd: genotyping data for the bcbp-ocd cohort were processed following the quality control procedures described in the latest pgc ocd gwas study [ 19 ]. ancestry prediction was performed as outlined by halvorsen et al. [ 20 ], using principal component analysis and a random forest classifier trained on 1000 genomes project phase 3 data [ 3 ]. top: genotyping data and quality control procedures for the top cohort are described in detail in previous work [ 21 ]. ancestry was inferred from genotyping data using a random forest classifier trained on population reference data from the 1000 genomes project [ 3 ], as previously described [ 5 ]. gtp : genotyping was performed using illumina omni-quad 1 m, and genotypes were called in illumina’s genomestudio. genotype data quality control and calculation of pcsoty were performed according to the pgc guidelines [ 22 ]. ancestry was predicted as described by nievergelt et al. [ 22 ]. uthealth houston: ancestry information was assessed by self-report, as genotyping data were not available. epiancer+ approach the epiancer+ approach uses the minfi [ 10 ], champ [ 23 ], and watermelon [ 12 ] packages in r (developed in version 4.4.0) to generate “ancestry pcs”, which can be incorporated into final analysis models for samples that have passed general quality control. the approach consists of two main functions: ancestry_info() and ancestry_pca(). ancestry_info() function the ancestry_info() function uses an rgset that has been background-corrected using the bg.correct.illumina() [ 10 ] function. data from control probes, snp rs probes, bead counts, and detection p-values are extracted, as well as intensities of type i probes (split into green and red channels) and type ii probes. a detection p-value threshold of 10e −16 is applied, setting values above this threshold as missing. the intensities are filtered to include only cpgs overlapping with snps, referred to as snp0bp probes. the probes are selected using the same underlying criteria across all arrays, though the implementation depends on the structure of the available array-specific annotation: 450 k array: from the illuminahumanmethylation450kanno.ilmn12.hg19 [ 24 ] annotations, selecting snps probes from cpg_rs column overlapping with cpg sites filtered based on minor allele frequency (maf) ≥ 0.05. epic v1 array: from the pidsley et al . [ 25 ] and zhang et al . [ 26 ] annotations, selecting probes in either or both publications overlapping with snps (distance = 0) with a maf ≥ 0.05 epic v2 array: from annotations provided by illumina [ 27 ], selecting probes overlapping with snps (distance = 0) with a maf ≥ 0.05 the number of selected ancestry-informative probes was 7295 for the 450 k array, 3622 for the epic v1 array, and 2,674 for the epic v2 array. probes with low bead counts (where > 5% of samples have a bead count below 3) or low call rates (where > 10% of samples have missing data) are excluded. after filtering, the intensity values are quantile normalized, and beta values are calculated. missing values are imputed using the champ.impute() [ 23 ] function. beta values for the snp0bp probes are then residualized to adjust for cell count pcs, sex, age, and ten pcs derived from control probes, which capture a broad range of technical variation, including slide, array position, scanner effects, dna quality, and bisulfite conversion efficiency. this residualized data is referred to as epiancer . finally, the residualized snp0bp data is combined with the genotype calls from rs snp probes, which is referred to as epiancer+ . ancestry_pca() function the ancestry_pca() function takes the processed data from ancestry_info() and uses it to calculate ancestry pcs. these pcs are intended to be included in analysis models as covariates to control for ancestry-related variation. for further details and access to the code, please refer to the code on github ( https://github.com/kirahoeffler/epiancer ). performance tests three versions of ancestry pcs were compared: the original barfield [ 2 ] et al. approach ( epiancorig ), the adapted approach after only performing the residualization step ( epiancer ), and the further adapted approach combining the residualised data with called genotypes from rs probes ( epiancer+ ). to ensure comparability across approaches, the pca results were min–max scaled to a range between 0 and 1. associations between ancestry pcs and ancestry group were tested using anova when assumptions of normality and variance homogeneity were met. otherwise, kruskal–wallis tests with the rstatix [ 2 ] package were used. to evaluate clustering performance, silhouette scores [ 28 ], which range from -1 to 1 (with higher values indicating better clustering), were calculated using the cluster [ 29 ] package. these scores were used to evaluate clustering performance at both the ancestry group level and the individual (repeated samples) level. in addition, three-dimensional (3d) centroids of both ancestry group and individual (repeated samples) clusters were calculated. cluster density was assessed by calculating the mean euclidean 3d distance from each sample to the centroid of its respective group. to determine the separation between ancestry group clusters, a distance matrix was generated to measure the distances between the centroids of different ancestry groups. in the bcbp-ocd cohort, the absolute correlation between the first three ancestry pcs and the first three genotyping pcs was calculated to evaluate how effectively the methylation-based pcs capture the genetic ancestry background. visualization of results was performed using ggplot2 [ 30 ], cowplot [ 31 ], patchwork [ 32 ], plotly [ 33 ], htmlwidgets [ 34 ], and corrplot [ 35 ] packages. comparison with dna methylation pcs and surrogate variables in the bcbp-ocd sample, we compared the performance of epiancer+ with that of the first three dna methylation pcs and the first three surrogate variables (svs), using the same evaluation approach described above. dna methylation pcs were calculated from normalized m-values from autosomal probes. surrogate variable analysis was performed on the m-values. the full model included case–control status, age, sex, two cell type pcs, and ten control probe pcs. the null model excluded case–control status. ancestry group associations with technical and biological adjustment factors associations between ancestry groups and the factors used to residualize snp0bp data were tested using either linear models for datasets with two ancestry groups or anova when multiple ancestry groups were present (with a common p-value for the effect across all groups). for control probe pcs and cell type pcs in datasets with repeated samples, linear mixed-effect models were employed to test the association with the ancestry groups. these models included a random intercept to account for repeated measures from the same individual. two models were compared: (a) a full model that included ancestry group as a predictor and the pcs as outcome; (b) a null model that excluded ancestry group. a likelihood ratio test was performed to determine if the full model fit the data significantly better than the null model. additionally, to assess whether residualized biological and technical covariates confounded our epiancer+ pcs, we performed linear regression and partial r 2 analyses in the gtp cohort. for each of the top three epiancer+ pcs, we quantified the unique variance explained by (i) the top three genotype-derived ancestry pcs, (ii) residualized covariates (sex, age, top 10 control probe pcs, and 6 cell proportion pcs), and (iii) both sets together. unique variance was computed using partial r 2 , representing the proportion of variance in each epiancer+ pc explained by one set of predictors after accounting for the other. practical example in the uthealth houston cohort, we conducted an analysis of bipolar case–control status, adjusting for sex, age, smoking status, five cell type proportion pcs, five control pcs, and 0, 2, 5, or 10 ancestry pcs calculated with epiancer + . this setup allowed us to compare the impact of including different numbers of ancestry pcs on the genomic inflation factor (λ). results we evaluated the performance of ancestry pcs in capturing genetic ancestry, comparing the original approach by barfield et al. [ 2 ] ( epiancorig ) with two adapted versions. the first adaptation step involved residualizing cpg data overlapping with snps to adjust for technical and biological confounders ( epiancer ). the second adaptation combined the residualized values with called genotypes from rs probes ( epiancer+ ). scatterplots when plotting ancestry pcs against each other, distinct ancestry groups should ideally form dense and separate clusters, while repeated samples from the same individuals should cluster closely together. in the bcbp-ocd cohort (fig. 1 a-c; figure s1-s3), all approaches visually distinguished ancestry groups in the first two pcs. notably, while the original approach ( epiancorig ) separated ancestry primarily along the second pc, both adapted approaches achieved separation along the first pc. in the top cohort (fig. 1 d-f; figure s4-s6), the epiancorig approach failed to separate ancestry groups. in contrast, epiancer successfully differentiated african and east asian samples, with further improvement using epiancer+ , separating all ancestry groups. in the gtp cohort, both the epiancorig and adapted approaches differentiate ancestry group, with no major observable differences between them (figures. 1 g-i and s7-s9). in the uthealth houston cohort, the epiancorig approach appears to produce slightly clearer separations and denser clusters compared to the adapted approaches (figs. 1 j-l and s10-s12). fig. 1 scatterplots of the first two ancestry pcs plotted against each other, calculated using different approaches. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur european, lat latin american, pi pacific islander , sas south asian full size image association between the ancestry pcs and the ancestry groups to optimally adjust for ancestry, a strong association between ancestry pcs and ancestry groups is needed, particularly for the first ancestry pc. in the bcbp-ocd cohort (fig. 2 a, table s1a), both adapted approaches had a much stronger association between the first ancestry pc and the ancestry groups (both p = 1.47e-20) compared to the epiancorig approach (p = 0.032), aligning with the observations in the scatterplots (fig. 1 a-c). the epiancorig approach showed the strongest association only with the second ancestry pc (p = 1.47e-20), while epiancer+ (p = 1.68e-09) had a stronger association than epiancer (p = 0.001) for the second ancestry pc. fig. 2 association between the first three ancestry pcs and the ancestry groups. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort (fig. 2 b, table s1b), the strongest association between the first ancestry pc and the ancestry groups was observed for epiancer+ (p = 1.15e-22), followed by epiancer (p = 2.19e-10), while there was no association with the epiancorig approach (p = 1). the epiancorig approach showed a significant association only for the third ancestry pc (p = 6.62e-13). in the gtp cohort, there was no notable difference in the association between the first ancestry pc and ancestry groups (fig. 2 c, table s1c), while in the uthealth houston cohort, the first ancestry pc from the epiancorig approach showed stronger associations with ancestry groups than the adapted approaches (fig. 2 d, table s1d). repeated sample clustering we next assessed the clustering of repeated samples from the same individuals when plotting ancestry pcs against each other. this analysis was done in both the bcbp-ocd and top cohorts that included repeated samples. to quantify clustering, we used silhouette scores (higher scores indicate better clustering) and calculated the 3d distances from the repeated sample to the 3d centroid of the respective individual. repeated samples should cluster closely together, as genetic ancestry remains consistent over time. in the bcbp-ocd cohort, repeated samples clustered more tightly using the adapted approaches compared to the epiancorig approach. this was reflected in higher silhouette scores (fig. 3 a, table s2a) and smaller distances to the individual’s centroid (fig. 3 b, table s2b). there was little difference between epiancer and epiancer+ . fig. 3 repeated sample clustering. clustering performance of repeated samples from individuals was tested using silhouette scores and 3d distance to the individual’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort, the epiancer+ approach resulted in the best clustering, with the highest average silhouette score (fig. 3 c, table s2a) and the smallest average distance to the centroid (fig. 3 d, table s2b). however, in the top cohort, only three individuals had repeated samples, with each having two samples. ancestry level clustering next, we assessed how well different ancestry groups cluster by plotting the first three ancestry pcs against each other. ideally, samples within the same ancestry group should cluster closely together, while different ancestry groups should be well-separated. clustering was quantified with silhouette scores and 3d distances both between ancestry clusters and within clusters (from the samples to the respective centroid of the individual). in the bcbp-ocd cohort, the silhouette scores improved from the epiancorig approach (0.2419) to epiancer (0.2610) and showed only slight further improvement for epiancer+ (0.2693) (fig. 4 a, table s3a-b). the highest mean distances between ancestry clusters were observed with epiancer+ , followed by epiancer and the epiancorig approach (fig. 4 b, table s3c). distances within clusters presented a mixed picture: while most ancestry groups had tighter clusters with the adapted approaches, the south asian group showed a wider cluster (fig. 4 c, table s3c). fig. 4 ancestry group clustering. clustering performance of samples from different ancestries was tested using silhouette scores and 3d distance to the ancestry group’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur: european, lat latin american, pi pacific islander, sas south asian full size image in the top cohort, the average silhouette scores for epiancorig (0.06964) and epiancer (0.01417) were lower than for epiancer+ (0.25019) (fig. 4 d, table s3a). clustering varied across ancestry groups, with european, east asian, and african ancestries showing the best clustering under epiancer+ , as indicated by higher silhouette scores (fig. 4 d, table s3b), slightly higher distances between the ancestry clusters (fig. 4 e, table s3c), and lower distances of samples to the cluster centroid (fig. 4 f, table s3c) compared to the other approaches. in the gtp cohort (fig. 45g-i, table s3a-c), the epiancorig approach produced the highest silhouette score (0.5990), followed by epiancer+ (0.5732) and epiancer (0.5579). this result was primarily driven by larger distances between clusters in the epiancorig approach, followed by epiancer+ and epiancer . in the uthealth houston cohort (fig. 4 j-l, table s3a-c), the epiancorig approach also showed the highest silhouette score (0.07268), compared to epiancer+ (-0.0567) and epiancer (-0.0083). this was mainly due to larger distances between the african ancestry cluster to the other clusters and smaller distances within the asian cluster under the epiancorig approach. comparison with dna methylation pcs (dnampcs) and surrogate variables (svs) we compared the performance of epiancer+ with dnampcs and svs in the bcbp-ocd cohort. epiancer+ consistently outperformed both approaches. visually, it produced better clustering of samples (figure s13), which was reflected in a higher mean silhouette score ( epiancer+ : 0.293; svs: -0.226; dnampcs: -0.245). statistically, the first epiancer+ pc showed a strong association with ancestry groups, whereas only the third dnampc and sv demonstrated ancestry association, and with lower significance (table s 1 e (supplementary), figure s14). for repeated samples from the same individual, epiancer+ again performed better, achieving a higher mean 3d silhouette score (0.325) compared with dnampcs (-0.599) and svs (-0.603). association of ancestry groups with genotyping pcs for dna methylation-based ancestry pcs to effectively capture genetic background information, they should exhibit a strong correlation with genotyping pcs, especially between the first ancestry pc and the first genotyping pc, as both are expected to account for the majority of genetic variation. pearson correlation analysis was performed between ancestry and genotyping pcs in the bcbp-ocd cohort, which had readily available genotyping data. importantly, both adapted approaches ( epiancer and epiancer+ ) showed a strong correlation between the first ancestry pc and the first genotyping pc (r = 0.875, fig. 5 b-c). in contrast, the epiancorig approach showed no correlation between the first ancestry pc and the first genotyping pc (r = 0.001, fig. 5 a). the mean correlation of the first three genotyping pcs with the first three ancestry pcs was highest for epiancer+ (mean r = 0.173), followed by epiancer (mean r = 0.156), and lowest for the epiancorig approach (mean r = 0.146). fig. 5 correlation between the first three ancestry pcs and the first three genotyping pcs. correlation analyses were performed in the bcbp-ocd cohort. ancestry pcs are referred to as pcs 1–3 and genotyping pcs as gt_pc1-3. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the gtp cohort, partial r 2 analyses showed that epiancer+ pc1 captured substantial true ancestry signal (94.4%) but also retained variance explained by residualized covariates (40.5%). pc2 was minimally associated with ancestry (0.5%) or residualized factors (3.4%). pc3 was predominantly explained by residualized variables (49.4%) and showed little ancestry signal (1.1%). these results indicate that, while pc1 largely reflects true ancestry, some pc3 is strongly influenced by residualized technical and biological variation. this pattern is consistent with an unbalanced experimental design that induces correlations between ancestry and residualized factors. ancestry group associations with technical and biological adjustment factors to assess potential confounding, we tested whether factors adjusted for during residualization (sex, age, cell type proportions, and control probe pcs) were associated with ancestry groups, as such associations could inadvertently reduce true ancestry signals if these factors are unevenly distributed across batches or groups. in the bcbp-ocd cohort, none of the factors included in the residualization step were associated with ancestry groups (table s4a). in the top cohort, sex, several cell type proportion pcs (1, 2, 4, 5) but only the sixth control probe pc showed significant associations with ancestry groups (table s4b). in the gtp cohort, age, the second, fourth, and ninth control probe pcs, and the first and second cell type proportion pcs were significantly associated with ancestry groups (table s4c). in the uthealth houston cohort, the first and second cell type pcs were significantly associated with ancestry groups as well, along with the eighth to tenth control probe pcs (table s4d). practical example in the uthealth houston cohort, we analyzed bipolar case–control status while adjusting for varying numbers of ancestry pcs calculated with epiancer+ . the genomic inflation factor (λ) is ideally close to 1, as values above 1 may indicate population stratification or other confounding effects. without adjusting for any ancestry pcs, λ was 1.087. adding 2 ancestry pcs reduced λ to 1.023, and adding 5 ancestry pcs further reduced it to 1.008. however, adding 10 ancestry pcs increased λ slightly to 1.056. these results indicate that adjusting for ancestry pcs effectively reduces batch effects introduced by ancestry, with 5 pcs being optimal in this case. including more pcs than necessary (as with 10 pcs here) can reintroduce noise. discussion we demonstrated that adjusting for genetic ancestry in dna methylation studies by residualizing beta values for known technical and biological factors - prior to calculating ancestry principal components from cpgs overlapping with snps - and integrating the residualized data with genotype calls from the snp probes present on the arrays, improves accuracy compared to the method proposed by barfield et al. (2014) [ 2 ]. in the bcbp-ocd and top cohorts, we observed the same issues that were reported with the original approach by barfield et al. (2014) [ 2 ]: the first ancestry pc calculated using this approach showed weak associations with the ancestry groups, while stronger associations only emerged for the second or third ancestry pcs. there was a lack of correlation between the first genotyping pc and the first ancestry pc. thus, these findings suggest that the first ancestry pc calculated with the barfield et al. [ 2 ] approach, and in some cases even the second ancestry pc, mostly capture influences on dna methylation that are unrelated to ancestry or genetic background. several tests were conducted to assess the performance of the adapted approach compared to the original approach. the results indicated that the adapted approach substantially removed technical and biological variance, particularly in the bcbp-ocd and top cohorts. importantly, the association between the first ancestry pc and different ancestry groups was stronger using the adapted approach. while the addition of called genotypes to the residualization step did not substantially affect results in the bcbp-ocd cohort, the top cohort showed a stronger association between the first ancestry pc and the ancestry groups when called genotypes were included. this highlights that incorporating called genotypes can improve the robustness, especially in cohorts with larger technical effects. a key indicator of the adapted approach’s performance is its ability to cluster repeated samples from the same individuals more closely than the original approach. this is demonstrated by higher silhouette scores, a measure of clustering performance, and tighter clustering, indicated by smaller distances to the centroid within each individual’s cluster, in both the bcbp-ocd and top cohorts. since genetic ancestry is consistent over time, repeated samples should cluster tightly together. the tighter clustering observed with the adapted approach aligns with our expectations, as the original approach is affected by technical and biological influences, such as differing plate positions and variations in cell type estimations across samples from the same individual; the adapted approach effectively corrects for these influences, resulting in more accurate ancestry estimations. in addition to improved individual-level clustering, the different ancestry groups also showed better clustering when plotting ancestry pcs against one another. in the top cohort, where batch effects were more pronounced, incorporating called genotypes resulted in higher silhouette scores compared to using the residualized data alone. in contrast, in the bcbp-ocd cohort, where batch effects were less pronounced, the addition of genotypes had minimal impact on clustering performance at the ancestry group level. the tightness of clusters, measured as the distances of samples to their respective ancestry cluster centroids, yielded mixed results across different ancestry groups. this variability may reflect the adapted approach’s ability to capture greater genetic diversity within ancestry groups when confounding factors are appropriately adjusted for. finally, the adapted approach demonstrated a strong correlation (r = 0.875) between the first ancestry pcs and the first genotyping pc in the bcbp-ocd cohort, whereas no such correlation was observed with the original approach. the first genotyping pc captures most genetic background, which demonstrates the ability of the first ancestry pc to also capture most of the genetic variability. moreover, when examining the mean correlation of the first three ancestry pcs with the first three genotyping pcs, the adapted approach including the called genotypes showed the highest correlations of the compared approaches, capturing more true genetic information. in the bcbp-ocd cohort, epiancer+ showed clearly superior performance compared with dna methylation pcs (dnampcs) and surrogate variables (svs), demonstrating stronger statistical associations with ancestry, better clustering of ancestry groups, and improved clustering of repeated samples. overall, epiancer+ is more effective at capturing true ancestry effects, whereas dnampcs are more likely to capture technical noise and svs tend to reflect other non-ancestry influences. the adjusted method did not perform better for the gtp and uthealth houston cohorts. our partial r 2 analysis in the gtp cohort provides quantitative support for this observation: while epiancer+ pc1 retained strong ancestry signal (94.4% variance explained by genotype pcs), it also contained substantial variance from residualized covariates (40.5%), and pc3 was largely driven by residualized variables (49.4%) with minimal ancestry signal (1.1%). this pattern is consistent with unbalanced study design, where technical and biological covariates are unevenly distributed across ancestry groups, creating correlations between ancestry and residualized factors. these results indicate that some ancestry effect is removed when correcting for biological and technical factors in the residualizing step, because these factors are themselves associated with ancestry. there is a balance between removing the effects of technical and biological factors and removing ancestry information associated with these factors. if batch effects are not too strong but still associated with ancestry, then ancestry clustering does not improve, as seen in the gtp and uthealth houston cohorts. in contrast, substantial improvements are observed in cohorts like the bcbp-ocd cohort, where there is little to no association between ancestry and the factors adjusted for during residualization. similarly, in the top cohort, which has large technical batch effects, residualization had an improving effect despite the removal of some ancestry-related information. the actual performance is sample-specific and depends on the study design, but the method is applicable across a range of sample sizes. thus, it is important to take more care in designing the studies so that technical factors are not associated with ancestry (by a randomized design, balancing ancestry across plates, slides, and slide positions) and that sex and age are as balanced as possible across ancestries. this makes it possible for the residualization step to effectively remove influencing factors while preserving the ancestry effects. limitations one limitation is the relatively low overall mean correlation between the first three ancestry pcs and the first three genotyping pcs (mean r = 0.173 for the adapted approach including the genotypic data), suggesting that it does not fully capture all genotyping effects. however, the high correlation between the first ancestry pc and the first genotyping pc (r = 0.875) indicates that the approach effectively captures most of the genetic variation. despite this, genotyping data remains the gold standard for accurately capturing genetic ancestry and should be used whenever available to adjust for genetic background in dna methylation studies. expanding the coverage of illumina dna methylation arrays to include more sites overlapping with snp probes specifically designed to capture ancestry could enhance the ancestry signal derived from these arrays and improve alignment with genotyping pcs; however, in the design of the epic v2, a substantial number of snp-associated methylation probes were removed (selected ancestry-informative probes: 450 k: n = 7295; epic v1: n = 3622; epic v2: n = 2674). another limitation is that the precision of the performance testing may be affected by the fact that our approach was primarily tested on european samples, with fewer available samples from other ancestries. furthermore, the uthealth houston cohort relied on self-reported ancestry data, which is known to be less accurate and may have led to the inclusion of individuals with mixed or misclassified genetic ancestry. additionally, while "latino" is officially recognized as an ethnicity rather than a genetic ancestry group, we used it in our analysis as a label for an ancestry cluster. this cluster reflects admixed genetic backgrounds - typically indigenous american, european, and african - commonly seen in individuals self-identifying as latino. additionally, the longer runtime of our approach presents a practical limitation, primarily due to the detection p-value calculation step. however, this issue can be mitigated by providing pre-calculated detection p-values as input to the function (if already calculated), significantly reducing processing time. we considered comparing the performance of epiancer+ with epistructure [ 4 ]; however, epistructure has not been updated for the latest arrays and is therefore unlikely to perform reliably on our data. practical implications epiancer+ can be used to adjust for ancestry in all samples, even when technical factors correlate with ancestry, as it successfully clustered samples based on ancestry across all tested datasets. importantly, in cohorts where ancestry is correlated with technical and biological effects, our method ensures that ancestry is not accounted for twice. unlike the method by barfield et al. [ 2 ], which risks collinearity by adjusting for ancestry alongside confounding factors, our adapted method estimates the remaining ancestry effect while preserving relevant variation. compared to epistructure [ 4 ], epiancer+ offers improved usability and compatibility. epistructure is implemented in python within the glint framework and requires multiple preprocessing steps, limiting its integration with standard r-based pipelines. moreover, it has not been updated since 2017 and does not support the epic v2 array. epiancer+ , by contrast, is r-based and supports all major array types (450 k, epic v1, epic v2). ancestry pcs should be calculated only for samples that have passed general quality control. based on our experience, including one or two ancestry pcs is often sufficient for most analyses, though the number required depends on cohort diversity. in highly heterogeneous populations, additional ancestry pcs may be necessary. we recommend testing different models (e.g., using 2, 5, or 10 ancestry pcs) and evaluating their performance using qq plots and genomic inflation factor (λ), as demonstrated in the practical example in the results section. the optimal number of pcs is the one that brings λ closest to 1.0 and gives qq plots with no evidence of inflation, indicating adequate correction for population stratification without overfitting. conclusions adequate adjustment for genetic ancestry is essential in dna methylation studies. when genotyping data is unavailable, it has been suggested to use dna methylation data from illumina arrays overlapping with snps as an alternative. we have improved this approach by accounting for technical and biological influences and incorporating genotypic data from snp probes, offering increased robustness. our adapted approach ( epiancer+ ) is easy to implement in existing r pipelines, including the ones for the epic v2 array, and offers a practical solution for ancestry adjustment. data availability no datasets were generated or analysed during the current study. references breeze ce, beck s, berndt si, franceschini n. the missing diversity in human epigenomic studies. nat genet. 2022;54(6):737–9. article cas pubmed pubmed central google scholar barfield rt, almli lm, kilaru v, smith ak, mercer kb, duncan r, et al. accounting for population stratification in dna methylation studies. genet epidemiol. 2014;38(3):231–41. article pubmed pubmed central google scholar auton a, brooks ld, durbin rm, garrison ep, kang hm, et al. a global reference for human genetic variation (genomes project consortium ). nature. 2015;526(7571):68–74. article pubmed google scholar rahmani e, shenhav l, schweiger r, yousefi p, huen k, eskenazi b, et al. genome-wide methylation data mirror ancestry information. epigenetics chromatin. 2017;10:1. article pubmed pubmed central google scholar wortinger la, stavrum ak, shadrin aa, szabo a, rukke sh, nerland s, et al. divergent epigenetic responses to perinatal asphyxia in severe mental disorders. transl psychiatry. 2024;8(14):16. article google scholar engh ja, friis s, birkenaes ab, jónsdóttir h, klungsøyr o, ringen pa, et al. delusions are associated with poor cognitive insight in schizophrenia. schizophr bull. 2010;36(4):830–5. article pubmed google scholar simonsen c, sundet k, vaskinn a, birkenaes ab, engh ja, faerden a, et al. neurocognitive dysfunction in bipolar and schizophrenia spectrum disorders depends on history of psychosis rather than diagnostic group. schizophr bull. 2011;37(1):73–83. article pubmed google scholar mirza s, lima cnc, del favero-campbell a, rubinstein a, topolski n, cabrera-mendoza b, et al. blood epigenome-wide association studies of suicide attempt in adults with bipolar disorder. transl psychiatry. 2024;14(1):70. article cas pubmed pubmed central google scholar gillespie cf, bradley b, mercer k, smith ak, conneely k, gapen m, et al. trauma exposure and stress-related disorders in inner city primary care patients. gen hosp psychiatry. 2009;31(6):505–14. article pubmed pubmed central google scholar aryee mj, jaffe ae, corrada-bravo h, ladd-acosta c, feinberg ap, hansen kd, et al. minfi: a flexible and comprehensive bioconductor package for the analysis of infinium dna methylation microarrays. bioinformatics. 2014;30(10):1363–9. article cas pubmed pubmed central google scholar just ac, heiss ja. ewastools: ewas tools. 2023. pidsley r, wong ccy, volta m, lunnon k, mill j, schalkwyk lc. a data-driven approach to preprocessing illumina 450k methylation array data. bmc genomics. 2013;1(14):293. article google scholar zheng sc, webster ap, dong d, feber a, graham dg, sullivan r, et al. a novel cell-type deconvolution algorithm reveals substantial contamination by immune cells in saliva. buccal cervix epigenomics. 2018;10(7):925–40. article cas pubmed google scholar salas la, koestler dc. flowsorted.blood.epic: illumina epic data on immunomagnetic sorted peripheral adult blood cells. [internet]. 2024. available from: https://github.com/immunomethylomics/flowsorted.blood.epic katrinli s, wani ah, maihofer ax, ratanatharathorn a, daskalakis np, montalvo-ortiz j, et al. epigenome-wide association studies identify novel dna methylation sites associated with ptsd: a meta-analysis of 23 military and civilian cohorts. genome med. 2024;16(1):147. article cas pubmed pubmed central google scholar teschendorff ae, breeze ce, zheng sc, beck s. a comparison of reference-based algorithms for correcting cell-type heterogeneity in epigenome-wide association studies. bmc bioinform. 2017;18(1):105. article google scholar salas la, koestler dc, butler ra, hansen hm, wiencke jk, kelsey kt, et al. an optimized library for reference-based deconvolution of whole-blood biospecimens assayed using the illumina humanmethylationepic beadarray. genome biol. 2018;19(1):64. article pubmed pubmed central google scholar houseman ea, accomando wp, koestler dc, christensen bc, marsit cj, nelson hh, et al. dna methylation arrays as surrogate measures of cell mixture distribution. bmc bioinform. 2012;13(1):86. article google scholar strom ni, gerring zf, galimberti m, yu d, halvorsen mw, abdellaoui a, et al. genome-wide analyses identify 30 loci associated with obsessive-compulsive disorder [internet]. medrxiv; 2025 [cited 2025 may 1]. p. 2024.03.13.24304161. available from: https://www.medrxiv.org/content/ . https://doi.org/10.1101/2024.03.13.24304161v2 halvorsen mw, de schipper e, bäckman j, strom ni, hagen k, lindblad-toh k, et al. a burden of rare copy number variants in obsessive-compulsive disorder. mol psychiatry. 2025;30(4):1510–7. article cas pubmed google scholar werner mcf, wirgenes kv, shadrin a, lunding sh, rødevand l, hjell g, et al. immune marker levels in severe mental disorders: associations with polygenic risk scores of related mental phenotypes and psoriasis. transl psychiatry. 2022;12(1):38. article cas pubmed pubmed central google scholar nievergelt cm, maihofer ax, klengel t, atkinson eg, chen cy, choi kw, et al. international meta-analysis of ptsd genome-wide association studies identifies sex- and ancestry-specific genetic risk loci. nat commun. 2019;10(1):4558. article pubmed pubmed central google scholar tian y, morris tj, webster ap, yang z, beck s, feber a, et al. champ: updated methylation analysis pipeline for illumina beadchips. bioinformatics. 2017;33(24):3982–4. article cas pubmed pubmed central google scholar hansen kd. illuminahumanmethylation450kanno.ilmn12.hg19: annotation for illumina’s 450k methylation arrays. 2021. pidsley r, zotenko e, peters tj, lawrence mg, risbridger gp, molloy p, et al. critical evaluation of the illumina methylationepic beadchip microarray for whole-genome dna methylation profiling. genome biol. 2016;17(1):208. article pubmed pubmed central google scholar zhang z, zeng c, zhang w. characterization of the illumina epic array for optimal applications in epigenetic research targeting diverse human populations. epigenetics commun. 2022;1(2):7. article google scholar infinium methylationepic v2.0 product files [internet]. [cited 2024 nov 28]. available from: https://support.illumina.com/downloads/infinium-methylationepic-v2-0-product-files.html rousseeuw pj. silhouettes: a graphical aid to the interpretation and validation of cluster analysis. j comput appl math. 1987;1(20):53–65. article google scholar maechler m, rousseeuw p, struyf a, hubert m, hornik k. cluster: cluster analysis basics and extensions [internet]. 2023. available from: https://cran.r-project.org/package=cluster wickham h. ggplot2: elegant graphics for data analysis [internet]. new york, ny: springer; 2009 [cited 2023 may 22]. available from: https://link.springer.com/ https://doi.org/10.1007/978-0-387-98141-3 wilke co. cowplot: streamlined plot theme and plot annotations for ‘ggplot2’ [internet]. 2024. available from: https://wilkelab.org/cowplot/ pedersen tl. patchwork: the composer of plots [internet]. 2024. available from: https://patchwork.data-imaginist.com inc pt. collaborative data science [internet]. montreal, qc: plotly technologies inc.; 2015. available from: https://plot.ly vaidyanathan r, xie y, allaire jj, cheng j, sievert c, russell k. htmlwidgets: html widgets for r [internet]. 2023. available from: https://cran.r-project.org/package=htmlwidgets wei t, simko v. r package ‘corrplot’: visualization of a correlation matrix [internet]. 2024. available from: https://github.com/taiyun/corrplot download references acknowledgements we thank all individuals who have provided samples for this study. in bergen, our sincere thanks go to helene nilsen, marie karin bjorøy, and lisa vårdal for organizing the samples, as well as to nadine fricker from life&brain for her exceptional service. we thank all clinicians for their support in participant recruitment, and we appreciate the technical support of all the staff, volunteers and participants from the grady trauma project. grammar corrections in this manuscript were assisted by gpt-4o (openai). funding open access funding provided by university of bergen. this work was performed on the safe facilities owned by the university of bergen and the tsd (tjeneste for sensitive data) facilities, owned by the university of oslo, operated and developed by the tsd service group at the university of oslo, it-department (usit) (tsd-drift@usit.uio.no). the authors would like to acknowledge support from: the research council of norway (rcn) for the top cohort (273291, 273446, 326813, 223273, 324499, 324252), the trond mohn foundation, nimh r01mh110427, and stiftelsen kristian gerhard jebsen (skgj med-02) for the bcbp-ocd cohort, and grants from the john s. dunn foundation and pat rutherford chair in psychiatry at uthealth houston. kdh was supported by a phd fellowship from the university of bergen. ak smith was supported by 2r01mh108826 and sk by k12hd085850 from nih. grf is supported by k01mh121580 from nimh. the funders did not have a role in design, analysis or publication. author information authors and affiliations department for clinical medicine, university of bergen, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum, jan haavik, kristen hagen, bjarne hansen & stéphanie le hellard dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard department of psychiatry, mclean hospital, harvard medical school, belmont, ma, usa kira d. höffler & kerry ressler department of gynecology and obstetrics, emory university, atlanta, ga, usa seyma katrinli & alicia k. smith department of genetics, university of north carolina at chapel hill, chapel hill, nc, usa matthew w. halvorsen & james j. crowley center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway kevin s. o’connell, alexey shadrin, srdjan djurovic & ole a. andreassen department of medical genetics, oslo university hospital and university of oslo, oslo, norway kevin s. o’connell, alexey shadrin & srdjan djurovic section for precision psychiatry, oslo university hospital, oslo, norway alexey shadrin & ole a. andreassen department of psychiatry, university of north carolina at chapel hill, chapel hill, nc, usa james j. crowley department of biomedicine, university of bergen, bergen, norway jan haavik department of psychiatry, møre and romsdal hospital trust, molde, norway kristen hagen department of mental health, norwegian university of science and technology, trondheim, norway kristen hagen department of clinical psychology, university of bergen, bergen, norway gerd kvale center for crisis psychology, university of bergen, bergen, norway bjarne hansen faillace department of psychiatry and behavioral sciences, mcgovern medical school, the university of texas health science center at houston, houston, tx, usa jair c. soares & gabriel r. fries department of psychiatry and behavioral sciences, emory university, atlanta, ga, usa alicia k. smith authors kira d. höffler view author publications search author on: pubmed google scholar seyma katrinli view author publications search author on: pubmed google scholar matthew w. halvorsen view author publications search author on: pubmed google scholar anne-kristin stavrum view author publications search author on: pubmed google scholar kevin s. o’connell view author publications search author on: pubmed google scholar alexey shadrin view author publications search author on: pubmed google scholar srdjan djurovic view author publications search author on: pubmed google scholar ole a. andreassen view author publications search author on: pubmed google scholar james j. crowley view author publications search author on: pubmed google scholar jan haavik view author publications search author on: pubmed google scholar kristen hagen view author publications search author on: pubmed google scholar gerd kvale view author publications search author on: pubmed google scholar kerry ressler view author publications search author on: pubmed google scholar bjarne hansen view author publications search author on: pubmed google scholar jair c. soares view author publications search author on: pubmed google scholar gabriel r. fries view author publications search author on: pubmed google scholar alicia k. smith view author publications search author on: pubmed google scholar stéphanie le hellard view author publications search author on: pubmed google scholar contributions kd hoeffler, ak stavrum, and slh contributed to the design of the study. kd hoeffler developed the adapted approach and, together with sk and grf, tested it in the cohorts. mwh, kso, and a. shadrin performed genotyping quality control and ancestry prediction. sd and k. hagen were responsible for data acquisition. oaa, jjc, jh, gk, bh, jcs, ak smith, and slh served as site principal investigators and contributed data. ak stavrum, tk, kr, and slh supervised the research progress. kd hoeffler was the main contributor to writing the manuscript. ak stavrum, slh, sk, and grf also contributed to writing the manuscript. all authors read, edited, and approved the final manuscript. corresponding authors correspondence to kira d. höffler or stéphanie le hellard . ethics declarations ethics approval and consent to participate the current project was approved ​​the regional committee for research ethics (top cohort: #2009/2485; bcbp-ocd cohort: #2019/1097, gtp was approved by the irbs of emory university school of medicine and the research oversight committee of grady memorial hospital, uthealth houston was approved by irb #hsc-ms-09–0340). all participants provided informed consent. competing interests oaa is a consultant to cortechs.ai and precision health as, and has received speakers' honorarium from lundbeck , otsuka , janssen , bms , and lilly . the other authors declare that they have no competing interests. additional information publisher's note springer nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations. supplementary information overview of supplementary materials: supplementary figure s1 supplementary figure s2 supplementary figure s3 supplementary figure s4 supplementary figure s5 supplementary figure s6 supplementary figure s7 supplementary figure s8 supplementary figure s9 supplementary figure s10 supplementary figure s11 supplementary figure s12 supplementary figure s13 supplementary figure s14 supplementary figure s15 supplementary table s1 supplementary table s2 supplementary table s3 rights and permissions open access this article is licensed under a creative commons attribution 4.0 international license, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the creative commons licence, and indicate if changes were made. the images or other third party material in this article are included in the article’s creative commons licence, unless indicated otherwise in a credit line to the material. if material is not included in the article’s creative commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. to view a copy of this licence, visit http://creativecommons.org/licenses/by/4.0/ . reprints and permissions about this article cite this article höffler, k.d., katrinli, s., halvorsen, m.w. et al. optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches. epigenetics & chromatin 18 , 69 (2025). https://doi.org/10.1186/s13072-025-00627-0 download citation received : 02 may 2025 accepted : 29 august 2025 published : 14 october 2025 doi : https://doi.org/10.1186/s13072-025-00627-0 share this article anyone you share the following link with will be able to read this content: get shareable link sorry, a shareable link is not currently available for this article. copy shareable link to clipboard provided by the springer nature sharedit content-sharing initiative keywords epigenetics dna methylation ancestry ewas mwas download pdf advertisement window.sn = window.sn || {}; window.sn.libs = window.sn.libs || {}; window.sn.libs.ads = window.sn.libs.ads || {}; window.sn.libs.ads.slotconfig = window.sn.libs.ads.slotconfig || {}; window.sn.libs.ads.slotconfig['mpu1'] = { 'pos': 'mpu1' }; window.sn.libs.ads.slotconfig['unitpath'] = '/270604982/bmc/epigeneticsandchromatin/articles'; window.sn.libs.ads.slotconfig['type'] = 'article'; window.sn.libs.ads.slotconfig['kwrd'] = 'epigenetics,dna methylation,ancestry,ewas,mwas'; window.sn.libs.ads.slotconfig['doi'] = '10.1186/s13072-025-00627-0'; window.sn.libs.ads.slotconfig['pmc'] = 'l32030,b12008,l32020,l16008,b12010,b12030'; epigenetics & chromatin issn: 1756-8935 contact us submission enquiries: journalsubmissions@springernature.com read more on our blogs receive bmc newsletters manage article alerts language editing for authors scientific editing for authors policies accessibility press center support and contact leave feedback careers follow bmc bmc twitter page bmc facebook page bmc weibo page by using this website, you agree to our terms and conditions , your us state privacy rights , privacy statement and cookies policy. your privacy choices/manage cookies we use in the preference centre. © 2025 biomed central ltd unless otherwise stated. part of springer nature .## Introduction
#fff;margin:0;max-width:100%;min-height:100%}button,div,form,input,p{margin:0;padding:0}body{padding:0}a{color:#004b83;text-decoration:underline;text-decoration-skip-ink:auto}a>img{vertical-align:middle}h1,h2{color:#1b3051;font-style:normal;font-weight:700}h1{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:28px;line-height:1.4}html.webfonts-loaded h1,html.webfonts-loaded h2,html.webfonts-loaded h3{font-family:europa,trebuchet ms}h2{font-size:26px;margin-bottom:.5em}h2,h3{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;line-height:1.4}h3{color:#1b3051;font-size:18px;font-style:normal;margin-bottom:.7em}.c-navbar{background:#f2f2f2;border-bottom:1px solid #d9d9d9;border-top:1px solid #d9d9d9;font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:14px;line-height:1.61803;padding:16px 0}.c-navbar--with-submit-button{padding-bottom:24px}@media only screen and (min-width:540px){.c-navbar--with-submit-button{padding-bottom:16px}}.c-navbar__container{display:flex;flex-wrap:wrap;justify-content:space-between;margin:0 auto;max-width:1280px;padding:0 16px}.c-navbar__content{display:flex;flex:0 1 auto}.c-navbar__nav{align-items:center;display:flex;flex-wrap:wrap;gap:16px 16px;list-style:none;margin:0;padding:0}.c-navbar__item{flex:0 0 auto}.c-navbar__link{background:0 0;border:0;color:currentcolor;display:block;text-decoration:none;text-transform:capitalize}.c-navbar__link--is-shown{text-decoration:underline}.c-ad{text-align:center}@media only screen and (min-width:320px){.c-ad{padding:8px}}.c-ad--728x90{background-color:#ccc;display:none}.c-ad--728x90 .c-ad__inner{min-height:calc(1.5em + 94px)}.c-ad--728x90 iframe{height:90px;max-width:970px}@media only screen and (min-width:768px){.js .c-ad--728x90{display:none}.js .u-show-following-ad+.c-ad--728x90{display:block}}.c-ad iframe{border:0;overflow:auto;vertical-align:top}.c-ad__label{color:#333;font-weight:400;line-height:1.5;margin-bottom:4px}.c-ad__label,.c-skip-link{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:.875rem}.c-skip-link{background:#dceaf6;bottom:auto;color:#004b83;padding:8px;position:absolute;text-align:center;transform:translatey(-100%);z-index:9999}@media (prefers-reduced-motion:reduce){.c-skip-link{transition:top .3s ease-in-out 0s}}@media print{.c-skip-link{display:none}}.c-skip-link:link{color:#004b83}.c-dropdown__button:after{border-color:transparent transparent transparent #fff;border-style:solid;border-width:4px 0 4px 14px;content:"";display:block;height:0;margin-left:3px;width:0}.c-dropdown{display:inline-block;position:relative}.c-dropdown__button{background-color:transparent;border:0;display:inline-block;padding:0;white-space:nowrap}.c-dropdown__button:after{border-color:currentcolor transparent transparent;border-width:5px 4px 0 5px;display:inline-block;margin-left:8px;vertical-align:middle}.c-dropdown__menu{background-color:#fff;border:1px solid #d9d9d9;border-radius:3px;box-shadow:0 2px 6px rgba(0,0,0,.1);font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:14px;line-height:1.4;list-style:none;margin:0;padding:8px 0;position:absolute;top:100%;transform:translatey(8px);width:180px;z-index:100}.c-dropdown__menu:after,.c-dropdown__menu:before{border-style:solid;bottom:100%;content:"";display:block;height:0;left:16px;position:absolute;width:0}.c-dropdown__menu:before{border-color:transparent transparent #d9d9d9;border-width:0 9px 9px;transform:translatex(-1px)}.c-dropdown__menu:after{border-color:transparent transparent #fff;border-width:0 8px 8px}.c-dropdown__menu--right{left:auto;right:0}.c-dropdown__menu--right:after,.c-dropdown__menu--right:before{left:auto;right:16px}.c-dropdown__menu--right:before{transform:translatex(1px)}.c-dropdown__link{background-color:transparent;color:#004b83;display:block;padding:4px 16px}.c-header{background-color:#1b3051;border-bottom:4px solid #1b3051;font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:14px;padding:16px 0}.c-header__container,.c-header__menu{align-items:center;display:flex;flex-wrap:wrap}@supports (gap:2em){.c-header__container,.c-header__menu{gap:2em 2em}}.c-header__menu{list-style:none;margin:0;padding:0}.c-header__item{color:#fff}@supports not (gap:2em){.c-header__item{margin-left:24px}}.c-header__container{justify-content:space-between;margin:0 auto;max-width:1280px;padding:0 16px}@supports not (gap:2em){.c-header__brand{margin-right:48px}}.c-header__brand a{display:block;text-decoration:none}.c-header__link{color:#fff}.c-journal-title a{text-decoration:none}html.webfonts-loaded .c-journal-title{font-family:europa,trebuchet ms}.c-form-field{margin-bottom:1em}.c-form-field__label{color:#666;display:block;font-size:14px;margin-bottom:.4em}.c-form-field__input{border:1px solid #a6a6a6;border-radius:3px;box-shadow:inset 0 1px 3px 0 rgba(0,0,0,.21);font-size:14px;line-height:1.28571;padding:.75em 1em;vertical-align:middle;width:100%}.c-popup-search{background-color:#25426f;box-shadow:0 3px 3px -3px rgba(0,0,0,.21);padding:16px 0;position:relative;z-index:10}@media only screen and (min-width:1024px){.js .c-popup-search{position:absolute;top:100%;width:100%}.c-popup-search__container{margin:auto;max-width:70%}}.c-logo img{display:block}.ctx-search .c-form-field{margin-bottom:0}.ctx-search .c-form-field__label{color:#fff}.ctx-search .c-form-field__input{border-bottom-right-radius:0;border-top-right-radius:0;margin-right:0}.c-journal-header{overflow:hidden}.c-journal-header__inner{padding-bottom:8px;padding-top:8px}@media only screen and (min-width:540px){.c-journal-header__inner{display:flex;justify-content:space-between}}.c-journal-header__identity{background-size:auto 80px;min-height:16px;padding:6px 0}@media only screen and (min-width:540px){.c-journal-header__identity{background-position:0}}.c-journal-header__identity--default{background:url(/static/images/bmc/identities/patterns/default-7e3a6b1388.svg) 0 0 no-repeat #04caa8}.c-journal-title{color:#1b3051;display:flex;font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:26px;font-style:normal;font-weight:700;line-height:1.4;margin-bottom:0}.c-journal-title>a{color:#0061a9;color:#1b3051;display:flex;text-decoration:none}.c-journal-title__text{align-self:center;display:block;flex:0 1 auto}.c-logo,.c-logo>a{align-items:baseline;display:flex}.c-logo__strapline{display:none}@media only screen and (min-width:540px){.c-logo__strapline{display:block;margin:0 0 0 16px;transform:translatey(1px)}}.c-logo{display:block}html.webfonts-loaded .u-h3,html.webfonts-loaded .u-h4{font-family:europa,trebuchet ms}.u-button{align-items:center;background-color:#f2f2f2;background-image:linear-gradient(#fff,#f2f2f2);border:1px solid #ccc;border-radius:2px;cursor:pointer;display:inline-flex;font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:1rem;justify-content:center;line-height:1.3;margin:0;padding:8px;position:relative;text-decoration:none;transition:all .25s ease 0s,color .25s ease 0s,border-color .25s ease 0s;width:auto}.u-button svg,.u-button--primary svg,.u-button--tertiary svg{fill:currentcolor}.u-button{color:#004b83}.u-button--primary,.u-button--tertiary{background-color:#33629d;background-image:linear-gradient(#4d76a9,#33629d);border:1px solid rgba(0,59,132,.5);color:#fff}.u-button--tertiary{font-weight:400}.u-button--full-width{display:flex;width:100%}.u-clearfix:after,.u-clearfix:before{content:"";display:table}.u-clearfix:after{clear:both}.u-color-open-access{color:#b74616}.u-container{margin:0 auto;max-width:1280px;padding:0 16px}.u-display-flex{display:flex;width:100%}.u-align-items-center{align-items:center}.u-justify-content-space-between{justify-content:space-between}.u-flex-static{flex:0 0 auto}.u-display-none{display:none}.js .u-js-hide{display:none;visibility:hidden}@media print{.u-hide-print{display:none}}.u-icon{fill:currentcolor;display:inline-block;height:1em;transform:translate(0);vertical-align:text-top;width:1em}.u-list-reset{list-style:none;margin:0;padding:0}.u-position-relative{position:relative}.u-mt-32{margin-top:32px}.u-mr-24{margin-right:24px}.u-mr-48{margin-right:48px}.u-mb-32{margin-bottom:32px}.u-ml-8{margin-left:8px}.u-button-reset{background-color:transparent;border:0;padding:0}.u-text-sm{font-size:14px}.u-h3,.u-h4{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;line-height:1.4}.u-h3{color:#1b3051;font-size:18px;font-style:normal;margin-bottom:.7em}.u-h4{color:#1b3051;font-size:18px;font-style:italic;font-weight:700;margin-bottom:.7em}.u-vh-full{min-height:100vh}.u-hide{display:none;visibility:hidden}.u-hide:first-child+*{margin-block-start:0}@media only screen and (min-width:1024px){.u-hide-at-lg{display:none;visibility:hidden}}@media only screen and (max-width:1023px){.u-hide-at-lt-lg{display:none;visibility:hidden}.u-hide-at-lt-lg:first-child+*{margin-block-start:0}}.u-visually-hidden{clip:rect(0,0,0,0);border:0;height:1px;margin:-100%;overflow:hidden;padding:0;position:absolute!important;width:1px}.u-button--tertiary{font-size:.875rem;padding:8px 16px}@media only screen and (max-width:539px){.u-button--alt-colour-on-mobile{background-color:#f2f2f2;background-image:linear-gradient(#fff,#f2f2f2);border:1px solid #ccc;color:#004b83}}body{font-size:1.125rem}.c-header__navigation{display:flex;gap:.5rem .5rem} } @media only print, only all and (prefers-color-scheme: no-preference), only all and (prefers-color-scheme: light), only all and (prefers-color-scheme: dark) { button{line-height:inherit}html,label{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif}html{-webkit-font-smoothing:subpixel-antialiased;box-sizing:border-box;color:#333;font-size:100%;height:100%;line-height:1.61803;overflow-y:scroll}*{box-sizing:inherit}body{background:#fff;margin:0;max-width:100%;min-height:100%}button,div,form,input,p{margin:0;padding:0}body{padding:0}a{color:#004b83;overflow-wrap:break-word;text-decoration:underline;text-decoration-skip-ink:auto;word-break:break-word}a>img{vertical-align:middle}h1,h2{color:#1b3051;font-style:normal;font-weight:700}h1{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:28px;line-height:1.4}html.webfonts-loaded h1,html.webfonts-loaded h2,html.webfonts-loaded h3{font-family:europa,trebuchet ms}h2{font-size:26px;margin-bottom:.5em}h2,h3{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;line-height:1.4}h3{color:#1b3051;font-size:18px;font-style:normal;margin-bottom:.7em}p{overflow-wrap:break-word;word-break:break-word}.u-h3{font-size:1.5rem}.u-h3,.u-h4{font-weight:700}.u-h4{font-size:1.25rem}.c-reading-companion__figure-title{font-size:1.25rem;font-weight:700}body{font-size:1.125rem}.c-article-header{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;margin-bottom:40px}.c-article-identifiers{color:#6f6f6f;display:flex;flex-wrap:wrap;font-size:1rem;line-height:1.3;list-style:none;margin:0 0 8px;padding:0}.c-article-identifiers__item{border-right:1px solid #6f6f6f;list-style:none;margin-right:8px;padding-right:8px}.c-article-identifiers__item:last-child{border-right:0;margin-right:0;padding-right:0}.c-article-title{font-size:1.5rem;line-height:1.25;margin-bottom:16px}@media only screen and (min-width:768px){.c-article-title{font-size:1.875rem;line-height:1.2}}.c-article-author-list{display:inline;font-size:1rem;list-style:none;margin:0 8px 0 0;padding:0;width:100%}.c-article-author-list__item{display:inline;padding-right:0}.c-article-author-list svg{margin-left:4px}.c-article-author-list__show-more{display:none;margin-right:4px}.c-article-author-list__button,.js .c-article-author-list__item--hide,.js .c-article-author-list__show-more{display:none}.js .c-article-author-list--long .c-article-author-list__show-more,.js .c-article-author-list--long+.c-article-author-list__button{display:inline}@media only screen and (max-width:539px){.js .c-article-author-list__item--hide-small-screen{display:none}.js .c-article-author-list--short .c-article-author-list__show-more,.js .c-article-author-list--short+.c-article-author-list__button{display:inline}}#uptodate-client,.js .c-article-author-list--expanded .c-article-author-list__show-more{display:none!important}.js .c-article-author-list--expanded .c-article-author-list__item--hide-small-screen{display:inline!important}.c-article-author-list__button,.c-button-author-list{background:#ebf1f5;border:4px solid #ebf1f5;border-radius:20px;color:#666;font-size:.875rem;line-height:1.4;padding:2px 11px 2px 8px;text-decoration:none}.c-article-author-list__button svg,.c-button-author-list svg{margin:1px 4px 0 0}.c-article-author-list__button:hover,.c-button-author-list:hover{background:#173962;border-color:transparent;color:#fff}.c-article-info-details{font-size:1rem;margin-bottom:8px;margin-top:16px}.c-article-info-details__cite-as{border-left:1px solid #6f6f6f;margin-left:8px;padding-left:8px}.c-article-metrics-bar{display:flex;flex-wrap:wrap;font-size:1rem;line-height:1.3}.c-article-metrics-bar__wrapper{margin:0 0 16px}.c-article-metrics-bar__item{align-items:baseline;border-right:1px solid #6f6f6f;margin-right:8px}.c-article-metrics-bar__item:last-child{border-right:0}.c-article-metrics-bar__count{font-weight:700;margin:0}.c-article-metrics-bar__label{color:#626262;font-style:normal;font-weight:400;margin:0 10px 0 5px}.c-article-metrics-bar__details{margin:0}.c-article-main-column{font-family:georgia,palatino,serif;margin-right:8.6%;width:60.2%}@media only screen and (max-width:1023px){.c-article-main-column{margin-right:0;width:100%}}.c-article-extras{float:left;font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;width:31.2%}@media only screen and (max-width:1023px){.c-article-extras{display:none}}.c-article-associated-content__container .c-article-associated-content__title,.c-article-section__title{border-bottom:2px solid #d5d5d5;font-size:1.25rem;margin:0;padding-bottom:8px}@media only screen and (min-width:768px){.c-article-associated-content__container .c-article-associated-content__title,.c-article-section__title{font-size:1.5rem;line-height:1.24}}.c-article-associated-content__container .c-article-associated-content__title{margin-bottom:8px}.c-article-section{clear:both}.c-article-section__content{margin-bottom:40px;margin-top:0;padding-top:8px}@media only screen and (max-width:1023px){.c-article-section__content{padding-left:0}}.c-article__sub-heading{color:#222;font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif;font-size:1.125rem;font-style:normal;font-weight:400;line-height:1.3;margin:24px 0 8px}@media only screen and (min-width:768px){.c-article__sub-heading{font-size:1.5rem;line-height:1.24}}.c-article__sub-heading:first-child{margin-top:0}.c-article-authors-search{margin-bottom:24px;margin-top:0}.c-article-authors-search__item,.c-article-authors-search__title{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif}.c-article-authors-search__title{color:#626262;font-size:1.05rem;font-weight:700;margin:0;padding:0}.c-article-authors-search__item{font-size:1rem}.c-article-authors-search__text{margin:0}.c-article-share-box__no-sharelink-info{font-size:.813rem;font-weight:700;margin-bottom:24px;padding-top:4px}.c-article-share-box__only-read-input{border:1px solid #d5d5d5;box-sizing:content-box;display:inline-block;font-size:.875rem;font-weight:700;height:24px;margin-bottom:8px;padding:8px 10px}.c-article-share-box__button--link-like{background-color:transparent;border:0;color:#0067c5;cursor:pointer;font-size:.875rem;margin-bottom:8px;margin-left:10px}.c-article-associated-content__container .c-article-associated-content__collection-label{font-size:.875rem;line-height:1.4}.c-article-associated-content__container .c-article-associated-content__collection-title{line-height:1.3}.c-context-bar{box-shadow:0 0 10px 0 rgba(51,51,51,.2);position:relative;width:100%}.c-context-bar__title{display:none}.c-reading-companion{clear:both;min-height:389px}.c-reading-companion__sticky{max-width:389px}.c-reading-companion__scroll-pane{margin:0;min-height:200px;overflow:hidden auto}.c-reading-companion__tabs{display:flex;flex-flow:row nowrap;font-size:1rem;list-style:none;margin:0 0 8px;padding:0}.c-reading-companion__tabs>li{flex-grow:1}.c-reading-companion__tab{background-color:#eee;border:1px solid #d5d5d5;border-image:initial;border-left-width:0;color:#0067c5;font-size:1rem;padding:8px 8px 8px 15px;text-align:left;width:100%}.c-reading-companion__tabs li:first-child .c-reading-companion__tab{border-left-width:1px}.c-reading-companion__tab--active{background-color:#fff;border-bottom:1px solid #fff;color:#222;font-weight:700}.c-reading-companion__sections-list{list-style:none;padding:0}.c-reading-companion__figures-list,.c-reading-companion__references-list{list-style:none;min-height:389px;padding:0}.c-reading-companion__references-list--numeric{list-style:decimal inside}.c-reading-companion__sections-list{margin:0 0 8px;min-height:50px}.c-reading-companion__section-item{font-size:1rem;padding:0}.c-reading-companion__section-item a{display:block;line-height:1.5;overflow:hidden;padding:8px 0 8px 16px;text-overflow:ellipsis;white-space:nowrap}.c-reading-companion__figure-item{border-top:1px solid #d5d5d5;font-size:1rem;padding:16px 8px 16px 0}.c-reading-companion__figure-item:first-child{border-top:none;padding-top:8px}.c-reading-companion__reference-item{border-top:1px solid #d5d5d5;font-size:1rem;padding:8px 8px 8px 16px}.c-reading-companion__reference-item:first-child{border-top:none}.c-reading-companion__reference-item a{word-break:break-word}.c-reading-companion__reference-citation{display:inline}.c-reading-companion__reference-links{font-size:.813rem;font-weight:700;list-style:none;margin:8px 0 0;padding:0;text-align:right}.c-reading-companion__reference-links>a{display:inline-block;padding-left:8px}.c-reading-companion__reference-links>a:first-child{display:inline-block;padding-left:0}.c-reading-companion__figure-title{display:block;margin:0 0 8px}.c-reading-companion__figure-links{display:flex;justify-content:space-between;margin:8px 0 0}.c-reading-companion__figure-links>a{align-items:center;display:flex}.c-reading-companion__figure-full-link svg{height:.8em;margin-left:2px}.c-reading-companion__panel{border-top:none;display:none;margin-top:0;padding-top:0}.c-reading-companion__panel--active{display:block}.c-pdf-download__link .u-icon{padding-top:2px}.c-pdf-download{display:flex;margin-bottom:16px;max-height:48px}@media only screen and (min-width:540px){.c-pdf-download{max-height:none}}@media only screen and (min-width:1024px){.c-pdf-download{max-height:48px}}.c-pdf-download__link{display:flex;flex:1 1 0%;padding:13px 24px!important}.c-pdf-download__text{padding-right:4px}@media only screen and (max-width:539px){.c-pdf-download__text{text-transform:capitalize}}@media only screen and (min-width:540px){.c-pdf-download__text{padding-right:8px}}.c-pdf-container{display:flex;justify-content:flex-end}@media only screen and (max-width:539px){.c-pdf-container .c-pdf-download{display:flex;flex-basis:100%}}.c-article-associated-content__container a,.c-card__summary a{text-decoration:underline}.u-display-none{display:none}.js .u-js-hide,.u-hide{display:none;visibility:hidden}.u-hide:first-child+*{margin-block-start:0}.u-visually-hidden{clip:rect(0,0,0,0);border:0;height:1px;margin:-100%;overflow:hidden;padding:0;position:absolute!important;width:1px}@media print{.u-hide-print{display:none}}@media only screen and (min-width:1024px){.u-hide-at-lg{display:none;visibility:hidden}}.u-icon{fill:currentcolor;display:inline-block;height:1em;transform:translate(0);vertical-align:text-top;width:1em}.u-list-reset{list-style:none;margin:0;padding:0}.hide{display:none;visibility:hidden}.c-article-associated-content__container .c-article-associated-content__collection.collection~.c-article-associated-content__collection.collection .c-article-associated-content__collection-label,.c-article-associated-content__container .c-article-associated-content__collection.section~.c-article-associated-content__collection.section .c-article-associated-content__collection-label,.c-article-associated-content__container .c-article-associated-content__title{display:none}.c-article-associated-content__container .c-article-associated-content__collection.collection .c-article-associated-content__collection-label,.c-article-associated-content__container .c-article-associated-content__collection.section .c-article-associated-content__collection-label{display:block}.c-article-associated-content__container .c-article-associated-content__collection.collection,.c-article-associated-content__container .c-article-associated-content__collection.section{margin-bottom:5px}.c-article-associated-content__container .c-article-associated-content__collection.section~.c-article-associated-content__collection.collection{margin-top:28px}.c-article-associated-content__container .c-article-associated-content__collection:first-child{margin-top:0}.c-article-associated-content__container .c-article-associated-content__collection:last-child{margin-bottom:2.4rem}.c-article-associated-content__container .c-article-associated-content__collection-label{color:#1b3051}.c-article-associated-content__container .c-article-associated-content__collection-title{font-size:1.063rem;font-weight:400}.webfonts-loaded .c-article__sub-heading{font-family:-apple-system,blinkmacsystemfont,segoe ui,roboto,oxygen-sans,ubuntu,cantarell,helvetica neue,sans-serif} } config = { env: 'live', site: 'epigeneticsandchromatin.biomedcentral.com', sitewithpath: 'epigeneticsandchromatin.biomedcentral.com' + window.location.pathname, twitterhashtag: '', cmsprefix: 'https://studio-cms.springernature.com/studio/', doi: '10.1186/s13072-025-00627-0', figsharescripturl: 'https://widgets.figshare.com/static/figshare.js', hasfigshareinvoked: false, publisherbrand: 'biomed central', mustardcut: false }; window.datalayer = [{"content":{"article":{"doi":"10.1186/s13072-025-00627-0","articletype":"methodology","peerreviewtype":"closed","supplement":null,"keywords":"epigenetics;dna methylation;ancestry;ewas;mwas"},"contentinfo":{"imprint":"biomed central","title":"optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches","publishedat":1760400000000,"publishedatdate":"2025-10-14","author":["kira d. höffler","seyma katrinli","matthew w. halvorsen","anne-kristin stavrum","kevin s. o’connell","alexey shadrin","srdjan djurovic","ole a. andreassen","james j. crowley","jan haavik","kristen hagen","gerd kvale","kerry ressler","bjarne hansen","jair c. soares","gabriel r. fries","alicia k. smith","stéphanie le hellard"],"collection":[]},"attributes":{"deliveryplatform":"oscar","template":"rebrand","cms":null,"copyright":{"creativecommonstype":"cc by","openaccess":true},"environment":"live"},"journal":{"sitekey":"epigeneticsandchromatin.biomedcentral.com","volume":"18","issue":"1","title":"epigenetics & chromatin","type":"bmc ajs","journalid":13072,"section":[]},"category":{"pmc":{"primarysubject":"life sciences"},"contenttype":"methodology","publishingsegment":"bmc aj1","snt":["genetics and genomics","medical genetics","plant genetics","cell biology","molecular genetics"]}},"session":{"authentication":{"authenticationid":[]}},"version":"1.0.0","page":{"category":{"pagetype":"article"},"attributes":{"featureflags":[],"environment":"live","darwin":false}},"japan":false,"event":"datalayercreated","collection":null,"publisherbrand":"biomed central"}]; window.datalayer = window.datalayer || []; window.datalayer.push({ ga4measurementid: 'g-pjctjwpv25', ga360trackingid: 'ua-54492316-9', twitterid: 'o47a2', baiduid: 'd1b4bc3b5ada4eb7290535e72899bac1', ga4serverurl: 'https://collect.biomedcentral.com', imprint: 'biomedcentral' }); (function(w, d) { w.config = w.config || {}; w.config.mustardcut = false; if (w.matchmedia && w.matchmedia('only print, only all and (prefers-color-scheme: no-preference), only all and (prefers-color-scheme: light), only all and (prefers-color-scheme: dark)').matches) { w.config.mustardcut = true; d.classlist.add('js'); d.classlist.remove('grade-c'); d.classlist.remove('no-js'); } })(window, document.documentelement); (function () { if ( typeof window.customevent === "function" ) return false; function customevent ( event, params ) { params = params || { bubbles: false, cancelable: false, detail: null }; var evt = document.createevent( 'customevent' ); evt.initcustomevent( event, params.bubbles, params.cancelable, params.detail ); return evt; } customevent.prototype = window.event.prototype; window.customevent = customevent; })(); if (window.config.mustardcut) { (function(w, d) { window.component = {}; window.suppresssharebutton = true; window.onarticlepage = true; var currentscript = d.currentscript || d.head.queryselector('script.js-entry'); function catchnomodulesupport() { var scriptel = d.createelement('script'); return (!('nomodule' in scriptel) && 'onbeforeload' in scriptel) } var headscripts = [ {'src': '/static/js/polyfill-es5-bundle-b4356fa7f5.js', 'async': false} ]; var bodyscripts = [ {'src': '/static/js/app-es5-bundle-e32d4e8b94.js', 'async': false, 'module': false}, {'src': '/static/js/app-es6-bundle-001429c241.js', 'async': false, 'module': true} , {'src': '/static/js/global-article-es5-bundle-a0843501da.js', 'async': false, 'module': false}, {'src': '/static/js/global-article-es6-bundle-8ccb70acaf.js', 'async': false, 'module': true} ]; function createscript(script) { var scriptel = d.createelement('script'); scriptel.src = script.src; scriptel.async = script.async; if (script.module === true) { scriptel.type = "module"; if (catchnomodulesupport()) { scriptel.src = ''; } } else if (script.module === false) { scriptel.setattribute('nomodule', true) } if (script.charset) { scriptel.setattribute('charset', script.charset); } return scriptel; } for (var i = 0; i window.initgtm = function() { (function (w, d, s, l, i) { w[l] = w[l] || []; w[l].push({'gtm.start': new date().gettime(), event: 'gtm.js'}); var f = d.getelementsbytagname(s)[0], j = d.createelement(s), dl = l != 'datalayer' ? '&l=' + l : ''; j.async = true; j.src = 'https://sgtm.springer.com/gtm.js?id=' + i + dl; f.parentnode.insertbefore(j, f); })(window, document, 'script', 'datalayer', 'gtm-mrvxshq'); } (function (w, d, t) { function cc() { var h = w.location.hostname; var e = d.createelement(t), s = d.getelementsbytagname(t)[0]; if (h.indexof('springer.com') > -1 && h.indexof('biomedcentral.com') === -1 && h.indexof('springeropen.com') === -1) { e.src = 'https://cmp.springer.com/production_live/en/consent-bundle-17-70.js'; e.setattribute('onload', "initgtm(window,document,'script','datalayer','gtm-mrvxshq')"); } else if (h.indexof('biomedcentral.com') > -1) { e.src = 'https://cmp.biomedcentral.com/production_live/en/consent-bundle-15-45.js'; e.setattribute('onload', "initgtm(window,document,'script','datalayer','gtm-mrvxshq')"); } else if (h.indexof('springeropen.com') > -1) { e.src = 'https://cmp.springernature.com/production_live/en/consent-bundle-16-41.js'; e.setattribute('onload', "initgtm(window,document,'script','datalayer','gtm-mrvxshq')"); } else if (h.indexof('springernature.com') > -1) { e.src = 'https://cmp.springernature.com/production_live/en/consent-bundle-49-43.js'; e.setattribute('onload', "initgtm(window,document,'script','datalayer','gtm-nk22kls')"); } else { e.src = '/static/js/cookie-consent-es5-bundle-8d962b73c2.js'; e.setattribute('data-consent', h); } s.insertadjacentelement('afterend', e); } cc(); })(window, document, 'script'); {"mainentity":{"headline":"optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches","description":"genetic ancestry is an important factor to account for in dna methylation studies because genetic variation influences dna methylation patterns. one approach uses principal components (pcs) calculated from cpg sites that overlap with common snps to adjust for ancestry when genotyping data is not available. however, this method does not remove technical and biological variations, such as sex and age, prior to calculating the pcs. the first pc is therefore often associated with factors other than ancestry. we developed and adapted the adapted epiancer+ approach, which includes (1) residualizing the cpg data overlapping with common snps for control probe pcs, sex, age, and cell type proportions to remove the effects of technical and biological factors, and (2) integrating the residualized data with genotype calls from the snp probes (commonly referred to as rs probes) present on the arrays, before calculating pcs and evaluated the clustering ability and relationship to genetic ancestry. the pcs generated by epiancer+ led to improved clustering for repeated samples from the same individual and stronger associations with genetic ancestry groups predicted from genotype information compared to the original approach. epiancer+ also outperformed the use of dna methylation pcs or surrogate variables for ancestry adjustment. we show that the epiancer+ approach improves the adjustment for genetic ancestry in dna methylation studies. epiancer+ can be integrated into existing r pipelines for commercial methylation arrays, such as 450 k, epic v1, and epic v2. the code is available on github (\n https://github.com/kirahoeffler/epiancer\n \n ).","datepublished":"2025-10-14t00:00:00z","datemodified":"2025-10-14t00:00:00z","pagestart":"1","pageend":"14","license":"http://creativecommons.org/licenses/by/4.0/","sameas":"https://doi.org/10.1186/s13072-025-00627-0","keywords":["epigenetics","dna methylation","ancestry","ewas","mwas","animal genetics and genomics","human genetics","plant genetics and genomics","cell biology","gene expression","gene function"],"image":["https://media.springernature.com/lw1200/springer-static/image/art%3a10.1186%2fs13072-025-00627-0/mediaobjects/13072_2025_627_fig1_html.png","https://media.springernature.com/lw1200/springer-static/image/art%3a10.1186%2fs13072-025-00627-0/mediaobjects/13072_2025_627_fig2_html.png","https://media.springernature.com/lw1200/springer-static/image/art%3a10.1186%2fs13072-025-00627-0/mediaobjects/13072_2025_627_fig3_html.png","https://media.springernature.com/lw1200/springer-static/image/art%3a10.1186%2fs13072-025-00627-0/mediaobjects/13072_2025_627_fig4_html.png","https://media.springernature.com/lw1200/springer-static/image/art%3a10.1186%2fs13072-025-00627-0/mediaobjects/13072_2025_627_fig5_html.png"],"ispartof":{"name":"epigenetics & chromatin","issn":["1756-8935"],"volumenumber":"18","@type":["periodical","publicationvolume"]},"publisher":{"name":"biomed central","logo":{"url":"https://www.springernature.com/app-sn/public/images/logo-springernature.png","@type":"imageobject"},"@type":"organization"},"author":[{"name":"kira d. höffler","affiliation":[{"name":"university of bergen","address":{"name":"department for clinical medicine, university of bergen, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"haukeland university hospital","address":{"name":"bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"haukeland university hospital","address":{"name":"dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"harvard medical school","address":{"name":"department of psychiatry, mclean hospital, harvard medical school, belmont, usa","@type":"postaladdress"},"@type":"organization"}],"email":"kira.hoeffler@uib.no","@type":"person"},{"name":"seyma katrinli","affiliation":[{"name":"emory university","address":{"name":"department of gynecology and obstetrics, emory university, atlanta, usa","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"matthew w. halvorsen","affiliation":[{"name":"university of north carolina at chapel hill","address":{"name":"department of genetics, university of north carolina at chapel hill, chapel hill, usa","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"anne-kristin stavrum","affiliation":[{"name":"university of bergen","address":{"name":"department for clinical medicine, university of bergen, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"haukeland university hospital","address":{"name":"bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"haukeland university hospital","address":{"name":"dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"kevin s. o’connell","affiliation":[{"name":"university of oslo","address":{"name":"center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway","@type":"postaladdress"},"@type":"organization"},{"name":"oslo university hospital and university of oslo","address":{"name":"department of medical genetics, oslo university hospital and university of oslo, oslo, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"alexey shadrin","affiliation":[{"name":"university of oslo","address":{"name":"center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway","@type":"postaladdress"},"@type":"organization"},{"name":"oslo university hospital and university of oslo","address":{"name":"department of medical genetics, oslo university hospital and university of oslo, oslo, norway","@type":"postaladdress"},"@type":"organization"},{"name":"oslo university hospital","address":{"name":"section for precision psychiatry, oslo university hospital, oslo, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"srdjan djurovic","affiliation":[{"name":"university of oslo","address":{"name":"center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway","@type":"postaladdress"},"@type":"organization"},{"name":"oslo university hospital and university of oslo","address":{"name":"department of medical genetics, oslo university hospital and university of oslo, oslo, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"ole a. andreassen","affiliation":[{"name":"university of oslo","address":{"name":"center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway","@type":"postaladdress"},"@type":"organization"},{"name":"oslo university hospital","address":{"name":"section for precision psychiatry, oslo university hospital, oslo, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"james j. crowley","affiliation":[{"name":"university of north carolina at chapel hill","address":{"name":"department of genetics, university of north carolina at chapel hill, chapel hill, usa","@type":"postaladdress"},"@type":"organization"},{"name":"university of north carolina at chapel hill","address":{"name":"department of psychiatry, university of north carolina at chapel hill, chapel hill, usa","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"jan haavik","affiliation":[{"name":"haukeland university hospital","address":{"name":"bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"university of bergen","address":{"name":"department of biomedicine, university of bergen, bergen, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"kristen hagen","affiliation":[{"name":"haukeland university hospital","address":{"name":"bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"møre and romsdal hospital trust","address":{"name":"department of psychiatry, møre and romsdal hospital trust, molde, norway","@type":"postaladdress"},"@type":"organization"},{"name":"norwegian university of science and technology","address":{"name":"department of mental health, norwegian university of science and technology, trondheim, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"gerd kvale","affiliation":[{"name":"university of bergen","address":{"name":"department of clinical psychology, university of bergen, bergen, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"kerry ressler","affiliation":[{"name":"harvard medical school","address":{"name":"department of psychiatry, mclean hospital, harvard medical school, belmont, usa","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"bjarne hansen","affiliation":[{"name":"haukeland university hospital","address":{"name":"bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"university of bergen","address":{"name":"center for crisis psychology, university of bergen, bergen, norway","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"jair c. soares","affiliation":[{"name":"the university of texas health science center at houston","address":{"name":"faillace department of psychiatry and behavioral sciences, mcgovern medical school, the university of texas health science center at houston, houston, usa","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"gabriel r. fries","affiliation":[{"name":"the university of texas health science center at houston","address":{"name":"faillace department of psychiatry and behavioral sciences, mcgovern medical school, the university of texas health science center at houston, houston, usa","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"alicia k. smith","affiliation":[{"name":"emory university","address":{"name":"department of gynecology and obstetrics, emory university, atlanta, usa","@type":"postaladdress"},"@type":"organization"},{"name":"emory university","address":{"name":"department of psychiatry and behavioral sciences, emory university, atlanta, usa","@type":"postaladdress"},"@type":"organization"}],"@type":"person"},{"name":"stéphanie le hellard","affiliation":[{"name":"university of bergen","address":{"name":"department for clinical medicine, university of bergen, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"haukeland university hospital","address":{"name":"bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"},{"name":"haukeland university hospital","address":{"name":"dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway","@type":"postaladdress"},"@type":"organization"}],"email":"stephanie.lehellard@uib.no","@type":"person"}],"isaccessibleforfree":true,"@type":"scholarlyarticle"},"@context":"https://schema.org","@type":"webpage"} skip to main content advertisement window.sn = window.sn || {}; window.sn.libs = window.sn.libs || {}; window.sn.libs.ads = window.sn.libs.ads || {}; window.sn.libs.ads.slotconfig = window.sn.libs.ads.slotconfig || {}; window.sn.libs.ads.slotconfig['lb1'] = { 'pos': 'lb1' }; window.sn.libs.ads.slotconfig['unitpath'] = '/270604982/bmc/epigeneticsandchromatin/articles'; window.sn.libs.ads.slotconfig['type'] = 'article'; window.sn.libs.ads.slotconfig['kwrd'] = 'epigenetics,dna methylation,ancestry,ewas,mwas'; window.sn.libs.ads.slotconfig['doi'] = '10.1186/s13072-025-00627-0'; window.sn.libs.ads.slotconfig['pmc'] = 'l32030,b12008,l32020,l16008,b12010,b12030'; bmc is moving to springer nature link. visit this journal in its new home. search explore journals get published about bmc my account search all bmc articles search epigenetics & chromatin home about articles submission guidelines submit manuscript optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches download pdf download pdf methodology open access published: 14 october 2025 optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches kira d. höffler 1 , 2 , 3 , 4 , seyma katrinli 5 , matthew w. halvorsen 6 , anne-kristin stavrum 1 , 2 , 3 , kevin s. o’connell 7 , 8 , alexey shadrin 7 , 8 , 9 , srdjan djurovic 7 , 8 , ole a. andreassen 7 , 9 , james j. crowley 6 , 10 , jan haavik 2 , 11 , kristen hagen 2 , 12 , 13 , gerd kvale 14 , kerry ressler 4 , bjarne hansen 2 , 15 , jair c. soares 16 , gabriel r. fries 16 , alicia k. smith 5 , 17 & … stéphanie le hellard 1 , 2 , 3 show authors epigenetics & chromatin volume 18 , article number: 69 ( 2025 ) cite this article 217 accesses metrics details abstract background genetic ancestry is an important factor to account for in dna methylation studies because genetic variation influences dna methylation patterns. one approach uses principal components (pcs) calculated from cpg sites that overlap with common snps to adjust for ancestry when genotyping data is not available. however, this method does not remove technical and biological variations, such as sex and age, prior to calculating the pcs. the first pc is therefore often associated with factors other than ancestry. methods we developed and adapted the adapted epiancer+ approach, which includes (1) residualizing the cpg data overlapping with common snps for control probe pcs, sex, age, and cell type proportions to remove the effects of technical and biological factors, and (2) integrating the residualized data with genotype calls from the snp probes (commonly referred to as rs probes) present on the arrays, before calculating pcs and evaluated the clustering ability and relationship to genetic ancestry. results the pcs generated by epiancer+ led to improved clustering for repeated samples from the same individual and stronger associations with genetic ancestry groups predicted from genotype information compared to the original approach. epiancer+ also outperformed the use of dna methylation pcs or surrogate variables for ancestry adjustment. conclusions we show that the epiancer + approach improves the adjustment for genetic ancestry in dna methylation studies. epiancer+ can be integrated into existing r pipelines for commercial methylation arrays, such as 450 k, epic v1, and epic v2. the code is available on github ( https://github.com/kirahoeffler/epiancer ). background genetic ancestry is an important confounding factor in dna methylation studies and should ideally be adjusted for using principal components (pcs) derived from genetic information (i.e. genotypes). however, when genotype data is not available for all study participants, self-reported ancestry data is commonly used to adjust for ancestry in dna methylation studies, often leading to the exclusion of non-europeans and individuals with mixed genetic backgrounds, and to sub-optimal correction. this practice is problematic due to the historical underrepresentation of non-europeans in epigenetic research [ 1 ] and the inherent flaws of self-reported data, which fail to capture the continuous nature of genetic variation and inadequately address the complexity of mixed ancestry backgrounds. to ensure the generalizability of research findings, dna methylation studies should avoid excluding individuals based on genetic background. two main methods are available to adjust for genetic ancestry in dna methylation studies lacking genotyping data. the method by barfield et al. from 2014 [ 2 ] calculates pcs from dna methylation data of cpgs near or overlapping single nucleotide polymorphisms (snps), selected based on the 1000 genomes project [ 3 ] data. however, this approach does not account for technical and biological factors such as sex, age, and cell type proportions, resulting in the first ancestry pc not being regularly associated with genetic ancestry [ 2 ] and potentially introducing multicollinearity with other adjusted factors in the final model. the epistructure [ 4 ] approach calculates pcs from dna methylation of cpgs highly correlated with cis-located snp probes while considering cell-type composition. this method is not easily integrated into existing r-based pipelines because it is a python program and requires several steps of input file adaptation. additionally, it has not been updated since 2017 and does not accommodate the epic v2 array. other methods based on dna methylation, such as surrogate variables and methylation pcs from the whole array data, do not specifically adjust for ancestry. therefore, there is a need for a reliable method to adjust for ancestry in dna methylation studies where genotype data is not available that can easily be incorporated into existing pipelines. our aim was to provide such a method by improving the approach by barfield et al.'s [ 2 ] through the use of methylation data from cpgs overlapping with snp probes that are residualized for technical and biological factors (i.e. cell type proportion pcs, sex, age, and control probe pcs) and information from genotyping snp rs probes on the array. we hypothesized that ancestry pcs from our adapted approach would result in better clustering of genetically predicted ancestry groups and repeated samples from the same individual, stronger associations with genetic ancestry, and stronger correlations with genetic pcs. we tested the performance of our approach against the existing one using two norwegian cohorts (bcbp-ocd and top [ 5 , 6 ,]– [ 7 ]) and two us-american cohorts: uthealth houston [ 8 ] and grady trauma project (gtp) [ 9 ]. an easy-to-use function for our adapted approach is provided on github, along with detailed guidance on parameter settings and input file structure for implementation ( https://github.com/kirahoeffler/epiancer ). methods tested cohorts the different approaches were tested in two cohorts from norway and two cohorts from the united states, including individuals with available dna methylation data and ancestry information (either genetically predicted or self-reported, table 1 ). the inclusion criteria were passing dna methylation quality control and, if available, genotyping quality control. samples from individuals with mixed ancestry (based on the available data, as described in the genetic ancestry prediction section) were excluded from performance testing solely for methodological reasons, because evaluating classification accuracy requires clearly defined ancestry groups, and admixed individuals typically fall between clusters. this is not a limitation of epiancer+ , which produces continuous ancestry pcs that capture both discrete and admixed variation, making it fully applicable to individuals with mixed ancestry. table 1 cohorts on which the approaches were tested full size table dna methylation in the bcbp-ocd cohort, dna methylation was measured using the illumina epic v2 array at life&brain gmbh in bonn, germany. samples were excluded if they showed: mismatches between reported and predicted sex, outliers in the minfi [ 10 ] sex plot, genotype mismatches between repeated samples [ 11 ], low bisulfite conversion efficiency (< 80%) calculated with the watermelon [ 12 ] package, more than 5% missing data (after applying a detection p value threshold of 10e −16 ), or outlier patterns in beta value distribution plots [ 10 ]. saliva cell type proportions were estimated using hepidish [ 13 ] with the rpc method. the centepifibfatic.m dataset, excluding fat, was used as the main reference, while the centbloodsub.m dataset functioned as the secondary reference [ 13 ]. in the top cohort [ 5 , 6 ,]– [ 7 ], dna methylation was measured using the illumina epic v1 array at life and brain gmbh in bonn, germany, and quality controlled in three batches. samples were excluded if at least 1% of sites had a detection p -value > 0.01, if snp genotypes from the rs probes on the epic array did not match genotype data from the same samples, or there was a discrepancy between the sex predicted from dna methylation data and the reported sex [ 5 ]. the blood cell type proportions were calculated using the estimatecellcounts2 function from flowsorted.blood.epic [ 14 ] package. in the gtp cohort [ 9 ], dna methylation was measured using the illumina epic v1 array and quality controlled using the psychiatric genomics consortium (pgc)-ptsd epigenetics pipeline [ 15 ] (available at https://github.com/pgc-ptsd-ewas/epic_qc ). briefly, samples were excluded if their probe detection call rates were below 90% (after applying a detection p value threshold of 0.01) or if their average intensity values were either less than half of the overall sample mean or below 2000 arbitrary units (au). blood cell composition - including cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and neutrophils - was estimated using the robust partial correlation (rpc) method in epidish [ 16 ], utilizing a reference dataset specific to the epic array [ 17 ]. in the uthealth houston cohort [ 8 ], dna methylation was measured using the illumina epic v1 array. samples with a mean detection p-value below 0.05 were set to be excluded; however, no samples met this criterion, so none were excluded. white blood cell count proportions (cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and granulocytes) were estimated using the houseman algorithm [ 18 ]. genetic ancestry prediction bcbp-ocd: genotyping data for the bcbp-ocd cohort were processed following the quality control procedures described in the latest pgc ocd gwas study [ 19 ]. ancestry prediction was performed as outlined by halvorsen et al. [ 20 ], using principal component analysis and a random forest classifier trained on 1000 genomes project phase 3 data [ 3 ]. top: genotyping data and quality control procedures for the top cohort are described in detail in previous work [ 21 ]. ancestry was inferred from genotyping data using a random forest classifier trained on population reference data from the 1000 genomes project [ 3 ], as previously described [ 5 ]. gtp : genotyping was performed using illumina omni-quad 1 m, and genotypes were called in illumina’s genomestudio. genotype data quality control and calculation of pcsoty were performed according to the pgc guidelines [ 22 ]. ancestry was predicted as described by nievergelt et al. [ 22 ]. uthealth houston: ancestry information was assessed by self-report, as genotyping data were not available. epiancer+ approach the epiancer+ approach uses the minfi [ 10 ], champ [ 23 ], and watermelon [ 12 ] packages in r (developed in version 4.4.0) to generate “ancestry pcs”, which can be incorporated into final analysis models for samples that have passed general quality control. the approach consists of two main functions: ancestry_info() and ancestry_pca(). ancestry_info() function the ancestry_info() function uses an rgset that has been background-corrected using the bg.correct.illumina() [ 10 ] function. data from control probes, snp rs probes, bead counts, and detection p-values are extracted, as well as intensities of type i probes (split into green and red channels) and type ii probes. a detection p-value threshold of 10e −16 is applied, setting values above this threshold as missing. the intensities are filtered to include only cpgs overlapping with snps, referred to as snp0bp probes. the probes are selected using the same underlying criteria across all arrays, though the implementation depends on the structure of the available array-specific annotation: 450 k array: from the illuminahumanmethylation450kanno.ilmn12.hg19 [ 24 ] annotations, selecting snps probes from cpg_rs column overlapping with cpg sites filtered based on minor allele frequency (maf) ≥ 0.05. epic v1 array: from the pidsley et al . [ 25 ] and zhang et al . [ 26 ] annotations, selecting probes in either or both publications overlapping with snps (distance = 0) with a maf ≥ 0.05 epic v2 array: from annotations provided by illumina [ 27 ], selecting probes overlapping with snps (distance = 0) with a maf ≥ 0.05 the number of selected ancestry-informative probes was 7295 for the 450 k array, 3622 for the epic v1 array, and 2,674 for the epic v2 array. probes with low bead counts (where > 5% of samples have a bead count below 3) or low call rates (where > 10% of samples have missing data) are excluded. after filtering, the intensity values are quantile normalized, and beta values are calculated. missing values are imputed using the champ.impute() [ 23 ] function. beta values for the snp0bp probes are then residualized to adjust for cell count pcs, sex, age, and ten pcs derived from control probes, which capture a broad range of technical variation, including slide, array position, scanner effects, dna quality, and bisulfite conversion efficiency. this residualized data is referred to as epiancer . finally, the residualized snp0bp data is combined with the genotype calls from rs snp probes, which is referred to as epiancer+ . ancestry_pca() function the ancestry_pca() function takes the processed data from ancestry_info() and uses it to calculate ancestry pcs. these pcs are intended to be included in analysis models as covariates to control for ancestry-related variation. for further details and access to the code, please refer to the code on github ( https://github.com/kirahoeffler/epiancer ). performance tests three versions of ancestry pcs were compared: the original barfield [ 2 ] et al. approach ( epiancorig ), the adapted approach after only performing the residualization step ( epiancer ), and the further adapted approach combining the residualised data with called genotypes from rs probes ( epiancer+ ). to ensure comparability across approaches, the pca results were min–max scaled to a range between 0 and 1. associations between ancestry pcs and ancestry group were tested using anova when assumptions of normality and variance homogeneity were met. otherwise, kruskal–wallis tests with the rstatix [ 2 ] package were used. to evaluate clustering performance, silhouette scores [ 28 ], which range from -1 to 1 (with higher values indicating better clustering), were calculated using the cluster [ 29 ] package. these scores were used to evaluate clustering performance at both the ancestry group level and the individual (repeated samples) level. in addition, three-dimensional (3d) centroids of both ancestry group and individual (repeated samples) clusters were calculated. cluster density was assessed by calculating the mean euclidean 3d distance from each sample to the centroid of its respective group. to determine the separation between ancestry group clusters, a distance matrix was generated to measure the distances between the centroids of different ancestry groups. in the bcbp-ocd cohort, the absolute correlation between the first three ancestry pcs and the first three genotyping pcs was calculated to evaluate how effectively the methylation-based pcs capture the genetic ancestry background. visualization of results was performed using ggplot2 [ 30 ], cowplot [ 31 ], patchwork [ 32 ], plotly [ 33 ], htmlwidgets [ 34 ], and corrplot [ 35 ] packages. comparison with dna methylation pcs and surrogate variables in the bcbp-ocd sample, we compared the performance of epiancer+ with that of the first three dna methylation pcs and the first three surrogate variables (svs), using the same evaluation approach described above. dna methylation pcs were calculated from normalized m-values from autosomal probes. surrogate variable analysis was performed on the m-values. the full model included case–control status, age, sex, two cell type pcs, and ten control probe pcs. the null model excluded case–control status. ancestry group associations with technical and biological adjustment factors associations between ancestry groups and the factors used to residualize snp0bp data were tested using either linear models for datasets with two ancestry groups or anova when multiple ancestry groups were present (with a common p-value for the effect across all groups). for control probe pcs and cell type pcs in datasets with repeated samples, linear mixed-effect models were employed to test the association with the ancestry groups. these models included a random intercept to account for repeated measures from the same individual. two models were compared: (a) a full model that included ancestry group as a predictor and the pcs as outcome; (b) a null model that excluded ancestry group. a likelihood ratio test was performed to determine if the full model fit the data significantly better than the null model. additionally, to assess whether residualized biological and technical covariates confounded our epiancer+ pcs, we performed linear regression and partial r 2 analyses in the gtp cohort. for each of the top three epiancer+ pcs, we quantified the unique variance explained by (i) the top three genotype-derived ancestry pcs, (ii) residualized covariates (sex, age, top 10 control probe pcs, and 6 cell proportion pcs), and (iii) both sets together. unique variance was computed using partial r 2 , representing the proportion of variance in each epiancer+ pc explained by one set of predictors after accounting for the other. practical example in the uthealth houston cohort, we conducted an analysis of bipolar case–control status, adjusting for sex, age, smoking status, five cell type proportion pcs, five control pcs, and 0, 2, 5, or 10 ancestry pcs calculated with epiancer + . this setup allowed us to compare the impact of including different numbers of ancestry pcs on the genomic inflation factor (λ). results we evaluated the performance of ancestry pcs in capturing genetic ancestry, comparing the original approach by barfield et al. [ 2 ] ( epiancorig ) with two adapted versions. the first adaptation step involved residualizing cpg data overlapping with snps to adjust for technical and biological confounders ( epiancer ). the second adaptation combined the residualized values with called genotypes from rs probes ( epiancer+ ). scatterplots when plotting ancestry pcs against each other, distinct ancestry groups should ideally form dense and separate clusters, while repeated samples from the same individuals should cluster closely together. in the bcbp-ocd cohort (fig. 1 a-c; figure s1-s3), all approaches visually distinguished ancestry groups in the first two pcs. notably, while the original approach ( epiancorig ) separated ancestry primarily along the second pc, both adapted approaches achieved separation along the first pc. in the top cohort (fig. 1 d-f; figure s4-s6), the epiancorig approach failed to separate ancestry groups. in contrast, epiancer successfully differentiated african and east asian samples, with further improvement using epiancer+ , separating all ancestry groups. in the gtp cohort, both the epiancorig and adapted approaches differentiate ancestry group, with no major observable differences between them (figures. 1 g-i and s7-s9). in the uthealth houston cohort, the epiancorig approach appears to produce slightly clearer separations and denser clusters compared to the adapted approaches (figs. 1 j-l and s10-s12). fig. 1 scatterplots of the first two ancestry pcs plotted against each other, calculated using different approaches. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur european, lat latin american, pi pacific islander , sas south asian full size image association between the ancestry pcs and the ancestry groups to optimally adjust for ancestry, a strong association between ancestry pcs and ancestry groups is needed, particularly for the first ancestry pc. in the bcbp-ocd cohort (fig. 2 a, table s1a), both adapted approaches had a much stronger association between the first ancestry pc and the ancestry groups (both p = 1.47e-20) compared to the epiancorig approach (p = 0.032), aligning with the observations in the scatterplots (fig. 1 a-c). the epiancorig approach showed the strongest association only with the second ancestry pc (p = 1.47e-20), while epiancer+ (p = 1.68e-09) had a stronger association than epiancer (p = 0.001) for the second ancestry pc. fig. 2 association between the first three ancestry pcs and the ancestry groups. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort (fig. 2 b, table s1b), the strongest association between the first ancestry pc and the ancestry groups was observed for epiancer+ (p = 1.15e-22), followed by epiancer (p = 2.19e-10), while there was no association with the epiancorig approach (p = 1). the epiancorig approach showed a significant association only for the third ancestry pc (p = 6.62e-13). in the gtp cohort, there was no notable difference in the association between the first ancestry pc and ancestry groups (fig. 2 c, table s1c), while in the uthealth houston cohort, the first ancestry pc from the epiancorig approach showed stronger associations with ancestry groups than the adapted approaches (fig. 2 d, table s1d). repeated sample clustering we next assessed the clustering of repeated samples from the same individuals when plotting ancestry pcs against each other. this analysis was done in both the bcbp-ocd and top cohorts that included repeated samples. to quantify clustering, we used silhouette scores (higher scores indicate better clustering) and calculated the 3d distances from the repeated sample to the 3d centroid of the respective individual. repeated samples should cluster closely together, as genetic ancestry remains consistent over time. in the bcbp-ocd cohort, repeated samples clustered more tightly using the adapted approaches compared to the epiancorig approach. this was reflected in higher silhouette scores (fig. 3 a, table s2a) and smaller distances to the individual’s centroid (fig. 3 b, table s2b). there was little difference between epiancer and epiancer+ . fig. 3 repeated sample clustering. clustering performance of repeated samples from individuals was tested using silhouette scores and 3d distance to the individual’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort, the epiancer+ approach resulted in the best clustering, with the highest average silhouette score (fig. 3 c, table s2a) and the smallest average distance to the centroid (fig. 3 d, table s2b). however, in the top cohort, only three individuals had repeated samples, with each having two samples. ancestry level clustering next, we assessed how well different ancestry groups cluster by plotting the first three ancestry pcs against each other. ideally, samples within the same ancestry group should cluster closely together, while different ancestry groups should be well-separated. clustering was quantified with silhouette scores and 3d distances both between ancestry clusters and within clusters (from the samples to the respective centroid of the individual). in the bcbp-ocd cohort, the silhouette scores improved from the epiancorig approach (0.2419) to epiancer (0.2610) and showed only slight further improvement for epiancer+ (0.2693) (fig. 4 a, table s3a-b). the highest mean distances between ancestry clusters were observed with epiancer+ , followed by epiancer and the epiancorig approach (fig. 4 b, table s3c). distances within clusters presented a mixed picture: while most ancestry groups had tighter clusters with the adapted approaches, the south asian group showed a wider cluster (fig. 4 c, table s3c). fig. 4 ancestry group clustering. clustering performance of samples from different ancestries was tested using silhouette scores and 3d distance to the ancestry group’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur: european, lat latin american, pi pacific islander, sas south asian full size image in the top cohort, the average silhouette scores for epiancorig (0.06964) and epiancer (0.01417) were lower than for epiancer+ (0.25019) (fig. 4 d, table s3a). clustering varied across ancestry groups, with european, east asian, and african ancestries showing the best clustering under epiancer+ , as indicated by higher silhouette scores (fig. 4 d, table s3b), slightly higher distances between the ancestry clusters (fig. 4 e, table s3c), and lower distances of samples to the cluster centroid (fig. 4 f, table s3c) compared to the other approaches. in the gtp cohort (fig. 45g-i, table s3a-c), the epiancorig approach produced the highest silhouette score (0.5990), followed by epiancer+ (0.5732) and epiancer (0.5579). this result was primarily driven by larger distances between clusters in the epiancorig approach, followed by epiancer+ and epiancer . in the uthealth houston cohort (fig. 4 j-l, table s3a-c), the epiancorig approach also showed the highest silhouette score (0.07268), compared to epiancer+ (-0.0567) and epiancer (-0.0083). this was mainly due to larger distances between the african ancestry cluster to the other clusters and smaller distances within the asian cluster under the epiancorig approach. comparison with dna methylation pcs (dnampcs) and surrogate variables (svs) we compared the performance of epiancer+ with dnampcs and svs in the bcbp-ocd cohort. epiancer+ consistently outperformed both approaches. visually, it produced better clustering of samples (figure s13), which was reflected in a higher mean silhouette score ( epiancer+ : 0.293; svs: -0.226; dnampcs: -0.245). statistically, the first epiancer+ pc showed a strong association with ancestry groups, whereas only the third dnampc and sv demonstrated ancestry association, and with lower significance (table s 1 e (supplementary), figure s14). for repeated samples from the same individual, epiancer+ again performed better, achieving a higher mean 3d silhouette score (0.325) compared with dnampcs (-0.599) and svs (-0.603). association of ancestry groups with genotyping pcs for dna methylation-based ancestry pcs to effectively capture genetic background information, they should exhibit a strong correlation with genotyping pcs, especially between the first ancestry pc and the first genotyping pc, as both are expected to account for the majority of genetic variation. pearson correlation analysis was performed between ancestry and genotyping pcs in the bcbp-ocd cohort, which had readily available genotyping data. importantly, both adapted approaches ( epiancer and epiancer+ ) showed a strong correlation between the first ancestry pc and the first genotyping pc (r = 0.875, fig. 5 b-c). in contrast, the epiancorig approach showed no correlation between the first ancestry pc and the first genotyping pc (r = 0.001, fig. 5 a). the mean correlation of the first three genotyping pcs with the first three ancestry pcs was highest for epiancer+ (mean r = 0.173), followed by epiancer (mean r = 0.156), and lowest for the epiancorig approach (mean r = 0.146). fig. 5 correlation between the first three ancestry pcs and the first three genotyping pcs. correlation analyses were performed in the bcbp-ocd cohort. ancestry pcs are referred to as pcs 1–3 and genotyping pcs as gt_pc1-3. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the gtp cohort, partial r 2 analyses showed that epiancer+ pc1 captured substantial true ancestry signal (94.4%) but also retained variance explained by residualized covariates (40.5%). pc2 was minimally associated with ancestry (0.5%) or residualized factors (3.4%). pc3 was predominantly explained by residualized variables (49.4%) and showed little ancestry signal (1.1%). these results indicate that, while pc1 largely reflects true ancestry, some pc3 is strongly influenced by residualized technical and biological variation. this pattern is consistent with an unbalanced experimental design that induces correlations between ancestry and residualized factors. ancestry group associations with technical and biological adjustment factors to assess potential confounding, we tested whether factors adjusted for during residualization (sex, age, cell type proportions, and control probe pcs) were associated with ancestry groups, as such associations could inadvertently reduce true ancestry signals if these factors are unevenly distributed across batches or groups. in the bcbp-ocd cohort, none of the factors included in the residualization step were associated with ancestry groups (table s4a). in the top cohort, sex, several cell type proportion pcs (1, 2, 4, 5) but only the sixth control probe pc showed significant associations with ancestry groups (table s4b). in the gtp cohort, age, the second, fourth, and ninth control probe pcs, and the first and second cell type proportion pcs were significantly associated with ancestry groups (table s4c). in the uthealth houston cohort, the first and second cell type pcs were significantly associated with ancestry groups as well, along with the eighth to tenth control probe pcs (table s4d). practical example in the uthealth houston cohort, we analyzed bipolar case–control status while adjusting for varying numbers of ancestry pcs calculated with epiancer+ . the genomic inflation factor (λ) is ideally close to 1, as values above 1 may indicate population stratification or other confounding effects. without adjusting for any ancestry pcs, λ was 1.087. adding 2 ancestry pcs reduced λ to 1.023, and adding 5 ancestry pcs further reduced it to 1.008. however, adding 10 ancestry pcs increased λ slightly to 1.056. these results indicate that adjusting for ancestry pcs effectively reduces batch effects introduced by ancestry, with 5 pcs being optimal in this case. including more pcs than necessary (as with 10 pcs here) can reintroduce noise. discussion we demonstrated that adjusting for genetic ancestry in dna methylation studies by residualizing beta values for known technical and biological factors - prior to calculating ancestry principal components from cpgs overlapping with snps - and integrating the residualized data with genotype calls from the snp probes present on the arrays, improves accuracy compared to the method proposed by barfield et al. (2014) [ 2 ]. in the bcbp-ocd and top cohorts, we observed the same issues that were reported with the original approach by barfield et al. (2014) [ 2 ]: the first ancestry pc calculated using this approach showed weak associations with the ancestry groups, while stronger associations only emerged for the second or third ancestry pcs. there was a lack of correlation between the first genotyping pc and the first ancestry pc. thus, these findings suggest that the first ancestry pc calculated with the barfield et al. [ 2 ] approach, and in some cases even the second ancestry pc, mostly capture influences on dna methylation that are unrelated to ancestry or genetic background. several tests were conducted to assess the performance of the adapted approach compared to the original approach. the results indicated that the adapted approach substantially removed technical and biological variance, particularly in the bcbp-ocd and top cohorts. importantly, the association between the first ancestry pc and different ancestry groups was stronger using the adapted approach. while the addition of called genotypes to the residualization step did not substantially affect results in the bcbp-ocd cohort, the top cohort showed a stronger association between the first ancestry pc and the ancestry groups when called genotypes were included. this highlights that incorporating called genotypes can improve the robustness, especially in cohorts with larger technical effects. a key indicator of the adapted approach’s performance is its ability to cluster repeated samples from the same individuals more closely than the original approach. this is demonstrated by higher silhouette scores, a measure of clustering performance, and tighter clustering, indicated by smaller distances to the centroid within each individual’s cluster, in both the bcbp-ocd and top cohorts. since genetic ancestry is consistent over time, repeated samples should cluster tightly together. the tighter clustering observed with the adapted approach aligns with our expectations, as the original approach is affected by technical and biological influences, such as differing plate positions and variations in cell type estimations across samples from the same individual; the adapted approach effectively corrects for these influences, resulting in more accurate ancestry estimations. in addition to improved individual-level clustering, the different ancestry groups also showed better clustering when plotting ancestry pcs against one another. in the top cohort, where batch effects were more pronounced, incorporating called genotypes resulted in higher silhouette scores compared to using the residualized data alone. in contrast, in the bcbp-ocd cohort, where batch effects were less pronounced, the addition of genotypes had minimal impact on clustering performance at the ancestry group level. the tightness of clusters, measured as the distances of samples to their respective ancestry cluster centroids, yielded mixed results across different ancestry groups. this variability may reflect the adapted approach’s ability to capture greater genetic diversity within ancestry groups when confounding factors are appropriately adjusted for. finally, the adapted approach demonstrated a strong correlation (r = 0.875) between the first ancestry pcs and the first genotyping pc in the bcbp-ocd cohort, whereas no such correlation was observed with the original approach. the first genotyping pc captures most genetic background, which demonstrates the ability of the first ancestry pc to also capture most of the genetic variability. moreover, when examining the mean correlation of the first three ancestry pcs with the first three genotyping pcs, the adapted approach including the called genotypes showed the highest correlations of the compared approaches, capturing more true genetic information. in the bcbp-ocd cohort, epiancer+ showed clearly superior performance compared with dna methylation pcs (dnampcs) and surrogate variables (svs), demonstrating stronger statistical associations with ancestry, better clustering of ancestry groups, and improved clustering of repeated samples. overall, epiancer+ is more effective at capturing true ancestry effects, whereas dnampcs are more likely to capture technical noise and svs tend to reflect other non-ancestry influences. the adjusted method did not perform better for the gtp and uthealth houston cohorts. our partial r 2 analysis in the gtp cohort provides quantitative support for this observation: while epiancer+ pc1 retained strong ancestry signal (94.4% variance explained by genotype pcs), it also contained substantial variance from residualized covariates (40.5%), and pc3 was largely driven by residualized variables (49.4%) with minimal ancestry signal (1.1%). this pattern is consistent with unbalanced study design, where technical and biological covariates are unevenly distributed across ancestry groups, creating correlations between ancestry and residualized factors. these results indicate that some ancestry effect is removed when correcting for biological and technical factors in the residualizing step, because these factors are themselves associated with ancestry. there is a balance between removing the effects of technical and biological factors and removing ancestry information associated with these factors. if batch effects are not too strong but still associated with ancestry, then ancestry clustering does not improve, as seen in the gtp and uthealth houston cohorts. in contrast, substantial improvements are observed in cohorts like the bcbp-ocd cohort, where there is little to no association between ancestry and the factors adjusted for during residualization. similarly, in the top cohort, which has large technical batch effects, residualization had an improving effect despite the removal of some ancestry-related information. the actual performance is sample-specific and depends on the study design, but the method is applicable across a range of sample sizes. thus, it is important to take more care in designing the studies so that technical factors are not associated with ancestry (by a randomized design, balancing ancestry across plates, slides, and slide positions) and that sex and age are as balanced as possible across ancestries. this makes it possible for the residualization step to effectively remove influencing factors while preserving the ancestry effects. limitations one limitation is the relatively low overall mean correlation between the first three ancestry pcs and the first three genotyping pcs (mean r = 0.173 for the adapted approach including the genotypic data), suggesting that it does not fully capture all genotyping effects. however, the high correlation between the first ancestry pc and the first genotyping pc (r = 0.875) indicates that the approach effectively captures most of the genetic variation. despite this, genotyping data remains the gold standard for accurately capturing genetic ancestry and should be used whenever available to adjust for genetic background in dna methylation studies. expanding the coverage of illumina dna methylation arrays to include more sites overlapping with snp probes specifically designed to capture ancestry could enhance the ancestry signal derived from these arrays and improve alignment with genotyping pcs; however, in the design of the epic v2, a substantial number of snp-associated methylation probes were removed (selected ancestry-informative probes: 450 k: n = 7295; epic v1: n = 3622; epic v2: n = 2674). another limitation is that the precision of the performance testing may be affected by the fact that our approach was primarily tested on european samples, with fewer available samples from other ancestries. furthermore, the uthealth houston cohort relied on self-reported ancestry data, which is known to be less accurate and may have led to the inclusion of individuals with mixed or misclassified genetic ancestry. additionally, while "latino" is officially recognized as an ethnicity rather than a genetic ancestry group, we used it in our analysis as a label for an ancestry cluster. this cluster reflects admixed genetic backgrounds - typically indigenous american, european, and african - commonly seen in individuals self-identifying as latino. additionally, the longer runtime of our approach presents a practical limitation, primarily due to the detection p-value calculation step. however, this issue can be mitigated by providing pre-calculated detection p-values as input to the function (if already calculated), significantly reducing processing time. we considered comparing the performance of epiancer+ with epistructure [ 4 ]; however, epistructure has not been updated for the latest arrays and is therefore unlikely to perform reliably on our data. practical implications epiancer+ can be used to adjust for ancestry in all samples, even when technical factors correlate with ancestry, as it successfully clustered samples based on ancestry across all tested datasets. importantly, in cohorts where ancestry is correlated with technical and biological effects, our method ensures that ancestry is not accounted for twice. unlike the method by barfield et al. [ 2 ], which risks collinearity by adjusting for ancestry alongside confounding factors, our adapted method estimates the remaining ancestry effect while preserving relevant variation. compared to epistructure [ 4 ], epiancer+ offers improved usability and compatibility. epistructure is implemented in python within the glint framework and requires multiple preprocessing steps, limiting its integration with standard r-based pipelines. moreover, it has not been updated since 2017 and does not support the epic v2 array. epiancer+ , by contrast, is r-based and supports all major array types (450 k, epic v1, epic v2). ancestry pcs should be calculated only for samples that have passed general quality control. based on our experience, including one or two ancestry pcs is often sufficient for most analyses, though the number required depends on cohort diversity. in highly heterogeneous populations, additional ancestry pcs may be necessary. we recommend testing different models (e.g., using 2, 5, or 10 ancestry pcs) and evaluating their performance using qq plots and genomic inflation factor (λ), as demonstrated in the practical example in the results section. the optimal number of pcs is the one that brings λ closest to 1.0 and gives qq plots with no evidence of inflation, indicating adequate correction for population stratification without overfitting. conclusions adequate adjustment for genetic ancestry is essential in dna methylation studies. when genotyping data is unavailable, it has been suggested to use dna methylation data from illumina arrays overlapping with snps as an alternative. we have improved this approach by accounting for technical and biological influences and incorporating genotypic data from snp probes, offering increased robustness. our adapted approach ( epiancer+ ) is easy to implement in existing r pipelines, including the ones for the epic v2 array, and offers a practical solution for ancestry adjustment. data availability no datasets were generated or analysed during the current study. references breeze ce, beck s, berndt si, franceschini n. the missing diversity in human epigenomic studies. nat genet. 2022;54(6):737–9. article cas pubmed pubmed central google scholar barfield rt, almli lm, kilaru v, smith ak, mercer kb, duncan r, et al. accounting for population stratification in dna methylation studies. genet epidemiol. 2014;38(3):231–41. article pubmed pubmed central google scholar auton a, brooks ld, durbin rm, garrison ep, kang hm, et al. a global reference for human genetic variation (genomes project consortium ). nature. 2015;526(7571):68–74. article pubmed google scholar rahmani e, shenhav l, schweiger r, yousefi p, huen k, eskenazi b, et al. genome-wide methylation data mirror ancestry information. epigenetics chromatin. 2017;10:1. article pubmed pubmed central google scholar wortinger la, stavrum ak, shadrin aa, szabo a, rukke sh, nerland s, et al. divergent epigenetic responses to perinatal asphyxia in severe mental disorders. transl psychiatry. 2024;8(14):16. article google scholar engh ja, friis s, birkenaes ab, jónsdóttir h, klungsøyr o, ringen pa, et al. delusions are associated with poor cognitive insight in schizophrenia. schizophr bull. 2010;36(4):830–5. article pubmed google scholar simonsen c, sundet k, vaskinn a, birkenaes ab, engh ja, faerden a, et al. neurocognitive dysfunction in bipolar and schizophrenia spectrum disorders depends on history of psychosis rather than diagnostic group. schizophr bull. 2011;37(1):73–83. article pubmed google scholar mirza s, lima cnc, del favero-campbell a, rubinstein a, topolski n, cabrera-mendoza b, et al. blood epigenome-wide association studies of suicide attempt in adults with bipolar disorder. transl psychiatry. 2024;14(1):70. article cas pubmed pubmed central google scholar gillespie cf, bradley b, mercer k, smith ak, conneely k, gapen m, et al. trauma exposure and stress-related disorders in inner city primary care patients. gen hosp psychiatry. 2009;31(6):505–14. article pubmed pubmed central google scholar aryee mj, jaffe ae, corrada-bravo h, ladd-acosta c, feinberg ap, hansen kd, et al. minfi: a flexible and comprehensive bioconductor package for the analysis of infinium dna methylation microarrays. bioinformatics. 2014;30(10):1363–9. article cas pubmed pubmed central google scholar just ac, heiss ja. ewastools: ewas tools. 2023. pidsley r, wong ccy, volta m, lunnon k, mill j, schalkwyk lc. a data-driven approach to preprocessing illumina 450k methylation array data. bmc genomics. 2013;1(14):293. article google scholar zheng sc, webster ap, dong d, feber a, graham dg, sullivan r, et al. a novel cell-type deconvolution algorithm reveals substantial contamination by immune cells in saliva. buccal cervix epigenomics. 2018;10(7):925–40. article cas pubmed google scholar salas la, koestler dc. flowsorted.blood.epic: illumina epic data on immunomagnetic sorted peripheral adult blood cells. [internet]. 2024. available from: https://github.com/immunomethylomics/flowsorted.blood.epic katrinli s, wani ah, maihofer ax, ratanatharathorn a, daskalakis np, montalvo-ortiz j, et al. epigenome-wide association studies identify novel dna methylation sites associated with ptsd: a meta-analysis of 23 military and civilian cohorts. genome med. 2024;16(1):147. article cas pubmed pubmed central google scholar teschendorff ae, breeze ce, zheng sc, beck s. a comparison of reference-based algorithms for correcting cell-type heterogeneity in epigenome-wide association studies. bmc bioinform. 2017;18(1):105. article google scholar salas la, koestler dc, butler ra, hansen hm, wiencke jk, kelsey kt, et al. an optimized library for reference-based deconvolution of whole-blood biospecimens assayed using the illumina humanmethylationepic beadarray. genome biol. 2018;19(1):64. article pubmed pubmed central google scholar houseman ea, accomando wp, koestler dc, christensen bc, marsit cj, nelson hh, et al. dna methylation arrays as surrogate measures of cell mixture distribution. bmc bioinform. 2012;13(1):86. article google scholar strom ni, gerring zf, galimberti m, yu d, halvorsen mw, abdellaoui a, et al. genome-wide analyses identify 30 loci associated with obsessive-compulsive disorder [internet]. medrxiv; 2025 [cited 2025 may 1]. p. 2024.03.13.24304161. available from: https://www.medrxiv.org/content/ . https://doi.org/10.1101/2024.03.13.24304161v2 halvorsen mw, de schipper e, bäckman j, strom ni, hagen k, lindblad-toh k, et al. a burden of rare copy number variants in obsessive-compulsive disorder. mol psychiatry. 2025;30(4):1510–7. article cas pubmed google scholar werner mcf, wirgenes kv, shadrin a, lunding sh, rødevand l, hjell g, et al. immune marker levels in severe mental disorders: associations with polygenic risk scores of related mental phenotypes and psoriasis. transl psychiatry. 2022;12(1):38. article cas pubmed pubmed central google scholar nievergelt cm, maihofer ax, klengel t, atkinson eg, chen cy, choi kw, et al. international meta-analysis of ptsd genome-wide association studies identifies sex- and ancestry-specific genetic risk loci. nat commun. 2019;10(1):4558. article pubmed pubmed central google scholar tian y, morris tj, webster ap, yang z, beck s, feber a, et al. champ: updated methylation analysis pipeline for illumina beadchips. bioinformatics. 2017;33(24):3982–4. article cas pubmed pubmed central google scholar hansen kd. illuminahumanmethylation450kanno.ilmn12.hg19: annotation for illumina’s 450k methylation arrays. 2021. pidsley r, zotenko e, peters tj, lawrence mg, risbridger gp, molloy p, et al. critical evaluation of the illumina methylationepic beadchip microarray for whole-genome dna methylation profiling. genome biol. 2016;17(1):208. article pubmed pubmed central google scholar zhang z, zeng c, zhang w. characterization of the illumina epic array for optimal applications in epigenetic research targeting diverse human populations. epigenetics commun. 2022;1(2):7. article google scholar infinium methylationepic v2.0 product files [internet]. [cited 2024 nov 28]. available from: https://support.illumina.com/downloads/infinium-methylationepic-v2-0-product-files.html rousseeuw pj. silhouettes: a graphical aid to the interpretation and validation of cluster analysis. j comput appl math. 1987;1(20):53–65. article google scholar maechler m, rousseeuw p, struyf a, hubert m, hornik k. cluster: cluster analysis basics and extensions [internet]. 2023. available from: https://cran.r-project.org/package=cluster wickham h. ggplot2: elegant graphics for data analysis [internet]. new york, ny: springer; 2009 [cited 2023 may 22]. available from: https://link.springer.com/ https://doi.org/10.1007/978-0-387-98141-3 wilke co. cowplot: streamlined plot theme and plot annotations for ‘ggplot2’ [internet]. 2024. available from: https://wilkelab.org/cowplot/ pedersen tl. patchwork: the composer of plots [internet]. 2024. available from: https://patchwork.data-imaginist.com inc pt. collaborative data science [internet]. montreal, qc: plotly technologies inc.; 2015. available from: https://plot.ly vaidyanathan r, xie y, allaire jj, cheng j, sievert c, russell k. htmlwidgets: html widgets for r [internet]. 2023. available from: https://cran.r-project.org/package=htmlwidgets wei t, simko v. r package ‘corrplot’: visualization of a correlation matrix [internet]. 2024. available from: https://github.com/taiyun/corrplot download references acknowledgements we thank all individuals who have provided samples for this study. in bergen, our sincere thanks go to helene nilsen, marie karin bjorøy, and lisa vårdal for organizing the samples, as well as to nadine fricker from life&brain for her exceptional service. we thank all clinicians for their support in participant recruitment, and we appreciate the technical support of all the staff, volunteers and participants from the grady trauma project. grammar corrections in this manuscript were assisted by gpt-4o (openai). funding open access funding provided by university of bergen. this work was performed on the safe facilities owned by the university of bergen and the tsd (tjeneste for sensitive data) facilities, owned by the university of oslo, operated and developed by the tsd service group at the university of oslo, it-department (usit) (tsd-drift@usit.uio.no). the authors would like to acknowledge support from: the research council of norway (rcn) for the top cohort (273291, 273446, 326813, 223273, 324499, 324252), the trond mohn foundation, nimh r01mh110427, and stiftelsen kristian gerhard jebsen (skgj med-02) for the bcbp-ocd cohort, and grants from the john s. dunn foundation and pat rutherford chair in psychiatry at uthealth houston. kdh was supported by a phd fellowship from the university of bergen. ak smith was supported by 2r01mh108826 and sk by k12hd085850 from nih. grf is supported by k01mh121580 from nimh. the funders did not have a role in design, analysis or publication. author information authors and affiliations department for clinical medicine, university of bergen, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum, jan haavik, kristen hagen, bjarne hansen & stéphanie le hellard dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard department of psychiatry, mclean hospital, harvard medical school, belmont, ma, usa kira d. höffler & kerry ressler department of gynecology and obstetrics, emory university, atlanta, ga, usa seyma katrinli & alicia k. smith department of genetics, university of north carolina at chapel hill, chapel hill, nc, usa matthew w. halvorsen & james j. crowley center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway kevin s. o’connell, alexey shadrin, srdjan djurovic & ole a. andreassen department of medical genetics, oslo university hospital and university of oslo, oslo, norway kevin s. o’connell, alexey shadrin & srdjan djurovic section for precision psychiatry, oslo university hospital, oslo, norway alexey shadrin & ole a. andreassen department of psychiatry, university of north carolina at chapel hill, chapel hill, nc, usa james j. crowley department of biomedicine, university of bergen, bergen, norway jan haavik department of psychiatry, møre and romsdal hospital trust, molde, norway kristen hagen department of mental health, norwegian university of science and technology, trondheim, norway kristen hagen department of clinical psychology, university of bergen, bergen, norway gerd kvale center for crisis psychology, university of bergen, bergen, norway bjarne hansen faillace department of psychiatry and behavioral sciences, mcgovern medical school, the university of texas health science center at houston, houston, tx, usa jair c. soares & gabriel r. fries department of psychiatry and behavioral sciences, emory university, atlanta, ga, usa alicia k. smith authors kira d. höffler view author publications search author on: pubmed google scholar seyma katrinli view author publications search author on: pubmed google scholar matthew w. halvorsen view author publications search author on: pubmed google scholar anne-kristin stavrum view author publications search author on: pubmed google scholar kevin s. o’connell view author publications search author on: pubmed google scholar alexey shadrin view author publications search author on: pubmed google scholar srdjan djurovic view author publications search author on: pubmed google scholar ole a. andreassen view author publications search author on: pubmed google scholar james j. crowley view author publications search author on: pubmed google scholar jan haavik view author publications search author on: pubmed google scholar kristen hagen view author publications search author on: pubmed google scholar gerd kvale view author publications search author on: pubmed google scholar kerry ressler view author publications search author on: pubmed google scholar bjarne hansen view author publications search author on: pubmed google scholar jair c. soares view author publications search author on: pubmed google scholar gabriel r. fries view author publications search author on: pubmed google scholar alicia k. smith view author publications search author on: pubmed google scholar stéphanie le hellard view author publications search author on: pubmed google scholar contributions kd hoeffler, ak stavrum, and slh contributed to the design of the study. kd hoeffler developed the adapted approach and, together with sk and grf, tested it in the cohorts. mwh, kso, and a. shadrin performed genotyping quality control and ancestry prediction. sd and k. hagen were responsible for data acquisition. oaa, jjc, jh, gk, bh, jcs, ak smith, and slh served as site principal investigators and contributed data. ak stavrum, tk, kr, and slh supervised the research progress. kd hoeffler was the main contributor to writing the manuscript. ak stavrum, slh, sk, and grf also contributed to writing the manuscript. all authors read, edited, and approved the final manuscript. corresponding authors correspondence to kira d. höffler or stéphanie le hellard . ethics declarations ethics approval and consent to participate the current project was approved ​​the regional committee for research ethics (top cohort: #2009/2485; bcbp-ocd cohort: #2019/1097, gtp was approved by the irbs of emory university school of medicine and the research oversight committee of grady memorial hospital, uthealth houston was approved by irb #hsc-ms-09–0340). all participants provided informed consent. competing interests oaa is a consultant to cortechs.ai and precision health as, and has received speakers' honorarium from lundbeck , otsuka , janssen , bms , and lilly . the other authors declare that they have no competing interests. additional information publisher's note springer nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations. supplementary information overview of supplementary materials: supplementary figure s1 supplementary figure s2 supplementary figure s3 supplementary figure s4 supplementary figure s5 supplementary figure s6 supplementary figure s7 supplementary figure s8 supplementary figure s9 supplementary figure s10 supplementary figure s11 supplementary figure s12 supplementary figure s13 supplementary figure s14 supplementary figure s15 supplementary table s1 supplementary table s2 supplementary table s3 rights and permissions open access this article is licensed under a creative commons attribution 4.0 international license, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the creative commons licence, and indicate if changes were made. the images or other third party material in this article are included in the article’s creative commons licence, unless indicated otherwise in a credit line to the material. if material is not included in the article’s creative commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. to view a copy of this licence, visit http://creativecommons.org/licenses/by/4.0/ . reprints and permissions about this article cite this article höffler, k.d., katrinli, s., halvorsen, m.w. et al. optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches. epigenetics & chromatin 18 , 69 (2025). https://doi.org/10.1186/s13072-025-00627-0 download citation received : 02 may 2025 accepted : 29 august 2025 published : 14 october 2025 doi : https://doi.org/10.1186/s13072-025-00627-0 share this article anyone you share the following link with will be able to read this content: get shareable link sorry, a shareable link is not currently available for this article. copy shareable link to clipboard provided by the springer nature sharedit content-sharing initiative keywords epigenetics dna methylation ancestry ewas mwas download pdf advertisement window.sn = window.sn || {}; window.sn.libs = window.sn.libs || {}; window.sn.libs.ads = window.sn.libs.ads || {}; window.sn.libs.ads.slotconfig = window.sn.libs.ads.slotconfig || {}; window.sn.libs.ads.slotconfig['mpu1'] = { 'pos': 'mpu1' }; window.sn.libs.ads.slotconfig['unitpath'] = '/270604982/bmc/epigeneticsandchromatin/articles'; window.sn.libs.ads.slotconfig['type'] = 'article'; window.sn.libs.ads.slotconfig['kwrd'] = 'epigenetics,dna methylation,ancestry,ewas,mwas'; window.sn.libs.ads.slotconfig['doi'] = '10.1186/s13072-025-00627-0'; window.sn.libs.ads.slotconfig['pmc'] = 'l32030,b12008,l32020,l16008,b12010,b12030'; epigenetics & chromatin issn: 1756-8935 contact us submission enquiries: journalsubmissions@springernature.com read more on our blogs receive bmc newsletters manage article alerts language editing for authors scientific editing for authors policies accessibility press center support and contact leave feedback careers follow bmc bmc twitter page bmc facebook page bmc weibo page by using this website, you agree to our terms and conditions , your us state privacy rights , privacy statement and cookies policy. your privacy choices/manage cookies we use in the preference centre. © 2025 biomed central ltd unless otherwise stated. part of springer nature .## Methods
we developed and adapted the adapted epiancer+ approach, which includes (1) residualizing the cpg data overlapping with common snps for control probe pcs, sex, age, and cell type proportions to remove the effects of technical and biological factors, and (2) integrating the residualized data with genotype calls from the snp probes (commonly referred to as rs probes) present on the arrays, before calculating pcs and evaluated the clustering ability and relationship to genetic ancestry. results the pcs generated by epiancer+ led to improved clustering for repeated samples from the same individual and stronger associations with genetic ancestry groups predicted from genotype information compared to the original approach. epiancer+ also outperformed the use of dna methylation pcs or surrogate variables for ancestry adjustment. conclusions we show that the epiancer + approach improves the adjustment for genetic ancestry in dna methylation studies. epiancer+ can be integrated into existing r pipelines for commercial methylation arrays, such as 450 k, epic v1, and epic v2. the code is available on github ( https://github.com/kirahoeffler/epiancer ). background genetic ancestry is an important confounding factor in dna methylation studies and should ideally be adjusted for using principal components (pcs) derived from genetic information (i.e. genotypes). however, when genotype data is not available for all study participants, self-reported ancestry data is commonly used to adjust for ancestry in dna methylation studies, often leading to the exclusion of non-europeans and individuals with mixed genetic backgrounds, and to sub-optimal correction. this practice is problematic due to the historical underrepresentation of non-europeans in epigenetic research [ 1 ] and the inherent flaws of self-reported data, which fail to capture the continuous nature of genetic variation and inadequately address the complexity of mixed ancestry backgrounds. to ensure the generalizability of research findings, dna methylation studies should avoid excluding individuals based on genetic background. two main methods are available to adjust for genetic ancestry in dna methylation studies lacking genotyping data. the method by barfield et al. from 2014 [ 2 ] calculates pcs from dna methylation data of cpgs near or overlapping single nucleotide polymorphisms (snps), selected based on the 1000 genomes project [ 3 ] data. however, this approach does not account for technical and biological factors such as sex, age, and cell type proportions, resulting in the first ancestry pc not being regularly associated with genetic ancestry [ 2 ] and potentially introducing multicollinearity with other adjusted factors in the final model. the epistructure [ 4 ] approach calculates pcs from dna methylation of cpgs highly correlated with cis-located snp probes while considering cell-type composition. this method is not easily integrated into existing r-based pipelines because it is a python program and requires several steps of input file adaptation. additionally, it has not been updated since 2017 and does not accommodate the epic v2 array. other methods based on dna methylation, such as surrogate variables and methylation pcs from the whole array data, do not specifically adjust for ancestry. therefore, there is a need for a reliable method to adjust for ancestry in dna methylation studies where genotype data is not available that can easily be incorporated into existing pipelines. our aim was to provide such a method by improving the approach by barfield et al.'s [ 2 ] through the use of methylation data from cpgs overlapping with snp probes that are residualized for technical and biological factors (i.e. cell type proportion pcs, sex, age, and control probe pcs) and information from genotyping snp rs probes on the array. we hypothesized that ancestry pcs from our adapted approach would result in better clustering of genetically predicted ancestry groups and repeated samples from the same individual, stronger associations with genetic ancestry, and stronger correlations with genetic pcs. we tested the performance of our approach against the existing one using two norwegian cohorts (bcbp-ocd and top [ 5 , 6 ,]– [ 7 ]) and two us-american cohorts: uthealth houston [ 8 ] and grady trauma project (gtp) [ 9 ]. an easy-to-use function for our adapted approach is provided on github, along with detailed guidance on parameter settings and input file structure for implementation ( https://github.com/kirahoeffler/epiancer ). methods tested cohorts the different approaches were tested in two cohorts from norway and two cohorts from the united states, including individuals with available dna methylation data and ancestry information (either genetically predicted or self-reported, table 1 ). the inclusion criteria were passing dna methylation quality control and, if available, genotyping quality control. samples from individuals with mixed ancestry (based on the available data, as described in the genetic ancestry prediction section) were excluded from performance testing solely for methodological reasons, because evaluating classification accuracy requires clearly defined ancestry groups, and admixed individuals typically fall between clusters. this is not a limitation of epiancer+ , which produces continuous ancestry pcs that capture both discrete and admixed variation, making it fully applicable to individuals with mixed ancestry. table 1 cohorts on which the approaches were tested full size table dna methylation in the bcbp-ocd cohort, dna methylation was measured using the illumina epic v2 array at life&brain gmbh in bonn, germany. samples were excluded if they showed: mismatches between reported and predicted sex, outliers in the minfi [ 10 ] sex plot, genotype mismatches between repeated samples [ 11 ], low bisulfite conversion efficiency (< 80%) calculated with the watermelon [ 12 ] package, more than 5% missing data (after applying a detection p value threshold of 10e −16 ), or outlier patterns in beta value distribution plots [ 10 ]. saliva cell type proportions were estimated using hepidish [ 13 ] with the rpc method. the centepifibfatic.m dataset, excluding fat, was used as the main reference, while the centbloodsub.m dataset functioned as the secondary reference [ 13 ]. in the top cohort [ 5 , 6 ,]– [ 7 ], dna methylation was measured using the illumina epic v1 array at life and brain gmbh in bonn, germany, and quality controlled in three batches. samples were excluded if at least 1% of sites had a detection p -value > 0.01, if snp genotypes from the rs probes on the epic array did not match genotype data from the same samples, or there was a discrepancy between the sex predicted from dna methylation data and the reported sex [ 5 ]. the blood cell type proportions were calculated using the estimatecellcounts2 function from flowsorted.blood.epic [ 14 ] package. in the gtp cohort [ 9 ], dna methylation was measured using the illumina epic v1 array and quality controlled using the psychiatric genomics consortium (pgc)-ptsd epigenetics pipeline [ 15 ] (available at https://github.com/pgc-ptsd-ewas/epic_qc ). briefly, samples were excluded if their probe detection call rates were below 90% (after applying a detection p value threshold of 0.01) or if their average intensity values were either less than half of the overall sample mean or below 2000 arbitrary units (au). blood cell composition - including cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and neutrophils - was estimated using the robust partial correlation (rpc) method in epidish [ 16 ], utilizing a reference dataset specific to the epic array [ 17 ]. in the uthealth houston cohort [ 8 ], dna methylation was measured using the illumina epic v1 array. samples with a mean detection p-value below 0.05 were set to be excluded; however, no samples met this criterion, so none were excluded. white blood cell count proportions (cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and granulocytes) were estimated using the houseman algorithm [ 18 ]. genetic ancestry prediction bcbp-ocd: genotyping data for the bcbp-ocd cohort were processed following the quality control procedures described in the latest pgc ocd gwas study [ 19 ]. ancestry prediction was performed as outlined by halvorsen et al. [ 20 ], using principal component analysis and a random forest classifier trained on 1000 genomes project phase 3 data [ 3 ]. top: genotyping data and quality control procedures for the top cohort are described in detail in previous work [ 21 ]. ancestry was inferred from genotyping data using a random forest classifier trained on population reference data from the 1000 genomes project [ 3 ], as previously described [ 5 ]. gtp : genotyping was performed using illumina omni-quad 1 m, and genotypes were called in illumina’s genomestudio. genotype data quality control and calculation of pcsoty were performed according to the pgc guidelines [ 22 ]. ancestry was predicted as described by nievergelt et al. [ 22 ]. uthealth houston: ancestry information was assessed by self-report, as genotyping data were not available. epiancer+ approach the epiancer+ approach uses the minfi [ 10 ], champ [ 23 ], and watermelon [ 12 ] packages in r (developed in version 4.4.0) to generate “ancestry pcs”, which can be incorporated into final analysis models for samples that have passed general quality control. the approach consists of two main functions: ancestry_info() and ancestry_pca(). ancestry_info() function the ancestry_info() function uses an rgset that has been background-corrected using the bg.correct.illumina() [ 10 ] function. data from control probes, snp rs probes, bead counts, and detection p-values are extracted, as well as intensities of type i probes (split into green and red channels) and type ii probes. a detection p-value threshold of 10e −16 is applied, setting values above this threshold as missing. the intensities are filtered to include only cpgs overlapping with snps, referred to as snp0bp probes. the probes are selected using the same underlying criteria across all arrays, though the implementation depends on the structure of the available array-specific annotation: 450 k array: from the illuminahumanmethylation450kanno.ilmn12.hg19 [ 24 ] annotations, selecting snps probes from cpg_rs column overlapping with cpg sites filtered based on minor allele frequency (maf) ≥ 0.05. epic v1 array: from the pidsley et al . [ 25 ] and zhang et al . [ 26 ] annotations, selecting probes in either or both publications overlapping with snps (distance = 0) with a maf ≥ 0.05 epic v2 array: from annotations provided by illumina [ 27 ], selecting probes overlapping with snps (distance = 0) with a maf ≥ 0.05 the number of selected ancestry-informative probes was 7295 for the 450 k array, 3622 for the epic v1 array, and 2,674 for the epic v2 array. probes with low bead counts (where > 5% of samples have a bead count below 3) or low call rates (where > 10% of samples have missing data) are excluded. after filtering, the intensity values are quantile normalized, and beta values are calculated. missing values are imputed using the champ.impute() [ 23 ] function. beta values for the snp0bp probes are then residualized to adjust for cell count pcs, sex, age, and ten pcs derived from control probes, which capture a broad range of technical variation, including slide, array position, scanner effects, dna quality, and bisulfite conversion efficiency. this residualized data is referred to as epiancer . finally, the residualized snp0bp data is combined with the genotype calls from rs snp probes, which is referred to as epiancer+ . ancestry_pca() function the ancestry_pca() function takes the processed data from ancestry_info() and uses it to calculate ancestry pcs. these pcs are intended to be included in analysis models as covariates to control for ancestry-related variation. for further details and access to the code, please refer to the code on github ( https://github.com/kirahoeffler/epiancer ). performance tests three versions of ancestry pcs were compared: the original barfield [ 2 ] et al. approach ( epiancorig ), the adapted approach after only performing the residualization step ( epiancer ), and the further adapted approach combining the residualised data with called genotypes from rs probes ( epiancer+ ). to ensure comparability across approaches, the pca results were min–max scaled to a range between 0 and 1. associations between ancestry pcs and ancestry group were tested using anova when assumptions of normality and variance homogeneity were met. otherwise, kruskal–wallis tests with the rstatix [ 2 ] package were used. to evaluate clustering performance, silhouette scores [ 28 ], which range from -1 to 1 (with higher values indicating better clustering), were calculated using the cluster [ 29 ] package. these scores were used to evaluate clustering performance at both the ancestry group level and the individual (repeated samples) level. in addition, three-dimensional (3d) centroids of both ancestry group and individual (repeated samples) clusters were calculated. cluster density was assessed by calculating the mean euclidean 3d distance from each sample to the centroid of its respective group. to determine the separation between ancestry group clusters, a distance matrix was generated to measure the distances between the centroids of different ancestry groups. in the bcbp-ocd cohort, the absolute correlation between the first three ancestry pcs and the first three genotyping pcs was calculated to evaluate how effectively the methylation-based pcs capture the genetic ancestry background. visualization of results was performed using ggplot2 [ 30 ], cowplot [ 31 ], patchwork [ 32 ], plotly [ 33 ], htmlwidgets [ 34 ], and corrplot [ 35 ] packages. comparison with dna methylation pcs and surrogate variables in the bcbp-ocd sample, we compared the performance of epiancer+ with that of the first three dna methylation pcs and the first three surrogate variables (svs), using the same evaluation approach described above. dna methylation pcs were calculated from normalized m-values from autosomal probes. surrogate variable analysis was performed on the m-values. the full model included case–control status, age, sex, two cell type pcs, and ten control probe pcs. the null model excluded case–control status. ancestry group associations with technical and biological adjustment factors associations between ancestry groups and the factors used to residualize snp0bp data were tested using either linear models for datasets with two ancestry groups or anova when multiple ancestry groups were present (with a common p-value for the effect across all groups). for control probe pcs and cell type pcs in datasets with repeated samples, linear mixed-effect models were employed to test the association with the ancestry groups. these models included a random intercept to account for repeated measures from the same individual. two models were compared: (a) a full model that included ancestry group as a predictor and the pcs as outcome; (b) a null model that excluded ancestry group. a likelihood ratio test was performed to determine if the full model fit the data significantly better than the null model. additionally, to assess whether residualized biological and technical covariates confounded our epiancer+ pcs, we performed linear regression and partial r 2 analyses in the gtp cohort. for each of the top three epiancer+ pcs, we quantified the unique variance explained by (i) the top three genotype-derived ancestry pcs, (ii) residualized covariates (sex, age, top 10 control probe pcs, and 6 cell proportion pcs), and (iii) both sets together. unique variance was computed using partial r 2 , representing the proportion of variance in each epiancer+ pc explained by one set of predictors after accounting for the other. practical example in the uthealth houston cohort, we conducted an analysis of bipolar case–control status, adjusting for sex, age, smoking status, five cell type proportion pcs, five control pcs, and 0, 2, 5, or 10 ancestry pcs calculated with epiancer + . this setup allowed us to compare the impact of including different numbers of ancestry pcs on the genomic inflation factor (λ). results we evaluated the performance of ancestry pcs in capturing genetic ancestry, comparing the original approach by barfield et al. [ 2 ] ( epiancorig ) with two adapted versions. the first adaptation step involved residualizing cpg data overlapping with snps to adjust for technical and biological confounders ( epiancer ). the second adaptation combined the residualized values with called genotypes from rs probes ( epiancer+ ). scatterplots when plotting ancestry pcs against each other, distinct ancestry groups should ideally form dense and separate clusters, while repeated samples from the same individuals should cluster closely together. in the bcbp-ocd cohort (fig. 1 a-c; figure s1-s3), all approaches visually distinguished ancestry groups in the first two pcs. notably, while the original approach ( epiancorig ) separated ancestry primarily along the second pc, both adapted approaches achieved separation along the first pc. in the top cohort (fig. 1 d-f; figure s4-s6), the epiancorig approach failed to separate ancestry groups. in contrast, epiancer successfully differentiated african and east asian samples, with further improvement using epiancer+ , separating all ancestry groups. in the gtp cohort, both the epiancorig and adapted approaches differentiate ancestry group, with no major observable differences between them (figures. 1 g-i and s7-s9). in the uthealth houston cohort, the epiancorig approach appears to produce slightly clearer separations and denser clusters compared to the adapted approaches (figs. 1 j-l and s10-s12). fig. 1 scatterplots of the first two ancestry pcs plotted against each other, calculated using different approaches. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur european, lat latin american, pi pacific islander , sas south asian full size image association between the ancestry pcs and the ancestry groups to optimally adjust for ancestry, a strong association between ancestry pcs and ancestry groups is needed, particularly for the first ancestry pc. in the bcbp-ocd cohort (fig. 2 a, table s1a), both adapted approaches had a much stronger association between the first ancestry pc and the ancestry groups (both p = 1.47e-20) compared to the epiancorig approach (p = 0.032), aligning with the observations in the scatterplots (fig. 1 a-c). the epiancorig approach showed the strongest association only with the second ancestry pc (p = 1.47e-20), while epiancer+ (p = 1.68e-09) had a stronger association than epiancer (p = 0.001) for the second ancestry pc. fig. 2 association between the first three ancestry pcs and the ancestry groups. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort (fig. 2 b, table s1b), the strongest association between the first ancestry pc and the ancestry groups was observed for epiancer+ (p = 1.15e-22), followed by epiancer (p = 2.19e-10), while there was no association with the epiancorig approach (p = 1). the epiancorig approach showed a significant association only for the third ancestry pc (p = 6.62e-13). in the gtp cohort, there was no notable difference in the association between the first ancestry pc and ancestry groups (fig. 2 c, table s1c), while in the uthealth houston cohort, the first ancestry pc from the epiancorig approach showed stronger associations with ancestry groups than the adapted approaches (fig. 2 d, table s1d). repeated sample clustering we next assessed the clustering of repeated samples from the same individuals when plotting ancestry pcs against each other. this analysis was done in both the bcbp-ocd and top cohorts that included repeated samples. to quantify clustering, we used silhouette scores (higher scores indicate better clustering) and calculated the 3d distances from the repeated sample to the 3d centroid of the respective individual. repeated samples should cluster closely together, as genetic ancestry remains consistent over time. in the bcbp-ocd cohort, repeated samples clustered more tightly using the adapted approaches compared to the epiancorig approach. this was reflected in higher silhouette scores (fig. 3 a, table s2a) and smaller distances to the individual’s centroid (fig. 3 b, table s2b). there was little difference between epiancer and epiancer+ . fig. 3 repeated sample clustering. clustering performance of repeated samples from individuals was tested using silhouette scores and 3d distance to the individual’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort, the epiancer+ approach resulted in the best clustering, with the highest average silhouette score (fig. 3 c, table s2a) and the smallest average distance to the centroid (fig. 3 d, table s2b). however, in the top cohort, only three individuals had repeated samples, with each having two samples. ancestry level clustering next, we assessed how well different ancestry groups cluster by plotting the first three ancestry pcs against each other. ideally, samples within the same ancestry group should cluster closely together, while different ancestry groups should be well-separated. clustering was quantified with silhouette scores and 3d distances both between ancestry clusters and within clusters (from the samples to the respective centroid of the individual). in the bcbp-ocd cohort, the silhouette scores improved from the epiancorig approach (0.2419) to epiancer (0.2610) and showed only slight further improvement for epiancer+ (0.2693) (fig. 4 a, table s3a-b). the highest mean distances between ancestry clusters were observed with epiancer+ , followed by epiancer and the epiancorig approach (fig. 4 b, table s3c). distances within clusters presented a mixed picture: while most ancestry groups had tighter clusters with the adapted approaches, the south asian group showed a wider cluster (fig. 4 c, table s3c). fig. 4 ancestry group clustering. clustering performance of samples from different ancestries was tested using silhouette scores and 3d distance to the ancestry group’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur: european, lat latin american, pi pacific islander, sas south asian full size image in the top cohort, the average silhouette scores for epiancorig (0.06964) and epiancer (0.01417) were lower than for epiancer+ (0.25019) (fig. 4 d, table s3a). clustering varied across ancestry groups, with european, east asian, and african ancestries showing the best clustering under epiancer+ , as indicated by higher silhouette scores (fig. 4 d, table s3b), slightly higher distances between the ancestry clusters (fig. 4 e, table s3c), and lower distances of samples to the cluster centroid (fig. 4 f, table s3c) compared to the other approaches. in the gtp cohort (fig. 45g-i, table s3a-c), the epiancorig approach produced the highest silhouette score (0.5990), followed by epiancer+ (0.5732) and epiancer (0.5579). this result was primarily driven by larger distances between clusters in the epiancorig approach, followed by epiancer+ and epiancer . in the uthealth houston cohort (fig. 4 j-l, table s3a-c), the epiancorig approach also showed the highest silhouette score (0.07268), compared to epiancer+ (-0.0567) and epiancer (-0.0083). this was mainly due to larger distances between the african ancestry cluster to the other clusters and smaller distances within the asian cluster under the epiancorig approach. comparison with dna methylation pcs (dnampcs) and surrogate variables (svs) we compared the performance of epiancer+ with dnampcs and svs in the bcbp-ocd cohort. epiancer+ consistently outperformed both approaches. visually, it produced better clustering of samples (figure s13), which was reflected in a higher mean silhouette score ( epiancer+ : 0.293; svs: -0.226; dnampcs: -0.245). statistically, the first epiancer+ pc showed a strong association with ancestry groups, whereas only the third dnampc and sv demonstrated ancestry association, and with lower significance (table s 1 e (supplementary), figure s14). for repeated samples from the same individual, epiancer+ again performed better, achieving a higher mean 3d silhouette score (0.325) compared with dnampcs (-0.599) and svs (-0.603). association of ancestry groups with genotyping pcs for dna methylation-based ancestry pcs to effectively capture genetic background information, they should exhibit a strong correlation with genotyping pcs, especially between the first ancestry pc and the first genotyping pc, as both are expected to account for the majority of genetic variation. pearson correlation analysis was performed between ancestry and genotyping pcs in the bcbp-ocd cohort, which had readily available genotyping data. importantly, both adapted approaches ( epiancer and epiancer+ ) showed a strong correlation between the first ancestry pc and the first genotyping pc (r = 0.875, fig. 5 b-c). in contrast, the epiancorig approach showed no correlation between the first ancestry pc and the first genotyping pc (r = 0.001, fig. 5 a). the mean correlation of the first three genotyping pcs with the first three ancestry pcs was highest for epiancer+ (mean r = 0.173), followed by epiancer (mean r = 0.156), and lowest for the epiancorig approach (mean r = 0.146). fig. 5 correlation between the first three ancestry pcs and the first three genotyping pcs. correlation analyses were performed in the bcbp-ocd cohort. ancestry pcs are referred to as pcs 1–3 and genotyping pcs as gt_pc1-3. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the gtp cohort, partial r 2 analyses showed that epiancer+ pc1 captured substantial true ancestry signal (94.4%) but also retained variance explained by residualized covariates (40.5%). pc2 was minimally associated with ancestry (0.5%) or residualized factors (3.4%). pc3 was predominantly explained by residualized variables (49.4%) and showed little ancestry signal (1.1%). these results indicate that, while pc1 largely reflects true ancestry, some pc3 is strongly influenced by residualized technical and biological variation. this pattern is consistent with an unbalanced experimental design that induces correlations between ancestry and residualized factors. ancestry group associations with technical and biological adjustment factors to assess potential confounding, we tested whether factors adjusted for during residualization (sex, age, cell type proportions, and control probe pcs) were associated with ancestry groups, as such associations could inadvertently reduce true ancestry signals if these factors are unevenly distributed across batches or groups. in the bcbp-ocd cohort, none of the factors included in the residualization step were associated with ancestry groups (table s4a). in the top cohort, sex, several cell type proportion pcs (1, 2, 4, 5) but only the sixth control probe pc showed significant associations with ancestry groups (table s4b). in the gtp cohort, age, the second, fourth, and ninth control probe pcs, and the first and second cell type proportion pcs were significantly associated with ancestry groups (table s4c). in the uthealth houston cohort, the first and second cell type pcs were significantly associated with ancestry groups as well, along with the eighth to tenth control probe pcs (table s4d). practical example in the uthealth houston cohort, we analyzed bipolar case–control status while adjusting for varying numbers of ancestry pcs calculated with epiancer+ . the genomic inflation factor (λ) is ideally close to 1, as values above 1 may indicate population stratification or other confounding effects. without adjusting for any ancestry pcs, λ was 1.087. adding 2 ancestry pcs reduced λ to 1.023, and adding 5 ancestry pcs further reduced it to 1.008. however, adding 10 ancestry pcs increased λ slightly to 1.056. these results indicate that adjusting for ancestry pcs effectively reduces batch effects introduced by ancestry, with 5 pcs being optimal in this case. including more pcs than necessary (as with 10 pcs here) can reintroduce noise. discussion we demonstrated that adjusting for genetic ancestry in dna methylation studies by residualizing beta values for known technical and biological factors - prior to calculating ancestry principal components from cpgs overlapping with snps - and integrating the residualized data with genotype calls from the snp probes present on the arrays, improves accuracy compared to the method proposed by barfield et al. (2014) [ 2 ]. in the bcbp-ocd and top cohorts, we observed the same issues that were reported with the original approach by barfield et al. (2014) [ 2 ]: the first ancestry pc calculated using this approach showed weak associations with the ancestry groups, while stronger associations only emerged for the second or third ancestry pcs. there was a lack of correlation between the first genotyping pc and the first ancestry pc. thus, these findings suggest that the first ancestry pc calculated with the barfield et al. [ 2 ] approach, and in some cases even the second ancestry pc, mostly capture influences on dna methylation that are unrelated to ancestry or genetic background. several tests were conducted to assess the performance of the adapted approach compared to the original approach. the results indicated that the adapted approach substantially removed technical and biological variance, particularly in the bcbp-ocd and top cohorts. importantly, the association between the first ancestry pc and different ancestry groups was stronger using the adapted approach. while the addition of called genotypes to the residualization step did not substantially affect results in the bcbp-ocd cohort, the top cohort showed a stronger association between the first ancestry pc and the ancestry groups when called genotypes were included. this highlights that incorporating called genotypes can improve the robustness, especially in cohorts with larger technical effects. a key indicator of the adapted approach’s performance is its ability to cluster repeated samples from the same individuals more closely than the original approach. this is demonstrated by higher silhouette scores, a measure of clustering performance, and tighter clustering, indicated by smaller distances to the centroid within each individual’s cluster, in both the bcbp-ocd and top cohorts. since genetic ancestry is consistent over time, repeated samples should cluster tightly together. the tighter clustering observed with the adapted approach aligns with our expectations, as the original approach is affected by technical and biological influences, such as differing plate positions and variations in cell type estimations across samples from the same individual; the adapted approach effectively corrects for these influences, resulting in more accurate ancestry estimations. in addition to improved individual-level clustering, the different ancestry groups also showed better clustering when plotting ancestry pcs against one another. in the top cohort, where batch effects were more pronounced, incorporating called genotypes resulted in higher silhouette scores compared to using the residualized data alone. in contrast, in the bcbp-ocd cohort, where batch effects were less pronounced, the addition of genotypes had minimal impact on clustering performance at the ancestry group level. the tightness of clusters, measured as the distances of samples to their respective ancestry cluster centroids, yielded mixed results across different ancestry groups. this variability may reflect the adapted approach’s ability to capture greater genetic diversity within ancestry groups when confounding factors are appropriately adjusted for. finally, the adapted approach demonstrated a strong correlation (r = 0.875) between the first ancestry pcs and the first genotyping pc in the bcbp-ocd cohort, whereas no such correlation was observed with the original approach. the first genotyping pc captures most genetic background, which demonstrates the ability of the first ancestry pc to also capture most of the genetic variability. moreover, when examining the mean correlation of the first three ancestry pcs with the first three genotyping pcs, the adapted approach including the called genotypes showed the highest correlations of the compared approaches, capturing more true genetic information. in the bcbp-ocd cohort, epiancer+ showed clearly superior performance compared with dna methylation pcs (dnampcs) and surrogate variables (svs), demonstrating stronger statistical associations with ancestry, better clustering of ancestry groups, and improved clustering of repeated samples. overall, epiancer+ is more effective at capturing true ancestry effects, whereas dnampcs are more likely to capture technical noise and svs tend to reflect other non-ancestry influences. the adjusted method did not perform better for the gtp and uthealth houston cohorts. our partial r 2 analysis in the gtp cohort provides quantitative support for this observation: while epiancer+ pc1 retained strong ancestry signal (94.4% variance explained by genotype pcs), it also contained substantial variance from residualized covariates (40.5%), and pc3 was largely driven by residualized variables (49.4%) with minimal ancestry signal (1.1%). this pattern is consistent with unbalanced study design, where technical and biological covariates are unevenly distributed across ancestry groups, creating correlations between ancestry and residualized factors. these results indicate that some ancestry effect is removed when correcting for biological and technical factors in the residualizing step, because these factors are themselves associated with ancestry. there is a balance between removing the effects of technical and biological factors and removing ancestry information associated with these factors. if batch effects are not too strong but still associated with ancestry, then ancestry clustering does not improve, as seen in the gtp and uthealth houston cohorts. in contrast, substantial improvements are observed in cohorts like the bcbp-ocd cohort, where there is little to no association between ancestry and the factors adjusted for during residualization. similarly, in the top cohort, which has large technical batch effects, residualization had an improving effect despite the removal of some ancestry-related information. the actual performance is sample-specific and depends on the study design, but the method is applicable across a range of sample sizes. thus, it is important to take more care in designing the studies so that technical factors are not associated with ancestry (by a randomized design, balancing ancestry across plates, slides, and slide positions) and that sex and age are as balanced as possible across ancestries. this makes it possible for the residualization step to effectively remove influencing factors while preserving the ancestry effects. limitations one limitation is the relatively low overall mean correlation between the first three ancestry pcs and the first three genotyping pcs (mean r = 0.173 for the adapted approach including the genotypic data), suggesting that it does not fully capture all genotyping effects. however, the high correlation between the first ancestry pc and the first genotyping pc (r = 0.875) indicates that the approach effectively captures most of the genetic variation. despite this, genotyping data remains the gold standard for accurately capturing genetic ancestry and should be used whenever available to adjust for genetic background in dna methylation studies. expanding the coverage of illumina dna methylation arrays to include more sites overlapping with snp probes specifically designed to capture ancestry could enhance the ancestry signal derived from these arrays and improve alignment with genotyping pcs; however, in the design of the epic v2, a substantial number of snp-associated methylation probes were removed (selected ancestry-informative probes: 450 k: n = 7295; epic v1: n = 3622; epic v2: n = 2674). another limitation is that the precision of the performance testing may be affected by the fact that our approach was primarily tested on european samples, with fewer available samples from other ancestries. furthermore, the uthealth houston cohort relied on self-reported ancestry data, which is known to be less accurate and may have led to the inclusion of individuals with mixed or misclassified genetic ancestry. additionally, while "latino" is officially recognized as an ethnicity rather than a genetic ancestry group, we used it in our analysis as a label for an ancestry cluster. this cluster reflects admixed genetic backgrounds - typically indigenous american, european, and african - commonly seen in individuals self-identifying as latino. additionally, the longer runtime of our approach presents a practical limitation, primarily due to the detection p-value calculation step. however, this issue can be mitigated by providing pre-calculated detection p-values as input to the function (if already calculated), significantly reducing processing time. we considered comparing the performance of epiancer+ with epistructure [ 4 ]; however, epistructure has not been updated for the latest arrays and is therefore unlikely to perform reliably on our data. practical implications epiancer+ can be used to adjust for ancestry in all samples, even when technical factors correlate with ancestry, as it successfully clustered samples based on ancestry across all tested datasets. importantly, in cohorts where ancestry is correlated with technical and biological effects, our method ensures that ancestry is not accounted for twice. unlike the method by barfield et al. [ 2 ], which risks collinearity by adjusting for ancestry alongside confounding factors, our adapted method estimates the remaining ancestry effect while preserving relevant variation. compared to epistructure [ 4 ], epiancer+ offers improved usability and compatibility. epistructure is implemented in python within the glint framework and requires multiple preprocessing steps, limiting its integration with standard r-based pipelines. moreover, it has not been updated since 2017 and does not support the epic v2 array. epiancer+ , by contrast, is r-based and supports all major array types (450 k, epic v1, epic v2). ancestry pcs should be calculated only for samples that have passed general quality control. based on our experience, including one or two ancestry pcs is often sufficient for most analyses, though the number required depends on cohort diversity. in highly heterogeneous populations, additional ancestry pcs may be necessary. we recommend testing different models (e.g., using 2, 5, or 10 ancestry pcs) and evaluating their performance using qq plots and genomic inflation factor (λ), as demonstrated in the practical example in the results section. the optimal number of pcs is the one that brings λ closest to 1.0 and gives qq plots with no evidence of inflation, indicating adequate correction for population stratification without overfitting. conclusions adequate adjustment for genetic ancestry is essential in dna methylation studies. when genotyping data is unavailable, it has been suggested to use dna methylation data from illumina arrays overlapping with snps as an alternative. we have improved this approach by accounting for technical and biological influences and incorporating genotypic data from snp probes, offering increased robustness. our adapted approach ( epiancer+ ) is easy to implement in existing r pipelines, including the ones for the epic v2 array, and offers a practical solution for ancestry adjustment. data availability no datasets were generated or analysed during the current study. references breeze ce, beck s, berndt si, franceschini n. the missing diversity in human epigenomic studies. nat genet. 2022;54(6):737–9. article cas pubmed pubmed central google scholar barfield rt, almli lm, kilaru v, smith ak, mercer kb, duncan r, et al. accounting for population stratification in dna methylation studies. genet epidemiol. 2014;38(3):231–41. article pubmed pubmed central google scholar auton a, brooks ld, durbin rm, garrison ep, kang hm, et al. a global reference for human genetic variation (genomes project consortium ). nature. 2015;526(7571):68–74. article pubmed google scholar rahmani e, shenhav l, schweiger r, yousefi p, huen k, eskenazi b, et al. genome-wide methylation data mirror ancestry information. epigenetics chromatin. 2017;10:1. article pubmed pubmed central google scholar wortinger la, stavrum ak, shadrin aa, szabo a, rukke sh, nerland s, et al. divergent epigenetic responses to perinatal asphyxia in severe mental disorders. transl psychiatry. 2024;8(14):16. article google scholar engh ja, friis s, birkenaes ab, jónsdóttir h, klungsøyr o, ringen pa, et al. delusions are associated with poor cognitive insight in schizophrenia. schizophr bull. 2010;36(4):830–5. article pubmed google scholar simonsen c, sundet k, vaskinn a, birkenaes ab, engh ja, faerden a, et al. neurocognitive dysfunction in bipolar and schizophrenia spectrum disorders depends on history of psychosis rather than diagnostic group. schizophr bull. 2011;37(1):73–83. article pubmed google scholar mirza s, lima cnc, del favero-campbell a, rubinstein a, topolski n, cabrera-mendoza b, et al. blood epigenome-wide association studies of suicide attempt in adults with bipolar disorder. transl psychiatry. 2024;14(1):70. article cas pubmed pubmed central google scholar gillespie cf, bradley b, mercer k, smith ak, conneely k, gapen m, et al. trauma exposure and stress-related disorders in inner city primary care patients. gen hosp psychiatry. 2009;31(6):505–14. article pubmed pubmed central google scholar aryee mj, jaffe ae, corrada-bravo h, ladd-acosta c, feinberg ap, hansen kd, et al. minfi: a flexible and comprehensive bioconductor package for the analysis of infinium dna methylation microarrays. bioinformatics. 2014;30(10):1363–9. article cas pubmed pubmed central google scholar just ac, heiss ja. ewastools: ewas tools. 2023. pidsley r, wong ccy, volta m, lunnon k, mill j, schalkwyk lc. a data-driven approach to preprocessing illumina 450k methylation array data. bmc genomics. 2013;1(14):293. article google scholar zheng sc, webster ap, dong d, feber a, graham dg, sullivan r, et al. a novel cell-type deconvolution algorithm reveals substantial contamination by immune cells in saliva. buccal cervix epigenomics. 2018;10(7):925–40. article cas pubmed google scholar salas la, koestler dc. flowsorted.blood.epic: illumina epic data on immunomagnetic sorted peripheral adult blood cells. [internet]. 2024. available from: https://github.com/immunomethylomics/flowsorted.blood.epic katrinli s, wani ah, maihofer ax, ratanatharathorn a, daskalakis np, montalvo-ortiz j, et al. epigenome-wide association studies identify novel dna methylation sites associated with ptsd: a meta-analysis of 23 military and civilian cohorts. genome med. 2024;16(1):147. article cas pubmed pubmed central google scholar teschendorff ae, breeze ce, zheng sc, beck s. a comparison of reference-based algorithms for correcting cell-type heterogeneity in epigenome-wide association studies. bmc bioinform. 2017;18(1):105. article google scholar salas la, koestler dc, butler ra, hansen hm, wiencke jk, kelsey kt, et al. an optimized library for reference-based deconvolution of whole-blood biospecimens assayed using the illumina humanmethylationepic beadarray. genome biol. 2018;19(1):64. article pubmed pubmed central google scholar houseman ea, accomando wp, koestler dc, christensen bc, marsit cj, nelson hh, et al. dna methylation arrays as surrogate measures of cell mixture distribution. bmc bioinform. 2012;13(1):86. article google scholar strom ni, gerring zf, galimberti m, yu d, halvorsen mw, abdellaoui a, et al. genome-wide analyses identify 30 loci associated with obsessive-compulsive disorder [internet]. medrxiv; 2025 [cited 2025 may 1]. p. 2024.03.13.24304161. available from: https://www.medrxiv.org/content/ . https://doi.org/10.1101/2024.03.13.24304161v2 halvorsen mw, de schipper e, bäckman j, strom ni, hagen k, lindblad-toh k, et al. a burden of rare copy number variants in obsessive-compulsive disorder. mol psychiatry. 2025;30(4):1510–7. article cas pubmed google scholar werner mcf, wirgenes kv, shadrin a, lunding sh, rødevand l, hjell g, et al. immune marker levels in severe mental disorders: associations with polygenic risk scores of related mental phenotypes and psoriasis. transl psychiatry. 2022;12(1):38. article cas pubmed pubmed central google scholar nievergelt cm, maihofer ax, klengel t, atkinson eg, chen cy, choi kw, et al. international meta-analysis of ptsd genome-wide association studies identifies sex- and ancestry-specific genetic risk loci. nat commun. 2019;10(1):4558. article pubmed pubmed central google scholar tian y, morris tj, webster ap, yang z, beck s, feber a, et al. champ: updated methylation analysis pipeline for illumina beadchips. bioinformatics. 2017;33(24):3982–4. article cas pubmed pubmed central google scholar hansen kd. illuminahumanmethylation450kanno.ilmn12.hg19: annotation for illumina’s 450k methylation arrays. 2021. pidsley r, zotenko e, peters tj, lawrence mg, risbridger gp, molloy p, et al. critical evaluation of the illumina methylationepic beadchip microarray for whole-genome dna methylation profiling. genome biol. 2016;17(1):208. article pubmed pubmed central google scholar zhang z, zeng c, zhang w. characterization of the illumina epic array for optimal applications in epigenetic research targeting diverse human populations. epigenetics commun. 2022;1(2):7. article google scholar infinium methylationepic v2.0 product files [internet]. [cited 2024 nov 28]. available from: https://support.illumina.com/downloads/infinium-methylationepic-v2-0-product-files.html rousseeuw pj. silhouettes: a graphical aid to the interpretation and validation of cluster analysis. j comput appl math. 1987;1(20):53–65. article google scholar maechler m, rousseeuw p, struyf a, hubert m, hornik k. cluster: cluster analysis basics and extensions [internet]. 2023. available from: https://cran.r-project.org/package=cluster wickham h. ggplot2: elegant graphics for data analysis [internet]. new york, ny: springer; 2009 [cited 2023 may 22]. available from: https://link.springer.com/ https://doi.org/10.1007/978-0-387-98141-3 wilke co. cowplot: streamlined plot theme and plot annotations for ‘ggplot2’ [internet]. 2024. available from: https://wilkelab.org/cowplot/ pedersen tl. patchwork: the composer of plots [internet]. 2024. available from: https://patchwork.data-imaginist.com inc pt. collaborative data science [internet]. montreal, qc: plotly technologies inc.; 2015. available from: https://plot.ly vaidyanathan r, xie y, allaire jj, cheng j, sievert c, russell k. htmlwidgets: html widgets for r [internet]. 2023. available from: https://cran.r-project.org/package=htmlwidgets wei t, simko v. r package ‘corrplot’: visualization of a correlation matrix [internet]. 2024. available from: https://github.com/taiyun/corrplot download references acknowledgements we thank all individuals who have provided samples for this study. in bergen, our sincere thanks go to helene nilsen, marie karin bjorøy, and lisa vårdal for organizing the samples, as well as to nadine fricker from life&brain for her exceptional service. we thank all clinicians for their support in participant recruitment, and we appreciate the technical support of all the staff, volunteers and participants from the grady trauma project. grammar corrections in this manuscript were assisted by gpt-4o (openai). funding open access funding provided by university of bergen. this work was performed on the safe facilities owned by the university of bergen and the tsd (tjeneste for sensitive data) facilities, owned by the university of oslo, operated and developed by the tsd service group at the university of oslo, it-department (usit) (tsd-drift@usit.uio.no). the authors would like to acknowledge support from: the research council of norway (rcn) for the top cohort (273291, 273446, 326813, 223273, 324499, 324252), the trond mohn foundation, nimh r01mh110427, and stiftelsen kristian gerhard jebsen (skgj med-02) for the bcbp-ocd cohort, and grants from the john s. dunn foundation and pat rutherford chair in psychiatry at uthealth houston. kdh was supported by a phd fellowship from the university of bergen. ak smith was supported by 2r01mh108826 and sk by k12hd085850 from nih. grf is supported by k01mh121580 from nimh. the funders did not have a role in design, analysis or publication. author information authors and affiliations department for clinical medicine, university of bergen, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum, jan haavik, kristen hagen, bjarne hansen & stéphanie le hellard dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard department of psychiatry, mclean hospital, harvard medical school, belmont, ma, usa kira d. höffler & kerry ressler department of gynecology and obstetrics, emory university, atlanta, ga, usa seyma katrinli & alicia k. smith department of genetics, university of north carolina at chapel hill, chapel hill, nc, usa matthew w. halvorsen & james j. crowley center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway kevin s. o’connell, alexey shadrin, srdjan djurovic & ole a. andreassen department of medical genetics, oslo university hospital and university of oslo, oslo, norway kevin s. o’connell, alexey shadrin & srdjan djurovic section for precision psychiatry, oslo university hospital, oslo, norway alexey shadrin & ole a. andreassen department of psychiatry, university of north carolina at chapel hill, chapel hill, nc, usa james j. crowley department of biomedicine, university of bergen, bergen, norway jan haavik department of psychiatry, møre and romsdal hospital trust, molde, norway kristen hagen department of mental health, norwegian university of science and technology, trondheim, norway kristen hagen department of clinical psychology, university of bergen, bergen, norway gerd kvale center for crisis psychology, university of bergen, bergen, norway bjarne hansen faillace department of psychiatry and behavioral sciences, mcgovern medical school, the university of texas health science center at houston, houston, tx, usa jair c. soares & gabriel r. fries department of psychiatry and behavioral sciences, emory university, atlanta, ga, usa alicia k. smith authors kira d. höffler view author publications search author on: pubmed google scholar seyma katrinli view author publications search author on: pubmed google scholar matthew w. halvorsen view author publications search author on: pubmed google scholar anne-kristin stavrum view author publications search author on: pubmed google scholar kevin s. o’connell view author publications search author on: pubmed google scholar alexey shadrin view author publications search author on: pubmed google scholar srdjan djurovic view author publications search author on: pubmed google scholar ole a. andreassen view author publications search author on: pubmed google scholar james j. crowley view author publications search author on: pubmed google scholar jan haavik view author publications search author on: pubmed google scholar kristen hagen view author publications search author on: pubmed google scholar gerd kvale view author publications search author on: pubmed google scholar kerry ressler view author publications search author on: pubmed google scholar bjarne hansen view author publications search author on: pubmed google scholar jair c. soares view author publications search author on: pubmed google scholar gabriel r. fries view author publications search author on: pubmed google scholar alicia k. smith view author publications search author on: pubmed google scholar stéphanie le hellard view author publications search author on: pubmed google scholar contributions kd hoeffler, ak stavrum, and slh contributed to the design of the study. kd hoeffler developed the adapted approach and, together with sk and grf, tested it in the cohorts. mwh, kso, and a. shadrin performed genotyping quality control and ancestry prediction. sd and k. hagen were responsible for data acquisition. oaa, jjc, jh, gk, bh, jcs, ak smith, and slh served as site principal investigators and contributed data. ak stavrum, tk, kr, and slh supervised the research progress. kd hoeffler was the main contributor to writing the manuscript. ak stavrum, slh, sk, and grf also contributed to writing the manuscript. all authors read, edited, and approved the final manuscript. corresponding authors correspondence to kira d. höffler or stéphanie le hellard . ethics declarations ethics approval and consent to participate the current project was approved ​​the regional committee for research ethics (top cohort: #2009/2485; bcbp-ocd cohort: #2019/1097, gtp was approved by the irbs of emory university school of medicine and the research oversight committee of grady memorial hospital, uthealth houston was approved by irb #hsc-ms-09–0340). all participants provided informed consent. competing interests oaa is a consultant to cortechs.ai and precision health as, and has received speakers' honorarium from lundbeck , otsuka , janssen , bms , and lilly . the other authors declare that they have no competing interests. additional information publisher's note springer nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations. supplementary information overview of supplementary materials: supplementary figure s1 supplementary figure s2 supplementary figure s3 supplementary figure s4 supplementary figure s5 supplementary figure s6 supplementary figure s7 supplementary figure s8 supplementary figure s9 supplementary figure s10 supplementary figure s11 supplementary figure s12 supplementary figure s13 supplementary figure s14 supplementary figure s15 supplementary table s1 supplementary table s2 supplementary table s3 rights and permissions open access this article is licensed under a creative commons attribution 4.0 international license, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the creative commons licence, and indicate if changes were made. the images or other third party material in this article are included in the article’s creative commons licence, unless indicated otherwise in a credit line to the material. if material is not included in the article’s creative commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. to view a copy of this licence, visit http://creativecommons.org/licenses/by/4.0/ . reprints and permissions about this article cite this article höffler, k.d., katrinli, s., halvorsen, m.w. et al. optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches. epigenetics & chromatin 18 , 69 (2025). https://doi.org/10.1186/s13072-025-00627-0 download citation received : 02 may 2025 accepted : 29 august 2025 published : 14 october 2025 doi : https://doi.org/10.1186/s13072-025-00627-0 share this article anyone you share the following link with will be able to read this content: get shareable link sorry, a shareable link is not currently available for this article. copy shareable link to clipboard provided by the springer nature sharedit content-sharing initiative keywords epigenetics dna methylation ancestry ewas mwas download pdf advertisement window.sn = window.sn || {}; window.sn.libs = window.sn.libs || {}; window.sn.libs.ads = window.sn.libs.ads || {}; window.sn.libs.ads.slotconfig = window.sn.libs.ads.slotconfig || {}; window.sn.libs.ads.slotconfig['mpu1'] = { 'pos': 'mpu1' }; window.sn.libs.ads.slotconfig['unitpath'] = '/270604982/bmc/epigeneticsandchromatin/articles'; window.sn.libs.ads.slotconfig['type'] = 'article'; window.sn.libs.ads.slotconfig['kwrd'] = 'epigenetics,dna methylation,ancestry,ewas,mwas'; window.sn.libs.ads.slotconfig['doi'] = '10.1186/s13072-025-00627-0'; window.sn.libs.ads.slotconfig['pmc'] = 'l32030,b12008,l32020,l16008,b12010,b12030'; epigenetics & chromatin issn: 1756-8935 contact us submission enquiries: journalsubmissions@springernature.com read more on our blogs receive bmc newsletters manage article alerts language editing for authors scientific editing for authors policies accessibility press center support and contact leave feedback careers follow bmc bmc twitter page bmc facebook page bmc weibo page by using this website, you agree to our terms and conditions , your us state privacy rights , privacy statement and cookies policy. your privacy choices/manage cookies we use in the preference centre. © 2025 biomed central ltd unless otherwise stated. part of springer nature .## Results
the pcs generated by epiancer+ led to improved clustering for repeated samples from the same individual and stronger associations with genetic ancestry groups predicted from genotype information compared to the original approach. epiancer+ also outperformed the use of dna methylation pcs or surrogate variables for ancestry adjustment. conclusions we show that the epiancer + approach improves the adjustment for genetic ancestry in dna methylation studies. epiancer+ can be integrated into existing r pipelines for commercial methylation arrays, such as 450 k, epic v1, and epic v2. the code is available on github ( https://github.com/kirahoeffler/epiancer ). background genetic ancestry is an important confounding factor in dna methylation studies and should ideally be adjusted for using principal components (pcs) derived from genetic information (i.e. genotypes). however, when genotype data is not available for all study participants, self-reported ancestry data is commonly used to adjust for ancestry in dna methylation studies, often leading to the exclusion of non-europeans and individuals with mixed genetic backgrounds, and to sub-optimal correction. this practice is problematic due to the historical underrepresentation of non-europeans in epigenetic research [ 1 ] and the inherent flaws of self-reported data, which fail to capture the continuous nature of genetic variation and inadequately address the complexity of mixed ancestry backgrounds. to ensure the generalizability of research findings, dna methylation studies should avoid excluding individuals based on genetic background. two main methods are available to adjust for genetic ancestry in dna methylation studies lacking genotyping data. the method by barfield et al. from 2014 [ 2 ] calculates pcs from dna methylation data of cpgs near or overlapping single nucleotide polymorphisms (snps), selected based on the 1000 genomes project [ 3 ] data. however, this approach does not account for technical and biological factors such as sex, age, and cell type proportions, resulting in the first ancestry pc not being regularly associated with genetic ancestry [ 2 ] and potentially introducing multicollinearity with other adjusted factors in the final model. the epistructure [ 4 ] approach calculates pcs from dna methylation of cpgs highly correlated with cis-located snp probes while considering cell-type composition. this method is not easily integrated into existing r-based pipelines because it is a python program and requires several steps of input file adaptation. additionally, it has not been updated since 2017 and does not accommodate the epic v2 array. other methods based on dna methylation, such as surrogate variables and methylation pcs from the whole array data, do not specifically adjust for ancestry. therefore, there is a need for a reliable method to adjust for ancestry in dna methylation studies where genotype data is not available that can easily be incorporated into existing pipelines. our aim was to provide such a method by improving the approach by barfield et al.'s [ 2 ] through the use of methylation data from cpgs overlapping with snp probes that are residualized for technical and biological factors (i.e. cell type proportion pcs, sex, age, and control probe pcs) and information from genotyping snp rs probes on the array. we hypothesized that ancestry pcs from our adapted approach would result in better clustering of genetically predicted ancestry groups and repeated samples from the same individual, stronger associations with genetic ancestry, and stronger correlations with genetic pcs. we tested the performance of our approach against the existing one using two norwegian cohorts (bcbp-ocd and top [ 5 , 6 ,]– [ 7 ]) and two us-american cohorts: uthealth houston [ 8 ] and grady trauma project (gtp) [ 9 ]. an easy-to-use function for our adapted approach is provided on github, along with detailed guidance on parameter settings and input file structure for implementation ( https://github.com/kirahoeffler/epiancer ). methods tested cohorts the different approaches were tested in two cohorts from norway and two cohorts from the united states, including individuals with available dna methylation data and ancestry information (either genetically predicted or self-reported, table 1 ). the inclusion criteria were passing dna methylation quality control and, if available, genotyping quality control. samples from individuals with mixed ancestry (based on the available data, as described in the genetic ancestry prediction section) were excluded from performance testing solely for methodological reasons, because evaluating classification accuracy requires clearly defined ancestry groups, and admixed individuals typically fall between clusters. this is not a limitation of epiancer+ , which produces continuous ancestry pcs that capture both discrete and admixed variation, making it fully applicable to individuals with mixed ancestry. table 1 cohorts on which the approaches were tested full size table dna methylation in the bcbp-ocd cohort, dna methylation was measured using the illumina epic v2 array at life&brain gmbh in bonn, germany. samples were excluded if they showed: mismatches between reported and predicted sex, outliers in the minfi [ 10 ] sex plot, genotype mismatches between repeated samples [ 11 ], low bisulfite conversion efficiency (< 80%) calculated with the watermelon [ 12 ] package, more than 5% missing data (after applying a detection p value threshold of 10e −16 ), or outlier patterns in beta value distribution plots [ 10 ]. saliva cell type proportions were estimated using hepidish [ 13 ] with the rpc method. the centepifibfatic.m dataset, excluding fat, was used as the main reference, while the centbloodsub.m dataset functioned as the secondary reference [ 13 ]. in the top cohort [ 5 , 6 ,]– [ 7 ], dna methylation was measured using the illumina epic v1 array at life and brain gmbh in bonn, germany, and quality controlled in three batches. samples were excluded if at least 1% of sites had a detection p -value > 0.01, if snp genotypes from the rs probes on the epic array did not match genotype data from the same samples, or there was a discrepancy between the sex predicted from dna methylation data and the reported sex [ 5 ]. the blood cell type proportions were calculated using the estimatecellcounts2 function from flowsorted.blood.epic [ 14 ] package. in the gtp cohort [ 9 ], dna methylation was measured using the illumina epic v1 array and quality controlled using the psychiatric genomics consortium (pgc)-ptsd epigenetics pipeline [ 15 ] (available at https://github.com/pgc-ptsd-ewas/epic_qc ). briefly, samples were excluded if their probe detection call rates were below 90% (after applying a detection p value threshold of 0.01) or if their average intensity values were either less than half of the overall sample mean or below 2000 arbitrary units (au). blood cell composition - including cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and neutrophils - was estimated using the robust partial correlation (rpc) method in epidish [ 16 ], utilizing a reference dataset specific to the epic array [ 17 ]. in the uthealth houston cohort [ 8 ], dna methylation was measured using the illumina epic v1 array. samples with a mean detection p-value below 0.05 were set to be excluded; however, no samples met this criterion, so none were excluded. white blood cell count proportions (cd8 + t cells, cd4 + t cells, natural killer cells, b cells, monocytes, and granulocytes) were estimated using the houseman algorithm [ 18 ]. genetic ancestry prediction bcbp-ocd: genotyping data for the bcbp-ocd cohort were processed following the quality control procedures described in the latest pgc ocd gwas study [ 19 ]. ancestry prediction was performed as outlined by halvorsen et al. [ 20 ], using principal component analysis and a random forest classifier trained on 1000 genomes project phase 3 data [ 3 ]. top: genotyping data and quality control procedures for the top cohort are described in detail in previous work [ 21 ]. ancestry was inferred from genotyping data using a random forest classifier trained on population reference data from the 1000 genomes project [ 3 ], as previously described [ 5 ]. gtp : genotyping was performed using illumina omni-quad 1 m, and genotypes were called in illumina’s genomestudio. genotype data quality control and calculation of pcsoty were performed according to the pgc guidelines [ 22 ]. ancestry was predicted as described by nievergelt et al. [ 22 ]. uthealth houston: ancestry information was assessed by self-report, as genotyping data were not available. epiancer+ approach the epiancer+ approach uses the minfi [ 10 ], champ [ 23 ], and watermelon [ 12 ] packages in r (developed in version 4.4.0) to generate “ancestry pcs”, which can be incorporated into final analysis models for samples that have passed general quality control. the approach consists of two main functions: ancestry_info() and ancestry_pca(). ancestry_info() function the ancestry_info() function uses an rgset that has been background-corrected using the bg.correct.illumina() [ 10 ] function. data from control probes, snp rs probes, bead counts, and detection p-values are extracted, as well as intensities of type i probes (split into green and red channels) and type ii probes. a detection p-value threshold of 10e −16 is applied, setting values above this threshold as missing. the intensities are filtered to include only cpgs overlapping with snps, referred to as snp0bp probes. the probes are selected using the same underlying criteria across all arrays, though the implementation depends on the structure of the available array-specific annotation: 450 k array: from the illuminahumanmethylation450kanno.ilmn12.hg19 [ 24 ] annotations, selecting snps probes from cpg_rs column overlapping with cpg sites filtered based on minor allele frequency (maf) ≥ 0.05. epic v1 array: from the pidsley et al . [ 25 ] and zhang et al . [ 26 ] annotations, selecting probes in either or both publications overlapping with snps (distance = 0) with a maf ≥ 0.05 epic v2 array: from annotations provided by illumina [ 27 ], selecting probes overlapping with snps (distance = 0) with a maf ≥ 0.05 the number of selected ancestry-informative probes was 7295 for the 450 k array, 3622 for the epic v1 array, and 2,674 for the epic v2 array. probes with low bead counts (where > 5% of samples have a bead count below 3) or low call rates (where > 10% of samples have missing data) are excluded. after filtering, the intensity values are quantile normalized, and beta values are calculated. missing values are imputed using the champ.impute() [ 23 ] function. beta values for the snp0bp probes are then residualized to adjust for cell count pcs, sex, age, and ten pcs derived from control probes, which capture a broad range of technical variation, including slide, array position, scanner effects, dna quality, and bisulfite conversion efficiency. this residualized data is referred to as epiancer . finally, the residualized snp0bp data is combined with the genotype calls from rs snp probes, which is referred to as epiancer+ . ancestry_pca() function the ancestry_pca() function takes the processed data from ancestry_info() and uses it to calculate ancestry pcs. these pcs are intended to be included in analysis models as covariates to control for ancestry-related variation. for further details and access to the code, please refer to the code on github ( https://github.com/kirahoeffler/epiancer ). performance tests three versions of ancestry pcs were compared: the original barfield [ 2 ] et al. approach ( epiancorig ), the adapted approach after only performing the residualization step ( epiancer ), and the further adapted approach combining the residualised data with called genotypes from rs probes ( epiancer+ ). to ensure comparability across approaches, the pca results were min–max scaled to a range between 0 and 1. associations between ancestry pcs and ancestry group were tested using anova when assumptions of normality and variance homogeneity were met. otherwise, kruskal–wallis tests with the rstatix [ 2 ] package were used. to evaluate clustering performance, silhouette scores [ 28 ], which range from -1 to 1 (with higher values indicating better clustering), were calculated using the cluster [ 29 ] package. these scores were used to evaluate clustering performance at both the ancestry group level and the individual (repeated samples) level. in addition, three-dimensional (3d) centroids of both ancestry group and individual (repeated samples) clusters were calculated. cluster density was assessed by calculating the mean euclidean 3d distance from each sample to the centroid of its respective group. to determine the separation between ancestry group clusters, a distance matrix was generated to measure the distances between the centroids of different ancestry groups. in the bcbp-ocd cohort, the absolute correlation between the first three ancestry pcs and the first three genotyping pcs was calculated to evaluate how effectively the methylation-based pcs capture the genetic ancestry background. visualization of results was performed using ggplot2 [ 30 ], cowplot [ 31 ], patchwork [ 32 ], plotly [ 33 ], htmlwidgets [ 34 ], and corrplot [ 35 ] packages. comparison with dna methylation pcs and surrogate variables in the bcbp-ocd sample, we compared the performance of epiancer+ with that of the first three dna methylation pcs and the first three surrogate variables (svs), using the same evaluation approach described above. dna methylation pcs were calculated from normalized m-values from autosomal probes. surrogate variable analysis was performed on the m-values. the full model included case–control status, age, sex, two cell type pcs, and ten control probe pcs. the null model excluded case–control status. ancestry group associations with technical and biological adjustment factors associations between ancestry groups and the factors used to residualize snp0bp data were tested using either linear models for datasets with two ancestry groups or anova when multiple ancestry groups were present (with a common p-value for the effect across all groups). for control probe pcs and cell type pcs in datasets with repeated samples, linear mixed-effect models were employed to test the association with the ancestry groups. these models included a random intercept to account for repeated measures from the same individual. two models were compared: (a) a full model that included ancestry group as a predictor and the pcs as outcome; (b) a null model that excluded ancestry group. a likelihood ratio test was performed to determine if the full model fit the data significantly better than the null model. additionally, to assess whether residualized biological and technical covariates confounded our epiancer+ pcs, we performed linear regression and partial r 2 analyses in the gtp cohort. for each of the top three epiancer+ pcs, we quantified the unique variance explained by (i) the top three genotype-derived ancestry pcs, (ii) residualized covariates (sex, age, top 10 control probe pcs, and 6 cell proportion pcs), and (iii) both sets together. unique variance was computed using partial r 2 , representing the proportion of variance in each epiancer+ pc explained by one set of predictors after accounting for the other. practical example in the uthealth houston cohort, we conducted an analysis of bipolar case–control status, adjusting for sex, age, smoking status, five cell type proportion pcs, five control pcs, and 0, 2, 5, or 10 ancestry pcs calculated with epiancer + . this setup allowed us to compare the impact of including different numbers of ancestry pcs on the genomic inflation factor (λ). results we evaluated the performance of ancestry pcs in capturing genetic ancestry, comparing the original approach by barfield et al. [ 2 ] ( epiancorig ) with two adapted versions. the first adaptation step involved residualizing cpg data overlapping with snps to adjust for technical and biological confounders ( epiancer ). the second adaptation combined the residualized values with called genotypes from rs probes ( epiancer+ ). scatterplots when plotting ancestry pcs against each other, distinct ancestry groups should ideally form dense and separate clusters, while repeated samples from the same individuals should cluster closely together. in the bcbp-ocd cohort (fig. 1 a-c; figure s1-s3), all approaches visually distinguished ancestry groups in the first two pcs. notably, while the original approach ( epiancorig ) separated ancestry primarily along the second pc, both adapted approaches achieved separation along the first pc. in the top cohort (fig. 1 d-f; figure s4-s6), the epiancorig approach failed to separate ancestry groups. in contrast, epiancer successfully differentiated african and east asian samples, with further improvement using epiancer+ , separating all ancestry groups. in the gtp cohort, both the epiancorig and adapted approaches differentiate ancestry group, with no major observable differences between them (figures. 1 g-i and s7-s9). in the uthealth houston cohort, the epiancorig approach appears to produce slightly clearer separations and denser clusters compared to the adapted approaches (figs. 1 j-l and s10-s12). fig. 1 scatterplots of the first two ancestry pcs plotted against each other, calculated using different approaches. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur european, lat latin american, pi pacific islander , sas south asian full size image association between the ancestry pcs and the ancestry groups to optimally adjust for ancestry, a strong association between ancestry pcs and ancestry groups is needed, particularly for the first ancestry pc. in the bcbp-ocd cohort (fig. 2 a, table s1a), both adapted approaches had a much stronger association between the first ancestry pc and the ancestry groups (both p = 1.47e-20) compared to the epiancorig approach (p = 0.032), aligning with the observations in the scatterplots (fig. 1 a-c). the epiancorig approach showed the strongest association only with the second ancestry pc (p = 1.47e-20), while epiancer+ (p = 1.68e-09) had a stronger association than epiancer (p = 0.001) for the second ancestry pc. fig. 2 association between the first three ancestry pcs and the ancestry groups. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort (fig. 2 b, table s1b), the strongest association between the first ancestry pc and the ancestry groups was observed for epiancer+ (p = 1.15e-22), followed by epiancer (p = 2.19e-10), while there was no association with the epiancorig approach (p = 1). the epiancorig approach showed a significant association only for the third ancestry pc (p = 6.62e-13). in the gtp cohort, there was no notable difference in the association between the first ancestry pc and ancestry groups (fig. 2 c, table s1c), while in the uthealth houston cohort, the first ancestry pc from the epiancorig approach showed stronger associations with ancestry groups than the adapted approaches (fig. 2 d, table s1d). repeated sample clustering we next assessed the clustering of repeated samples from the same individuals when plotting ancestry pcs against each other. this analysis was done in both the bcbp-ocd and top cohorts that included repeated samples. to quantify clustering, we used silhouette scores (higher scores indicate better clustering) and calculated the 3d distances from the repeated sample to the 3d centroid of the respective individual. repeated samples should cluster closely together, as genetic ancestry remains consistent over time. in the bcbp-ocd cohort, repeated samples clustered more tightly using the adapted approaches compared to the epiancorig approach. this was reflected in higher silhouette scores (fig. 3 a, table s2a) and smaller distances to the individual’s centroid (fig. 3 b, table s2b). there was little difference between epiancer and epiancer+ . fig. 3 repeated sample clustering. clustering performance of repeated samples from individuals was tested using silhouette scores and 3d distance to the individual’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the top cohort, the epiancer+ approach resulted in the best clustering, with the highest average silhouette score (fig. 3 c, table s2a) and the smallest average distance to the centroid (fig. 3 d, table s2b). however, in the top cohort, only three individuals had repeated samples, with each having two samples. ancestry level clustering next, we assessed how well different ancestry groups cluster by plotting the first three ancestry pcs against each other. ideally, samples within the same ancestry group should cluster closely together, while different ancestry groups should be well-separated. clustering was quantified with silhouette scores and 3d distances both between ancestry clusters and within clusters (from the samples to the respective centroid of the individual). in the bcbp-ocd cohort, the silhouette scores improved from the epiancorig approach (0.2419) to epiancer (0.2610) and showed only slight further improvement for epiancer+ (0.2693) (fig. 4 a, table s3a-b). the highest mean distances between ancestry clusters were observed with epiancer+ , followed by epiancer and the epiancorig approach (fig. 4 b, table s3c). distances within clusters presented a mixed picture: while most ancestry groups had tighter clusters with the adapted approaches, the south asian group showed a wider cluster (fig. 4 c, table s3c). fig. 4 ancestry group clustering. clustering performance of samples from different ancestries was tested using silhouette scores and 3d distance to the ancestry group’s centroid. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ). afr african, amr american, eas east asian, eur: european, lat latin american, pi pacific islander, sas south asian full size image in the top cohort, the average silhouette scores for epiancorig (0.06964) and epiancer (0.01417) were lower than for epiancer+ (0.25019) (fig. 4 d, table s3a). clustering varied across ancestry groups, with european, east asian, and african ancestries showing the best clustering under epiancer+ , as indicated by higher silhouette scores (fig. 4 d, table s3b), slightly higher distances between the ancestry clusters (fig. 4 e, table s3c), and lower distances of samples to the cluster centroid (fig. 4 f, table s3c) compared to the other approaches. in the gtp cohort (fig. 45g-i, table s3a-c), the epiancorig approach produced the highest silhouette score (0.5990), followed by epiancer+ (0.5732) and epiancer (0.5579). this result was primarily driven by larger distances between clusters in the epiancorig approach, followed by epiancer+ and epiancer . in the uthealth houston cohort (fig. 4 j-l, table s3a-c), the epiancorig approach also showed the highest silhouette score (0.07268), compared to epiancer+ (-0.0567) and epiancer (-0.0083). this was mainly due to larger distances between the african ancestry cluster to the other clusters and smaller distances within the asian cluster under the epiancorig approach. comparison with dna methylation pcs (dnampcs) and surrogate variables (svs) we compared the performance of epiancer+ with dnampcs and svs in the bcbp-ocd cohort. epiancer+ consistently outperformed both approaches. visually, it produced better clustering of samples (figure s13), which was reflected in a higher mean silhouette score ( epiancer+ : 0.293; svs: -0.226; dnampcs: -0.245). statistically, the first epiancer+ pc showed a strong association with ancestry groups, whereas only the third dnampc and sv demonstrated ancestry association, and with lower significance (table s 1 e (supplementary), figure s14). for repeated samples from the same individual, epiancer+ again performed better, achieving a higher mean 3d silhouette score (0.325) compared with dnampcs (-0.599) and svs (-0.603). association of ancestry groups with genotyping pcs for dna methylation-based ancestry pcs to effectively capture genetic background information, they should exhibit a strong correlation with genotyping pcs, especially between the first ancestry pc and the first genotyping pc, as both are expected to account for the majority of genetic variation. pearson correlation analysis was performed between ancestry and genotyping pcs in the bcbp-ocd cohort, which had readily available genotyping data. importantly, both adapted approaches ( epiancer and epiancer+ ) showed a strong correlation between the first ancestry pc and the first genotyping pc (r = 0.875, fig. 5 b-c). in contrast, the epiancorig approach showed no correlation between the first ancestry pc and the first genotyping pc (r = 0.001, fig. 5 a). the mean correlation of the first three genotyping pcs with the first three ancestry pcs was highest for epiancer+ (mean r = 0.173), followed by epiancer (mean r = 0.156), and lowest for the epiancorig approach (mean r = 0.146). fig. 5 correlation between the first three ancestry pcs and the first three genotyping pcs. correlation analyses were performed in the bcbp-ocd cohort. ancestry pcs are referred to as pcs 1–3 and genotyping pcs as gt_pc1-3. the comparison included the original approach by barfield et al. ( epiancorig ), the data after residualization for technical and biological factors ( epiancer ), and the data after integrating called genotypes from rs probes with the residualized data ( epiancer+ ) full size image in the gtp cohort, partial r 2 analyses showed that epiancer+ pc1 captured substantial true ancestry signal (94.4%) but also retained variance explained by residualized covariates (40.5%). pc2 was minimally associated with ancestry (0.5%) or residualized factors (3.4%). pc3 was predominantly explained by residualized variables (49.4%) and showed little ancestry signal (1.1%). these results indicate that, while pc1 largely reflects true ancestry, some pc3 is strongly influenced by residualized technical and biological variation. this pattern is consistent with an unbalanced experimental design that induces correlations between ancestry and residualized factors. ancestry group associations with technical and biological adjustment factors to assess potential confounding, we tested whether factors adjusted for during residualization (sex, age, cell type proportions, and control probe pcs) were associated with ancestry groups, as such associations could inadvertently reduce true ancestry signals if these factors are unevenly distributed across batches or groups. in the bcbp-ocd cohort, none of the factors included in the residualization step were associated with ancestry groups (table s4a). in the top cohort, sex, several cell type proportion pcs (1, 2, 4, 5) but only the sixth control probe pc showed significant associations with ancestry groups (table s4b). in the gtp cohort, age, the second, fourth, and ninth control probe pcs, and the first and second cell type proportion pcs were significantly associated with ancestry groups (table s4c). in the uthealth houston cohort, the first and second cell type pcs were significantly associated with ancestry groups as well, along with the eighth to tenth control probe pcs (table s4d). practical example in the uthealth houston cohort, we analyzed bipolar case–control status while adjusting for varying numbers of ancestry pcs calculated with epiancer+ . the genomic inflation factor (λ) is ideally close to 1, as values above 1 may indicate population stratification or other confounding effects. without adjusting for any ancestry pcs, λ was 1.087. adding 2 ancestry pcs reduced λ to 1.023, and adding 5 ancestry pcs further reduced it to 1.008. however, adding 10 ancestry pcs increased λ slightly to 1.056. these results indicate that adjusting for ancestry pcs effectively reduces batch effects introduced by ancestry, with 5 pcs being optimal in this case. including more pcs than necessary (as with 10 pcs here) can reintroduce noise. discussion we demonstrated that adjusting for genetic ancestry in dna methylation studies by residualizing beta values for known technical and biological factors - prior to calculating ancestry principal components from cpgs overlapping with snps - and integrating the residualized data with genotype calls from the snp probes present on the arrays, improves accuracy compared to the method proposed by barfield et al. (2014) [ 2 ]. in the bcbp-ocd and top cohorts, we observed the same issues that were reported with the original approach by barfield et al. (2014) [ 2 ]: the first ancestry pc calculated using this approach showed weak associations with the ancestry groups, while stronger associations only emerged for the second or third ancestry pcs. there was a lack of correlation between the first genotyping pc and the first ancestry pc. thus, these findings suggest that the first ancestry pc calculated with the barfield et al. [ 2 ] approach, and in some cases even the second ancestry pc, mostly capture influences on dna methylation that are unrelated to ancestry or genetic background. several tests were conducted to assess the performance of the adapted approach compared to the original approach. the results indicated that the adapted approach substantially removed technical and biological variance, particularly in the bcbp-ocd and top cohorts. importantly, the association between the first ancestry pc and different ancestry groups was stronger using the adapted approach. while the addition of called genotypes to the residualization step did not substantially affect results in the bcbp-ocd cohort, the top cohort showed a stronger association between the first ancestry pc and the ancestry groups when called genotypes were included. this highlights that incorporating called genotypes can improve the robustness, especially in cohorts with larger technical effects. a key indicator of the adapted approach’s performance is its ability to cluster repeated samples from the same individuals more closely than the original approach. this is demonstrated by higher silhouette scores, a measure of clustering performance, and tighter clustering, indicated by smaller distances to the centroid within each individual’s cluster, in both the bcbp-ocd and top cohorts. since genetic ancestry is consistent over time, repeated samples should cluster tightly together. the tighter clustering observed with the adapted approach aligns with our expectations, as the original approach is affected by technical and biological influences, such as differing plate positions and variations in cell type estimations across samples from the same individual; the adapted approach effectively corrects for these influences, resulting in more accurate ancestry estimations. in addition to improved individual-level clustering, the different ancestry groups also showed better clustering when plotting ancestry pcs against one another. in the top cohort, where batch effects were more pronounced, incorporating called genotypes resulted in higher silhouette scores compared to using the residualized data alone. in contrast, in the bcbp-ocd cohort, where batch effects were less pronounced, the addition of genotypes had minimal impact on clustering performance at the ancestry group level. the tightness of clusters, measured as the distances of samples to their respective ancestry cluster centroids, yielded mixed results across different ancestry groups. this variability may reflect the adapted approach’s ability to capture greater genetic diversity within ancestry groups when confounding factors are appropriately adjusted for. finally, the adapted approach demonstrated a strong correlation (r = 0.875) between the first ancestry pcs and the first genotyping pc in the bcbp-ocd cohort, whereas no such correlation was observed with the original approach. the first genotyping pc captures most genetic background, which demonstrates the ability of the first ancestry pc to also capture most of the genetic variability. moreover, when examining the mean correlation of the first three ancestry pcs with the first three genotyping pcs, the adapted approach including the called genotypes showed the highest correlations of the compared approaches, capturing more true genetic information. in the bcbp-ocd cohort, epiancer+ showed clearly superior performance compared with dna methylation pcs (dnampcs) and surrogate variables (svs), demonstrating stronger statistical associations with ancestry, better clustering of ancestry groups, and improved clustering of repeated samples. overall, epiancer+ is more effective at capturing true ancestry effects, whereas dnampcs are more likely to capture technical noise and svs tend to reflect other non-ancestry influences. the adjusted method did not perform better for the gtp and uthealth houston cohorts. our partial r 2 analysis in the gtp cohort provides quantitative support for this observation: while epiancer+ pc1 retained strong ancestry signal (94.4% variance explained by genotype pcs), it also contained substantial variance from residualized covariates (40.5%), and pc3 was largely driven by residualized variables (49.4%) with minimal ancestry signal (1.1%). this pattern is consistent with unbalanced study design, where technical and biological covariates are unevenly distributed across ancestry groups, creating correlations between ancestry and residualized factors. these results indicate that some ancestry effect is removed when correcting for biological and technical factors in the residualizing step, because these factors are themselves associated with ancestry. there is a balance between removing the effects of technical and biological factors and removing ancestry information associated with these factors. if batch effects are not too strong but still associated with ancestry, then ancestry clustering does not improve, as seen in the gtp and uthealth houston cohorts. in contrast, substantial improvements are observed in cohorts like the bcbp-ocd cohort, where there is little to no association between ancestry and the factors adjusted for during residualization. similarly, in the top cohort, which has large technical batch effects, residualization had an improving effect despite the removal of some ancestry-related information. the actual performance is sample-specific and depends on the study design, but the method is applicable across a range of sample sizes. thus, it is important to take more care in designing the studies so that technical factors are not associated with ancestry (by a randomized design, balancing ancestry across plates, slides, and slide positions) and that sex and age are as balanced as possible across ancestries. this makes it possible for the residualization step to effectively remove influencing factors while preserving the ancestry effects. limitations one limitation is the relatively low overall mean correlation between the first three ancestry pcs and the first three genotyping pcs (mean r = 0.173 for the adapted approach including the genotypic data), suggesting that it does not fully capture all genotyping effects. however, the high correlation between the first ancestry pc and the first genotyping pc (r = 0.875) indicates that the approach effectively captures most of the genetic variation. despite this, genotyping data remains the gold standard for accurately capturing genetic ancestry and should be used whenever available to adjust for genetic background in dna methylation studies. expanding the coverage of illumina dna methylation arrays to include more sites overlapping with snp probes specifically designed to capture ancestry could enhance the ancestry signal derived from these arrays and improve alignment with genotyping pcs; however, in the design of the epic v2, a substantial number of snp-associated methylation probes were removed (selected ancestry-informative probes: 450 k: n = 7295; epic v1: n = 3622; epic v2: n = 2674). another limitation is that the precision of the performance testing may be affected by the fact that our approach was primarily tested on european samples, with fewer available samples from other ancestries. furthermore, the uthealth houston cohort relied on self-reported ancestry data, which is known to be less accurate and may have led to the inclusion of individuals with mixed or misclassified genetic ancestry. additionally, while "latino" is officially recognized as an ethnicity rather than a genetic ancestry group, we used it in our analysis as a label for an ancestry cluster. this cluster reflects admixed genetic backgrounds - typically indigenous american, european, and african - commonly seen in individuals self-identifying as latino. additionally, the longer runtime of our approach presents a practical limitation, primarily due to the detection p-value calculation step. however, this issue can be mitigated by providing pre-calculated detection p-values as input to the function (if already calculated), significantly reducing processing time. we considered comparing the performance of epiancer+ with epistructure [ 4 ]; however, epistructure has not been updated for the latest arrays and is therefore unlikely to perform reliably on our data. practical implications epiancer+ can be used to adjust for ancestry in all samples, even when technical factors correlate with ancestry, as it successfully clustered samples based on ancestry across all tested datasets. importantly, in cohorts where ancestry is correlated with technical and biological effects, our method ensures that ancestry is not accounted for twice. unlike the method by barfield et al. [ 2 ], which risks collinearity by adjusting for ancestry alongside confounding factors, our adapted method estimates the remaining ancestry effect while preserving relevant variation. compared to epistructure [ 4 ], epiancer+ offers improved usability and compatibility. epistructure is implemented in python within the glint framework and requires multiple preprocessing steps, limiting its integration with standard r-based pipelines. moreover, it has not been updated since 2017 and does not support the epic v2 array. epiancer+ , by contrast, is r-based and supports all major array types (450 k, epic v1, epic v2). ancestry pcs should be calculated only for samples that have passed general quality control. based on our experience, including one or two ancestry pcs is often sufficient for most analyses, though the number required depends on cohort diversity. in highly heterogeneous populations, additional ancestry pcs may be necessary. we recommend testing different models (e.g., using 2, 5, or 10 ancestry pcs) and evaluating their performance using qq plots and genomic inflation factor (λ), as demonstrated in the practical example in the results section. the optimal number of pcs is the one that brings λ closest to 1.0 and gives qq plots with no evidence of inflation, indicating adequate correction for population stratification without overfitting. conclusions adequate adjustment for genetic ancestry is essential in dna methylation studies. when genotyping data is unavailable, it has been suggested to use dna methylation data from illumina arrays overlapping with snps as an alternative. we have improved this approach by accounting for technical and biological influences and incorporating genotypic data from snp probes, offering increased robustness. our adapted approach ( epiancer+ ) is easy to implement in existing r pipelines, including the ones for the epic v2 array, and offers a practical solution for ancestry adjustment. data availability no datasets were generated or analysed during the current study. references breeze ce, beck s, berndt si, franceschini n. the missing diversity in human epigenomic studies. nat genet. 2022;54(6):737–9. article cas pubmed pubmed central google scholar barfield rt, almli lm, kilaru v, smith ak, mercer kb, duncan r, et al. accounting for population stratification in dna methylation studies. genet epidemiol. 2014;38(3):231–41. article pubmed pubmed central google scholar auton a, brooks ld, durbin rm, garrison ep, kang hm, et al. a global reference for human genetic variation (genomes project consortium ). nature. 2015;526(7571):68–74. article pubmed google scholar rahmani e, shenhav l, schweiger r, yousefi p, huen k, eskenazi b, et al. genome-wide methylation data mirror ancestry information. epigenetics chromatin. 2017;10:1. article pubmed pubmed central google scholar wortinger la, stavrum ak, shadrin aa, szabo a, rukke sh, nerland s, et al. divergent epigenetic responses to perinatal asphyxia in severe mental disorders. transl psychiatry. 2024;8(14):16. article google scholar engh ja, friis s, birkenaes ab, jónsdóttir h, klungsøyr o, ringen pa, et al. delusions are associated with poor cognitive insight in schizophrenia. schizophr bull. 2010;36(4):830–5. article pubmed google scholar simonsen c, sundet k, vaskinn a, birkenaes ab, engh ja, faerden a, et al. neurocognitive dysfunction in bipolar and schizophrenia spectrum disorders depends on history of psychosis rather than diagnostic group. schizophr bull. 2011;37(1):73–83. article pubmed google scholar mirza s, lima cnc, del favero-campbell a, rubinstein a, topolski n, cabrera-mendoza b, et al. blood epigenome-wide association studies of suicide attempt in adults with bipolar disorder. transl psychiatry. 2024;14(1):70. article cas pubmed pubmed central google scholar gillespie cf, bradley b, mercer k, smith ak, conneely k, gapen m, et al. trauma exposure and stress-related disorders in inner city primary care patients. gen hosp psychiatry. 2009;31(6):505–14. article pubmed pubmed central google scholar aryee mj, jaffe ae, corrada-bravo h, ladd-acosta c, feinberg ap, hansen kd, et al. minfi: a flexible and comprehensive bioconductor package for the analysis of infinium dna methylation microarrays. bioinformatics. 2014;30(10):1363–9. article cas pubmed pubmed central google scholar just ac, heiss ja. ewastools: ewas tools. 2023. pidsley r, wong ccy, volta m, lunnon k, mill j, schalkwyk lc. a data-driven approach to preprocessing illumina 450k methylation array data. bmc genomics. 2013;1(14):293. article google scholar zheng sc, webster ap, dong d, feber a, graham dg, sullivan r, et al. a novel cell-type deconvolution algorithm reveals substantial contamination by immune cells in saliva. buccal cervix epigenomics. 2018;10(7):925–40. article cas pubmed google scholar salas la, koestler dc. flowsorted.blood.epic: illumina epic data on immunomagnetic sorted peripheral adult blood cells. [internet]. 2024. available from: https://github.com/immunomethylomics/flowsorted.blood.epic katrinli s, wani ah, maihofer ax, ratanatharathorn a, daskalakis np, montalvo-ortiz j, et al. epigenome-wide association studies identify novel dna methylation sites associated with ptsd: a meta-analysis of 23 military and civilian cohorts. genome med. 2024;16(1):147. article cas pubmed pubmed central google scholar teschendorff ae, breeze ce, zheng sc, beck s. a comparison of reference-based algorithms for correcting cell-type heterogeneity in epigenome-wide association studies. bmc bioinform. 2017;18(1):105. article google scholar salas la, koestler dc, butler ra, hansen hm, wiencke jk, kelsey kt, et al. an optimized library for reference-based deconvolution of whole-blood biospecimens assayed using the illumina humanmethylationepic beadarray. genome biol. 2018;19(1):64. article pubmed pubmed central google scholar houseman ea, accomando wp, koestler dc, christensen bc, marsit cj, nelson hh, et al. dna methylation arrays as surrogate measures of cell mixture distribution. bmc bioinform. 2012;13(1):86. article google scholar strom ni, gerring zf, galimberti m, yu d, halvorsen mw, abdellaoui a, et al. genome-wide analyses identify 30 loci associated with obsessive-compulsive disorder [internet]. medrxiv; 2025 [cited 2025 may 1]. p. 2024.03.13.24304161. available from: https://www.medrxiv.org/content/ . https://doi.org/10.1101/2024.03.13.24304161v2 halvorsen mw, de schipper e, bäckman j, strom ni, hagen k, lindblad-toh k, et al. a burden of rare copy number variants in obsessive-compulsive disorder. mol psychiatry. 2025;30(4):1510–7. article cas pubmed google scholar werner mcf, wirgenes kv, shadrin a, lunding sh, rødevand l, hjell g, et al. immune marker levels in severe mental disorders: associations with polygenic risk scores of related mental phenotypes and psoriasis. transl psychiatry. 2022;12(1):38. article cas pubmed pubmed central google scholar nievergelt cm, maihofer ax, klengel t, atkinson eg, chen cy, choi kw, et al. international meta-analysis of ptsd genome-wide association studies identifies sex- and ancestry-specific genetic risk loci. nat commun. 2019;10(1):4558. article pubmed pubmed central google scholar tian y, morris tj, webster ap, yang z, beck s, feber a, et al. champ: updated methylation analysis pipeline for illumina beadchips. bioinformatics. 2017;33(24):3982–4. article cas pubmed pubmed central google scholar hansen kd. illuminahumanmethylation450kanno.ilmn12.hg19: annotation for illumina’s 450k methylation arrays. 2021. pidsley r, zotenko e, peters tj, lawrence mg, risbridger gp, molloy p, et al. critical evaluation of the illumina methylationepic beadchip microarray for whole-genome dna methylation profiling. genome biol. 2016;17(1):208. article pubmed pubmed central google scholar zhang z, zeng c, zhang w. characterization of the illumina epic array for optimal applications in epigenetic research targeting diverse human populations. epigenetics commun. 2022;1(2):7. article google scholar infinium methylationepic v2.0 product files [internet]. [cited 2024 nov 28]. available from: https://support.illumina.com/downloads/infinium-methylationepic-v2-0-product-files.html rousseeuw pj. silhouettes: a graphical aid to the interpretation and validation of cluster analysis. j comput appl math. 1987;1(20):53–65. article google scholar maechler m, rousseeuw p, struyf a, hubert m, hornik k. cluster: cluster analysis basics and extensions [internet]. 2023. available from: https://cran.r-project.org/package=cluster wickham h. ggplot2: elegant graphics for data analysis [internet]. new york, ny: springer; 2009 [cited 2023 may 22]. available from: https://link.springer.com/ https://doi.org/10.1007/978-0-387-98141-3 wilke co. cowplot: streamlined plot theme and plot annotations for ‘ggplot2’ [internet]. 2024. available from: https://wilkelab.org/cowplot/ pedersen tl. patchwork: the composer of plots [internet]. 2024. available from: https://patchwork.data-imaginist.com inc pt. collaborative data science [internet]. montreal, qc: plotly technologies inc.; 2015. available from: https://plot.ly vaidyanathan r, xie y, allaire jj, cheng j, sievert c, russell k. htmlwidgets: html widgets for r [internet]. 2023. available from: https://cran.r-project.org/package=htmlwidgets wei t, simko v. r package ‘corrplot’: visualization of a correlation matrix [internet]. 2024. available from: https://github.com/taiyun/corrplot download references acknowledgements we thank all individuals who have provided samples for this study. in bergen, our sincere thanks go to helene nilsen, marie karin bjorøy, and lisa vårdal for organizing the samples, as well as to nadine fricker from life&brain for her exceptional service. we thank all clinicians for their support in participant recruitment, and we appreciate the technical support of all the staff, volunteers and participants from the grady trauma project. grammar corrections in this manuscript were assisted by gpt-4o (openai). funding open access funding provided by university of bergen. this work was performed on the safe facilities owned by the university of bergen and the tsd (tjeneste for sensitive data) facilities, owned by the university of oslo, operated and developed by the tsd service group at the university of oslo, it-department (usit) (tsd-drift@usit.uio.no). the authors would like to acknowledge support from: the research council of norway (rcn) for the top cohort (273291, 273446, 326813, 223273, 324499, 324252), the trond mohn foundation, nimh r01mh110427, and stiftelsen kristian gerhard jebsen (skgj med-02) for the bcbp-ocd cohort, and grants from the john s. dunn foundation and pat rutherford chair in psychiatry at uthealth houston. kdh was supported by a phd fellowship from the university of bergen. ak smith was supported by 2r01mh108826 and sk by k12hd085850 from nih. grf is supported by k01mh121580 from nimh. the funders did not have a role in design, analysis or publication. author information authors and affiliations department for clinical medicine, university of bergen, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum, jan haavik, kristen hagen, bjarne hansen & stéphanie le hellard dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard department of psychiatry, mclean hospital, harvard medical school, belmont, ma, usa kira d. höffler & kerry ressler department of gynecology and obstetrics, emory university, atlanta, ga, usa seyma katrinli & alicia k. smith department of genetics, university of north carolina at chapel hill, chapel hill, nc, usa matthew w. halvorsen & james j. crowley center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway kevin s. o’connell, alexey shadrin, srdjan djurovic & ole a. andreassen department of medical genetics, oslo university hospital and university of oslo, oslo, norway kevin s. o’connell, alexey shadrin & srdjan djurovic section for precision psychiatry, oslo university hospital, oslo, norway alexey shadrin & ole a. andreassen department of psychiatry, university of north carolina at chapel hill, chapel hill, nc, usa james j. crowley department of biomedicine, university of bergen, bergen, norway jan haavik department of psychiatry, møre and romsdal hospital trust, molde, norway kristen hagen department of mental health, norwegian university of science and technology, trondheim, norway kristen hagen department of clinical psychology, university of bergen, bergen, norway gerd kvale center for crisis psychology, university of bergen, bergen, norway bjarne hansen faillace department of psychiatry and behavioral sciences, mcgovern medical school, the university of texas health science center at houston, houston, tx, usa jair c. soares & gabriel r. fries department of psychiatry and behavioral sciences, emory university, atlanta, ga, usa alicia k. smith authors kira d. höffler view author publications search author on: pubmed google scholar seyma katrinli view author publications search author on: pubmed google scholar matthew w. halvorsen view author publications search author on: pubmed google scholar anne-kristin stavrum view author publications search author on: pubmed google scholar kevin s. o’connell view author publications search author on: pubmed google scholar alexey shadrin view author publications search author on: pubmed google scholar srdjan djurovic view author publications search author on: pubmed google scholar ole a. andreassen view author publications search author on: pubmed google scholar james j. crowley view author publications search author on: pubmed google scholar jan haavik view author publications search author on: pubmed google scholar kristen hagen view author publications search author on: pubmed google scholar gerd kvale view author publications search author on: pubmed google scholar kerry ressler view author publications search author on: pubmed google scholar bjarne hansen view author publications search author on: pubmed google scholar jair c. soares view author publications search author on: pubmed google scholar gabriel r. fries view author publications search author on: pubmed google scholar alicia k. smith view author publications search author on: pubmed google scholar stéphanie le hellard view author publications search author on: pubmed google scholar contributions kd hoeffler, ak stavrum, and slh contributed to the design of the study. kd hoeffler developed the adapted approach and, together with sk and grf, tested it in the cohorts. mwh, kso, and a. shadrin performed genotyping quality control and ancestry prediction. sd and k. hagen were responsible for data acquisition. oaa, jjc, jh, gk, bh, jcs, ak smith, and slh served as site principal investigators and contributed data. ak stavrum, tk, kr, and slh supervised the research progress. kd hoeffler was the main contributor to writing the manuscript. ak stavrum, slh, sk, and grf also contributed to writing the manuscript. all authors read, edited, and approved the final manuscript. corresponding authors correspondence to kira d. höffler or stéphanie le hellard . ethics declarations ethics approval and consent to participate the current project was approved ​​the regional committee for research ethics (top cohort: #2009/2485; bcbp-ocd cohort: #2019/1097, gtp was approved by the irbs of emory university school of medicine and the research oversight committee of grady memorial hospital, uthealth houston was approved by irb #hsc-ms-09–0340). all participants provided informed consent. competing interests oaa is a consultant to cortechs.ai and precision health as, and has received speakers' honorarium from lundbeck , otsuka , janssen , bms , and lilly . the other authors declare that they have no competing interests. additional information publisher's note springer nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations. supplementary information overview of supplementary materials: supplementary figure s1 supplementary figure s2 supplementary figure s3 supplementary figure s4 supplementary figure s5 supplementary figure s6 supplementary figure s7 supplementary figure s8 supplementary figure s9 supplementary figure s10 supplementary figure s11 supplementary figure s12 supplementary figure s13 supplementary figure s14 supplementary figure s15 supplementary table s1 supplementary table s2 supplementary table s3 rights and permissions open access this article is licensed under a creative commons attribution 4.0 international license, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the creative commons licence, and indicate if changes were made. the images or other third party material in this article are included in the article’s creative commons licence, unless indicated otherwise in a credit line to the material. if material is not included in the article’s creative commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. to view a copy of this licence, visit http://creativecommons.org/licenses/by/4.0/ . reprints and permissions about this article cite this article höffler, k.d., katrinli, s., halvorsen, m.w. et al. optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches. epigenetics & chromatin 18 , 69 (2025). https://doi.org/10.1186/s13072-025-00627-0 download citation received : 02 may 2025 accepted : 29 august 2025 published : 14 october 2025 doi : https://doi.org/10.1186/s13072-025-00627-0 share this article anyone you share the following link with will be able to read this content: get shareable link sorry, a shareable link is not currently available for this article. copy shareable link to clipboard provided by the springer nature sharedit content-sharing initiative keywords epigenetics dna methylation ancestry ewas mwas download pdf advertisement window.sn = window.sn || {}; window.sn.libs = window.sn.libs || {}; window.sn.libs.ads = window.sn.libs.ads || {}; window.sn.libs.ads.slotconfig = window.sn.libs.ads.slotconfig || {}; window.sn.libs.ads.slotconfig['mpu1'] = { 'pos': 'mpu1' }; window.sn.libs.ads.slotconfig['unitpath'] = '/270604982/bmc/epigeneticsandchromatin/articles'; window.sn.libs.ads.slotconfig['type'] = 'article'; window.sn.libs.ads.slotconfig['kwrd'] = 'epigenetics,dna methylation,ancestry,ewas,mwas'; window.sn.libs.ads.slotconfig['doi'] = '10.1186/s13072-025-00627-0'; window.sn.libs.ads.slotconfig['pmc'] = 'l32030,b12008,l32020,l16008,b12010,b12030'; epigenetics & chromatin issn: 1756-8935 contact us submission enquiries: journalsubmissions@springernature.com read more on our blogs receive bmc newsletters manage article alerts language editing for authors scientific editing for authors policies accessibility press center support and contact leave feedback careers follow bmc bmc twitter page bmc facebook page bmc weibo page by using this website, you agree to our terms and conditions , your us state privacy rights , privacy statement and cookies policy. your privacy choices/manage cookies we use in the preference centre. © 2025 biomed central ltd unless otherwise stated. part of springer nature .## Discussion
we demonstrated that adjusting for genetic ancestry in dna methylation studies by residualizing beta values for known technical and biological factors - prior to calculating ancestry principal components from cpgs overlapping with snps - and integrating the residualized data with genotype calls from the snp probes present on the arrays, improves accuracy compared to the method proposed by barfield et al. (2014) [ 2 ]. in the bcbp-ocd and top cohorts, we observed the same issues that were reported with the original approach by barfield et al. (2014) [ 2 ]: the first ancestry pc calculated using this approach showed weak associations with the ancestry groups, while stronger associations only emerged for the second or third ancestry pcs. there was a lack of correlation between the first genotyping pc and the first ancestry pc. thus, these findings suggest that the first ancestry pc calculated with the barfield et al. [ 2 ] approach, and in some cases even the second ancestry pc, mostly capture influences on dna methylation that are unrelated to ancestry or genetic background. several tests were conducted to assess the performance of the adapted approach compared to the original approach. the results indicated that the adapted approach substantially removed technical and biological variance, particularly in the bcbp-ocd and top cohorts. importantly, the association between the first ancestry pc and different ancestry groups was stronger using the adapted approach. while the addition of called genotypes to the residualization step did not substantially affect results in the bcbp-ocd cohort, the top cohort showed a stronger association between the first ancestry pc and the ancestry groups when called genotypes were included. this highlights that incorporating called genotypes can improve the robustness, especially in cohorts with larger technical effects. a key indicator of the adapted approach’s performance is its ability to cluster repeated samples from the same individuals more closely than the original approach. this is demonstrated by higher silhouette scores, a measure of clustering performance, and tighter clustering, indicated by smaller distances to the centroid within each individual’s cluster, in both the bcbp-ocd and top cohorts. since genetic ancestry is consistent over time, repeated samples should cluster tightly together. the tighter clustering observed with the adapted approach aligns with our expectations, as the original approach is affected by technical and biological influences, such as differing plate positions and variations in cell type estimations across samples from the same individual; the adapted approach effectively corrects for these influences, resulting in more accurate ancestry estimations. in addition to improved individual-level clustering, the different ancestry groups also showed better clustering when plotting ancestry pcs against one another. in the top cohort, where batch effects were more pronounced, incorporating called genotypes resulted in higher silhouette scores compared to using the residualized data alone. in contrast, in the bcbp-ocd cohort, where batch effects were less pronounced, the addition of genotypes had minimal impact on clustering performance at the ancestry group level. the tightness of clusters, measured as the distances of samples to their respective ancestry cluster centroids, yielded mixed results across different ancestry groups. this variability may reflect the adapted approach’s ability to capture greater genetic diversity within ancestry groups when confounding factors are appropriately adjusted for. finally, the adapted approach demonstrated a strong correlation (r = 0.875) between the first ancestry pcs and the first genotyping pc in the bcbp-ocd cohort, whereas no such correlation was observed with the original approach. the first genotyping pc captures most genetic background, which demonstrates the ability of the first ancestry pc to also capture most of the genetic variability. moreover, when examining the mean correlation of the first three ancestry pcs with the first three genotyping pcs, the adapted approach including the called genotypes showed the highest correlations of the compared approaches, capturing more true genetic information. in the bcbp-ocd cohort, epiancer+ showed clearly superior performance compared with dna methylation pcs (dnampcs) and surrogate variables (svs), demonstrating stronger statistical associations with ancestry, better clustering of ancestry groups, and improved clustering of repeated samples. overall, epiancer+ is more effective at capturing true ancestry effects, whereas dnampcs are more likely to capture technical noise and svs tend to reflect other non-ancestry influences. the adjusted method did not perform better for the gtp and uthealth houston cohorts. our partial r 2 analysis in the gtp cohort provides quantitative support for this observation: while epiancer+ pc1 retained strong ancestry signal (94.4% variance explained by genotype pcs), it also contained substantial variance from residualized covariates (40.5%), and pc3 was largely driven by residualized variables (49.4%) with minimal ancestry signal (1.1%). this pattern is consistent with unbalanced study design, where technical and biological covariates are unevenly distributed across ancestry groups, creating correlations between ancestry and residualized factors. these results indicate that some ancestry effect is removed when correcting for biological and technical factors in the residualizing step, because these factors are themselves associated with ancestry. there is a balance between removing the effects of technical and biological factors and removing ancestry information associated with these factors. if batch effects are not too strong but still associated with ancestry, then ancestry clustering does not improve, as seen in the gtp and uthealth houston cohorts. in contrast, substantial improvements are observed in cohorts like the bcbp-ocd cohort, where there is little to no association between ancestry and the factors adjusted for during residualization. similarly, in the top cohort, which has large technical batch effects, residualization had an improving effect despite the removal of some ancestry-related information. the actual performance is sample-specific and depends on the study design, but the method is applicable across a range of sample sizes. thus, it is important to take more care in designing the studies so that technical factors are not associated with ancestry (by a randomized design, balancing ancestry across plates, slides, and slide positions) and that sex and age are as balanced as possible across ancestries. this makes it possible for the residualization step to effectively remove influencing factors while preserving the ancestry effects. limitations one limitation is the relatively low overall mean correlation between the first three ancestry pcs and the first three genotyping pcs (mean r = 0.173 for the adapted approach including the genotypic data), suggesting that it does not fully capture all genotyping effects. however, the high correlation between the first ancestry pc and the first genotyping pc (r = 0.875) indicates that the approach effectively captures most of the genetic variation. despite this, genotyping data remains the gold standard for accurately capturing genetic ancestry and should be used whenever available to adjust for genetic background in dna methylation studies. expanding the coverage of illumina dna methylation arrays to include more sites overlapping with snp probes specifically designed to capture ancestry could enhance the ancestry signal derived from these arrays and improve alignment with genotyping pcs; however, in the design of the epic v2, a substantial number of snp-associated methylation probes were removed (selected ancestry-informative probes: 450 k: n = 7295; epic v1: n = 3622; epic v2: n = 2674). another limitation is that the precision of the performance testing may be affected by the fact that our approach was primarily tested on european samples, with fewer available samples from other ancestries. furthermore, the uthealth houston cohort relied on self-reported ancestry data, which is known to be less accurate and may have led to the inclusion of individuals with mixed or misclassified genetic ancestry. additionally, while "latino" is officially recognized as an ethnicity rather than a genetic ancestry group, we used it in our analysis as a label for an ancestry cluster. this cluster reflects admixed genetic backgrounds - typically indigenous american, european, and african - commonly seen in individuals self-identifying as latino. additionally, the longer runtime of our approach presents a practical limitation, primarily due to the detection p-value calculation step. however, this issue can be mitigated by providing pre-calculated detection p-values as input to the function (if already calculated), significantly reducing processing time. we considered comparing the performance of epiancer+ with epistructure [ 4 ]; however, epistructure has not been updated for the latest arrays and is therefore unlikely to perform reliably on our data. practical implications epiancer+ can be used to adjust for ancestry in all samples, even when technical factors correlate with ancestry, as it successfully clustered samples based on ancestry across all tested datasets. importantly, in cohorts where ancestry is correlated with technical and biological effects, our method ensures that ancestry is not accounted for twice. unlike the method by barfield et al. [ 2 ], which risks collinearity by adjusting for ancestry alongside confounding factors, our adapted method estimates the remaining ancestry effect while preserving relevant variation. compared to epistructure [ 4 ], epiancer+ offers improved usability and compatibility. epistructure is implemented in python within the glint framework and requires multiple preprocessing steps, limiting its integration with standard r-based pipelines. moreover, it has not been updated since 2017 and does not support the epic v2 array. epiancer+ , by contrast, is r-based and supports all major array types (450 k, epic v1, epic v2). ancestry pcs should be calculated only for samples that have passed general quality control. based on our experience, including one or two ancestry pcs is often sufficient for most analyses, though the number required depends on cohort diversity. in highly heterogeneous populations, additional ancestry pcs may be necessary. we recommend testing different models (e.g., using 2, 5, or 10 ancestry pcs) and evaluating their performance using qq plots and genomic inflation factor (λ), as demonstrated in the practical example in the results section. the optimal number of pcs is the one that brings λ closest to 1.0 and gives qq plots with no evidence of inflation, indicating adequate correction for population stratification without overfitting. conclusions adequate adjustment for genetic ancestry is essential in dna methylation studies. when genotyping data is unavailable, it has been suggested to use dna methylation data from illumina arrays overlapping with snps as an alternative. we have improved this approach by accounting for technical and biological influences and incorporating genotypic data from snp probes, offering increased robustness. our adapted approach ( epiancer+ ) is easy to implement in existing r pipelines, including the ones for the epic v2 array, and offers a practical solution for ancestry adjustment. data availability no datasets were generated or analysed during the current study. references breeze ce, beck s, berndt si, franceschini n. the missing diversity in human epigenomic studies. nat genet. 2022;54(6):737–9. article cas pubmed pubmed central google scholar barfield rt, almli lm, kilaru v, smith ak, mercer kb, duncan r, et al. accounting for population stratification in dna methylation studies. genet epidemiol. 2014;38(3):231–41. article pubmed pubmed central google scholar auton a, brooks ld, durbin rm, garrison ep, kang hm, et al. a global reference for human genetic variation (genomes project consortium ). nature. 2015;526(7571):68–74. article pubmed google scholar rahmani e, shenhav l, schweiger r, yousefi p, huen k, eskenazi b, et al. genome-wide methylation data mirror ancestry information. epigenetics chromatin. 2017;10:1. article pubmed pubmed central google scholar wortinger la, stavrum ak, shadrin aa, szabo a, rukke sh, nerland s, et al. divergent epigenetic responses to perinatal asphyxia in severe mental disorders. transl psychiatry. 2024;8(14):16. article google scholar engh ja, friis s, birkenaes ab, jónsdóttir h, klungsøyr o, ringen pa, et al. delusions are associated with poor cognitive insight in schizophrenia. schizophr bull. 2010;36(4):830–5. article pubmed google scholar simonsen c, sundet k, vaskinn a, birkenaes ab, engh ja, faerden a, et al. neurocognitive dysfunction in bipolar and schizophrenia spectrum disorders depends on history of psychosis rather than diagnostic group. schizophr bull. 2011;37(1):73–83. article pubmed google scholar mirza s, lima cnc, del favero-campbell a, rubinstein a, topolski n, cabrera-mendoza b, et al. blood epigenome-wide association studies of suicide attempt in adults with bipolar disorder. transl psychiatry. 2024;14(1):70. article cas pubmed pubmed central google scholar gillespie cf, bradley b, mercer k, smith ak, conneely k, gapen m, et al. trauma exposure and stress-related disorders in inner city primary care patients. gen hosp psychiatry. 2009;31(6):505–14. article pubmed pubmed central google scholar aryee mj, jaffe ae, corrada-bravo h, ladd-acosta c, feinberg ap, hansen kd, et al. minfi: a flexible and comprehensive bioconductor package for the analysis of infinium dna methylation microarrays. bioinformatics. 2014;30(10):1363–9. article cas pubmed pubmed central google scholar just ac, heiss ja. ewastools: ewas tools. 2023. pidsley r, wong ccy, volta m, lunnon k, mill j, schalkwyk lc. a data-driven approach to preprocessing illumina 450k methylation array data. bmc genomics. 2013;1(14):293. article google scholar zheng sc, webster ap, dong d, feber a, graham dg, sullivan r, et al. a novel cell-type deconvolution algorithm reveals substantial contamination by immune cells in saliva. buccal cervix epigenomics. 2018;10(7):925–40. article cas pubmed google scholar salas la, koestler dc. flowsorted.blood.epic: illumina epic data on immunomagnetic sorted peripheral adult blood cells. [internet]. 2024. available from: https://github.com/immunomethylomics/flowsorted.blood.epic katrinli s, wani ah, maihofer ax, ratanatharathorn a, daskalakis np, montalvo-ortiz j, et al. epigenome-wide association studies identify novel dna methylation sites associated with ptsd: a meta-analysis of 23 military and civilian cohorts. genome med. 2024;16(1):147. article cas pubmed pubmed central google scholar teschendorff ae, breeze ce, zheng sc, beck s. a comparison of reference-based algorithms for correcting cell-type heterogeneity in epigenome-wide association studies. bmc bioinform. 2017;18(1):105. article google scholar salas la, koestler dc, butler ra, hansen hm, wiencke jk, kelsey kt, et al. an optimized library for reference-based deconvolution of whole-blood biospecimens assayed using the illumina humanmethylationepic beadarray. genome biol. 2018;19(1):64. article pubmed pubmed central google scholar houseman ea, accomando wp, koestler dc, christensen bc, marsit cj, nelson hh, et al. dna methylation arrays as surrogate measures of cell mixture distribution. bmc bioinform. 2012;13(1):86. article google scholar strom ni, gerring zf, galimberti m, yu d, halvorsen mw, abdellaoui a, et al. genome-wide analyses identify 30 loci associated with obsessive-compulsive disorder [internet]. medrxiv; 2025 [cited 2025 may 1]. p. 2024.03.13.24304161. available from: https://www.medrxiv.org/content/ . https://doi.org/10.1101/2024.03.13.24304161v2 halvorsen mw, de schipper e, bäckman j, strom ni, hagen k, lindblad-toh k, et al. a burden of rare copy number variants in obsessive-compulsive disorder. mol psychiatry. 2025;30(4):1510–7. article cas pubmed google scholar werner mcf, wirgenes kv, shadrin a, lunding sh, rødevand l, hjell g, et al. immune marker levels in severe mental disorders: associations with polygenic risk scores of related mental phenotypes and psoriasis. transl psychiatry. 2022;12(1):38. article cas pubmed pubmed central google scholar nievergelt cm, maihofer ax, klengel t, atkinson eg, chen cy, choi kw, et al. international meta-analysis of ptsd genome-wide association studies identifies sex- and ancestry-specific genetic risk loci. nat commun. 2019;10(1):4558. article pubmed pubmed central google scholar tian y, morris tj, webster ap, yang z, beck s, feber a, et al. champ: updated methylation analysis pipeline for illumina beadchips. bioinformatics. 2017;33(24):3982–4. article cas pubmed pubmed central google scholar hansen kd. illuminahumanmethylation450kanno.ilmn12.hg19: annotation for illumina’s 450k methylation arrays. 2021. pidsley r, zotenko e, peters tj, lawrence mg, risbridger gp, molloy p, et al. critical evaluation of the illumina methylationepic beadchip microarray for whole-genome dna methylation profiling. genome biol. 2016;17(1):208. article pubmed pubmed central google scholar zhang z, zeng c, zhang w. characterization of the illumina epic array for optimal applications in epigenetic research targeting diverse human populations. epigenetics commun. 2022;1(2):7. article google scholar infinium methylationepic v2.0 product files [internet]. [cited 2024 nov 28]. available from: https://support.illumina.com/downloads/infinium-methylationepic-v2-0-product-files.html rousseeuw pj. silhouettes: a graphical aid to the interpretation and validation of cluster analysis. j comput appl math. 1987;1(20):53–65. article google scholar maechler m, rousseeuw p, struyf a, hubert m, hornik k. cluster: cluster analysis basics and extensions [internet]. 2023. available from: https://cran.r-project.org/package=cluster wickham h. ggplot2: elegant graphics for data analysis [internet]. new york, ny: springer; 2009 [cited 2023 may 22]. available from: https://link.springer.com/ https://doi.org/10.1007/978-0-387-98141-3 wilke co. cowplot: streamlined plot theme and plot annotations for ‘ggplot2’ [internet]. 2024. available from: https://wilkelab.org/cowplot/ pedersen tl. patchwork: the composer of plots [internet]. 2024. available from: https://patchwork.data-imaginist.com inc pt. collaborative data science [internet]. montreal, qc: plotly technologies inc.; 2015. available from: https://plot.ly vaidyanathan r, xie y, allaire jj, cheng j, sievert c, russell k. htmlwidgets: html widgets for r [internet]. 2023. available from: https://cran.r-project.org/package=htmlwidgets wei t, simko v. r package ‘corrplot’: visualization of a correlation matrix [internet]. 2024. available from: https://github.com/taiyun/corrplot download references acknowledgements we thank all individuals who have provided samples for this study. in bergen, our sincere thanks go to helene nilsen, marie karin bjorøy, and lisa vårdal for organizing the samples, as well as to nadine fricker from life&brain for her exceptional service. we thank all clinicians for their support in participant recruitment, and we appreciate the technical support of all the staff, volunteers and participants from the grady trauma project. grammar corrections in this manuscript were assisted by gpt-4o (openai). funding open access funding provided by university of bergen. this work was performed on the safe facilities owned by the university of bergen and the tsd (tjeneste for sensitive data) facilities, owned by the university of oslo, operated and developed by the tsd service group at the university of oslo, it-department (usit) (tsd-drift@usit.uio.no). the authors would like to acknowledge support from: the research council of norway (rcn) for the top cohort (273291, 273446, 326813, 223273, 324499, 324252), the trond mohn foundation, nimh r01mh110427, and stiftelsen kristian gerhard jebsen (skgj med-02) for the bcbp-ocd cohort, and grants from the john s. dunn foundation and pat rutherford chair in psychiatry at uthealth houston. kdh was supported by a phd fellowship from the university of bergen. ak smith was supported by 2r01mh108826 and sk by k12hd085850 from nih. grf is supported by k01mh121580 from nimh. the funders did not have a role in design, analysis or publication. author information authors and affiliations department for clinical medicine, university of bergen, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard bergen center for brain plasticity, division of psychiatry, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum, jan haavik, kristen hagen, bjarne hansen & stéphanie le hellard dr. einar martens research group for biological psychiatry, department of medical genetics, haukeland university hospital, bergen, norway kira d. höffler, anne-kristin stavrum & stéphanie le hellard department of psychiatry, mclean hospital, harvard medical school, belmont, ma, usa kira d. höffler & kerry ressler department of gynecology and obstetrics, emory university, atlanta, ga, usa seyma katrinli & alicia k. smith department of genetics, university of north carolina at chapel hill, chapel hill, nc, usa matthew w. halvorsen & james j. crowley center for precision psychiatry, division of mental health and addiction, oslo university hospital and institute of clinical medicine, university of oslo, oslo, norway kevin s. o’connell, alexey shadrin, srdjan djurovic & ole a. andreassen department of medical genetics, oslo university hospital and university of oslo, oslo, norway kevin s. o’connell, alexey shadrin & srdjan djurovic section for precision psychiatry, oslo university hospital, oslo, norway alexey shadrin & ole a. andreassen department of psychiatry, university of north carolina at chapel hill, chapel hill, nc, usa james j. crowley department of biomedicine, university of bergen, bergen, norway jan haavik department of psychiatry, møre and romsdal hospital trust, molde, norway kristen hagen department of mental health, norwegian university of science and technology, trondheim, norway kristen hagen department of clinical psychology, university of bergen, bergen, norway gerd kvale center for crisis psychology, university of bergen, bergen, norway bjarne hansen faillace department of psychiatry and behavioral sciences, mcgovern medical school, the university of texas health science center at houston, houston, tx, usa jair c. soares & gabriel r. fries department of psychiatry and behavioral sciences, emory university, atlanta, ga, usa alicia k. smith authors kira d. höffler view author publications search author on: pubmed google scholar seyma katrinli view author publications search author on: pubmed google scholar matthew w. halvorsen view author publications search author on: pubmed google scholar anne-kristin stavrum view author publications search author on: pubmed google scholar kevin s. o’connell view author publications search author on: pubmed google scholar alexey shadrin view author publications search author on: pubmed google scholar srdjan djurovic view author publications search author on: pubmed google scholar ole a. andreassen view author publications search author on: pubmed google scholar james j. crowley view author publications search author on: pubmed google scholar jan haavik view author publications search author on: pubmed google scholar kristen hagen view author publications search author on: pubmed google scholar gerd kvale view author publications search author on: pubmed google scholar kerry ressler view author publications search author on: pubmed google scholar bjarne hansen view author publications search author on: pubmed google scholar jair c. soares view author publications search author on: pubmed google scholar gabriel r. fries view author publications search author on: pubmed google scholar alicia k. smith view author publications search author on: pubmed google scholar stéphanie le hellard view author publications search author on: pubmed google scholar contributions kd hoeffler, ak stavrum, and slh contributed to the design of the study. kd hoeffler developed the adapted approach and, together with sk and grf, tested it in the cohorts. mwh, kso, and a. shadrin performed genotyping quality control and ancestry prediction. sd and k. hagen were responsible for data acquisition. oaa, jjc, jh, gk, bh, jcs, ak smith, and slh served as site principal investigators and contributed data. ak stavrum, tk, kr, and slh supervised the research progress. kd hoeffler was the main contributor to writing the manuscript. ak stavrum, slh, sk, and grf also contributed to writing the manuscript. all authors read, edited, and approved the final manuscript. corresponding authors correspondence to kira d. höffler or stéphanie le hellard . ethics declarations ethics approval and consent to participate the current project was approved ​​the regional committee for research ethics (top cohort: #2009/2485; bcbp-ocd cohort: #2019/1097, gtp was approved by the irbs of emory university school of medicine and the research oversight committee of grady memorial hospital, uthealth houston was approved by irb #hsc-ms-09–0340). all participants provided informed consent. competing interests oaa is a consultant to cortechs.ai and precision health as, and has received speakers' honorarium from lundbeck , otsuka , janssen , bms , and lilly . the other authors declare that they have no competing interests. additional information publisher's note springer nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations. supplementary information overview of supplementary materials: supplementary figure s1 supplementary figure s2 supplementary figure s3 supplementary figure s4 supplementary figure s5 supplementary figure s6 supplementary figure s7 supplementary figure s8 supplementary figure s9 supplementary figure s10 supplementary figure s11 supplementary figure s12 supplementary figure s13 supplementary figure s14 supplementary figure s15 supplementary table s1 supplementary table s2 supplementary table s3 rights and permissions open access this article is licensed under a creative commons attribution 4.0 international license, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the creative commons licence, and indicate if changes were made. the images or other third party material in this article are included in the article’s creative commons licence, unless indicated otherwise in a credit line to the material. if material is not included in the article’s creative commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. to view a copy of this licence, visit http://creativecommons.org/licenses/by/4.0/ . reprints and permissions about this article cite this article höffler, k.d., katrinli, s., halvorsen, m.w. et al. optimizing genetic ancestry adjustment in dna methylation studies: a comparative analysis of approaches. epigenetics & chromatin 18 , 69 (2025). https://doi.org/10.1186/s13072-025-00627-0 download citation received : 02 may 2025 accepted : 29 august 2025 published : 14 october 2025 doi : https://doi.org/10.1186/s13072-025-00627-0 share this article anyone you share the following link with will be able to read this content: get shareable link sorry, a shareable link is not currently available for this article. copy shareable link to clipboard provided by the springer nature sharedit content-sharing initiative keywords epigenetics dna methylation ancestry ewas mwas download pdf advertisement window.sn = window.sn || {}; window.sn.libs = window.sn.libs || {}; window.sn.libs.ads = window.sn.libs.ads || {}; window.sn.libs.ads.slotconfig = window.sn.libs.ads.slotconfig || {}; window.sn.libs.ads.slotconfig['mpu1'] = { 'pos': 'mpu1' }; window.sn.libs.ads.slotconfig['unitpath'] = '/270604982/bmc/epigeneticsandchromatin/articles'; window.sn.libs.ads.slotconfig['type'] = 'article'; window.sn.libs.ads.slotconfig['kwrd'] = 'epigenetics,dna methylation,ancestry,ewas,mwas'; window.sn.libs.ads.slotconfig['doi'] = '10.1186/s13072-025-00627-0'; window.sn.libs.ads.slotconfig['pmc'] = 'l32030,b12008,l32020,l16008,b12010,b12030'; epigenetics & chromatin issn: 1756-8935 contact us submission enquiries: journalsubmissions@springernature.com read more on our blogs receive bmc newsletters manage article alerts language editing for authors scientific editing for authors policies accessibility press center support and contact leave feedback careers follow bmc bmc twitter page bmc facebook page bmc weibo page by using this website, you agree to our terms and conditions , your us state privacy rights , privacy statement and cookies policy. your privacy choices/manage cookies we use in the preference centre. © 2025 biomed central ltd unless otherwise stated. part of springer nature .## Scraping Notes- Successfully scraped from DOI.org